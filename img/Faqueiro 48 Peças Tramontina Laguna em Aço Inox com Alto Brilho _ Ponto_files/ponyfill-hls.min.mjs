var Ea=Object.create;var Yr=Object.defineProperty;var Ta=Object.getOwnPropertyDescriptor;var Sa=Object.getOwnPropertyNames;var _a=Object.getPrototypeOf,Aa=Object.prototype.hasOwnProperty;var Ra=(Te,ae)=>()=>(ae||Te((ae={exports:{}}).exports,ae),ae.exports);var ba=(Te,ae,V,Q)=>{if(ae&&typeof ae=="object"||typeof ae=="function")for(let X of Sa(ae))!Aa.call(Te,X)&&X!==V&&Yr(Te,X,{get:()=>ae[X],enumerable:!(Q=Ta(ae,X))||Q.enumerable});return Te};var La=(Te,ae,V)=>(V=Te!=null?Ea(_a(Te)):{},ba(ae||!Te||!Te.__esModule?Yr(V,"default",{value:Te,enumerable:!0}):V,Te));var Xr=Ra((Vt,gr)=>{typeof window!="undefined"&&function(ae,V){typeof Vt=="object"&&typeof gr=="object"?gr.exports=V():typeof define=="function"&&define.amd?define([],V):typeof Vt=="object"?Vt.Hls=V():ae.Hls=V()}(Vt,function(){return function(Te){var ae={};function V(Q){if(ae[Q])return ae[Q].exports;var X=ae[Q]={i:Q,l:!1,exports:{}};return Te[Q].call(X.exports,X,X.exports,V),X.l=!0,X.exports}return V.m=Te,V.c=ae,V.d=function(Q,X,L){V.o(Q,X)||Object.defineProperty(Q,X,{enumerable:!0,get:L})},V.r=function(Q){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(Q,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(Q,"__esModule",{value:!0})},V.t=function(Q,X){if(X&1&&(Q=V(Q)),X&8||X&4&&typeof Q=="object"&&Q&&Q.__esModule)return Q;var L=Object.create(null);if(V.r(L),Object.defineProperty(L,"default",{enumerable:!0,value:Q}),X&2&&typeof Q!="string")for(var te in Q)V.d(L,te,function(h){return Q[h]}.bind(null,te));return L},V.n=function(Q){var X=Q&&Q.__esModule?function(){return Q.default}:function(){return Q};return V.d(X,"a",X),X},V.o=function(Q,X){return Object.prototype.hasOwnProperty.call(Q,X)},V.p="/dist/",V(V.s="./src/hls.ts")}({"./node_modules/eventemitter3/index.js":function(Te,ae,V){"use strict";var Q=Object.prototype.hasOwnProperty,X="~";function L(){}Object.create&&(L.prototype=Object.create(null),new L().__proto__||(X=!1));function te(S,T,w){this.fn=S,this.context=T,this.once=w||!1}function h(S,T,w,R,D){if(typeof w!="function")throw new TypeError("The listener must be a function");var M=new te(w,R||S,D),k=X?X+T:T;return S._events[k]?S._events[k].fn?S._events[k]=[S._events[k],M]:S._events[k].push(M):(S._events[k]=M,S._eventsCount++),S}function c(S,T){--S._eventsCount===0?S._events=new L:delete S._events[T]}function Z(){this._events=new L,this._eventsCount=0}Z.prototype.eventNames=function(){var T=[],w,R;if(this._eventsCount===0)return T;for(R in w=this._events)Q.call(w,R)&&T.push(X?R.slice(1):R);return Object.getOwnPropertySymbols?T.concat(Object.getOwnPropertySymbols(w)):T},Z.prototype.listeners=function(T){var w=X?X+T:T,R=this._events[w];if(!R)return[];if(R.fn)return[R.fn];for(var D=0,M=R.length,k=new Array(M);D<M;D++)k[D]=R[D].fn;return k},Z.prototype.listenerCount=function(T){var w=X?X+T:T,R=this._events[w];return R?R.fn?1:R.length:0},Z.prototype.emit=function(T,w,R,D,M,k){var Y=X?X+T:T;if(!this._events[Y])return!1;var K=this._events[Y],j=arguments.length,H,J;if(K.fn){switch(K.once&&this.removeListener(T,K.fn,void 0,!0),j){case 1:return K.fn.call(K.context),!0;case 2:return K.fn.call(K.context,w),!0;case 3:return K.fn.call(K.context,w,R),!0;case 4:return K.fn.call(K.context,w,R,D),!0;case 5:return K.fn.call(K.context,w,R,D,M),!0;case 6:return K.fn.call(K.context,w,R,D,M,k),!0}for(J=1,H=new Array(j-1);J<j;J++)H[J-1]=arguments[J];K.fn.apply(K.context,H)}else{var ne=K.length,se;for(J=0;J<ne;J++)switch(K[J].once&&this.removeListener(T,K[J].fn,void 0,!0),j){case 1:K[J].fn.call(K[J].context);break;case 2:K[J].fn.call(K[J].context,w);break;case 3:K[J].fn.call(K[J].context,w,R);break;case 4:K[J].fn.call(K[J].context,w,R,D);break;default:if(!H)for(se=1,H=new Array(j-1);se<j;se++)H[se-1]=arguments[se];K[J].fn.apply(K[J].context,H)}}return!0},Z.prototype.on=function(T,w,R){return h(this,T,w,R,!1)},Z.prototype.once=function(T,w,R){return h(this,T,w,R,!0)},Z.prototype.removeListener=function(T,w,R,D){var M=X?X+T:T;if(!this._events[M])return this;if(!w)return c(this,M),this;var k=this._events[M];if(k.fn)k.fn===w&&(!D||k.once)&&(!R||k.context===R)&&c(this,M);else{for(var Y=0,K=[],j=k.length;Y<j;Y++)(k[Y].fn!==w||D&&!k[Y].once||R&&k[Y].context!==R)&&K.push(k[Y]);K.length?this._events[M]=K.length===1?K[0]:K:c(this,M)}return this},Z.prototype.removeAllListeners=function(T){var w;return T?(w=X?X+T:T,this._events[w]&&c(this,w)):(this._events=new L,this._eventsCount=0),this},Z.prototype.off=Z.prototype.removeListener,Z.prototype.addListener=Z.prototype.on,Z.prefixed=X,Z.EventEmitter=Z,Te.exports=Z},"./node_modules/url-toolkit/src/url-toolkit.js":function(Te,ae,V){(function(Q){var X=/^((?:[a-zA-Z0-9+\-.]+:)?)(\/\/[^\/?#]*)?((?:[^\/?#]*\/)*[^;?#]*)?(;[^?#]*)?(\?[^#]*)?(#.*)?$/,L=/^([^\/?#]*)(.*)$/,te=/(?:\/|^)\.(?=\/)/g,h=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,c={buildAbsoluteURL:function(Z,S,T){if(T=T||{},Z=Z.trim(),S=S.trim(),!S){if(!T.alwaysNormalize)return Z;var w=c.parseURL(Z);if(!w)throw new Error("Error trying to parse base URL.");return w.path=c.normalizePath(w.path),c.buildURLFromParts(w)}var R=c.parseURL(S);if(!R)throw new Error("Error trying to parse relative URL.");if(R.scheme)return T.alwaysNormalize?(R.path=c.normalizePath(R.path),c.buildURLFromParts(R)):S;var D=c.parseURL(Z);if(!D)throw new Error("Error trying to parse base URL.");if(!D.netLoc&&D.path&&D.path[0]!=="/"){var M=L.exec(D.path);D.netLoc=M[1],D.path=M[2]}D.netLoc&&!D.path&&(D.path="/");var k={scheme:D.scheme,netLoc:R.netLoc,path:null,params:R.params,query:R.query,fragment:R.fragment};if(!R.netLoc&&(k.netLoc=D.netLoc,R.path[0]!=="/"))if(!R.path)k.path=D.path,R.params||(k.params=D.params,R.query||(k.query=D.query));else{var Y=D.path,K=Y.substring(0,Y.lastIndexOf("/")+1)+R.path;k.path=c.normalizePath(K)}return k.path===null&&(k.path=T.alwaysNormalize?c.normalizePath(R.path):R.path),c.buildURLFromParts(k)},parseURL:function(Z){var S=X.exec(Z);return S?{scheme:S[1]||"",netLoc:S[2]||"",path:S[3]||"",params:S[4]||"",query:S[5]||"",fragment:S[6]||""}:null},normalizePath:function(Z){for(Z=Z.split("").reverse().join("").replace(te,"");Z.length!==(Z=Z.replace(h,"")).length;);return Z.split("").reverse().join("")},buildURLFromParts:function(Z){return Z.scheme+Z.netLoc+Z.path+Z.params+Z.query+Z.fragment}};Te.exports=c})(this)},"./node_modules/webworkify-webpack/index.js":function(Te,ae,V){function Q(T){var w={};function R(M){if(w[M])return w[M].exports;var k=w[M]={i:M,l:!1,exports:{}};return T[M].call(k.exports,k,k.exports,R),k.l=!0,k.exports}R.m=T,R.c=w,R.i=function(M){return M},R.d=function(M,k,Y){R.o(M,k)||Object.defineProperty(M,k,{configurable:!1,enumerable:!0,get:Y})},R.r=function(M){Object.defineProperty(M,"__esModule",{value:!0})},R.n=function(M){var k=M&&M.__esModule?function(){return M.default}:function(){return M};return R.d(k,"a",k),k},R.o=function(M,k){return Object.prototype.hasOwnProperty.call(M,k)},R.p="/",R.oe=function(M){throw console.error(M),M};var D=R(R.s=ENTRY_MODULE);return D.default||D}var X="[\\.|\\-|\\+|\\w|/|@]+",L="\\(\\s*(/\\*.*?\\*/)?\\s*.*?("+X+").*?\\)";function te(T){return(T+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function h(T){return!isNaN(1*T)}function c(T,w,R){var D={};D[R]=[];var M=w.toString(),k=M.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(!k)return D;for(var Y=k[1],K=new RegExp("(\\\\n|\\W)"+te(Y)+L,"g"),j;j=K.exec(M);)j[3]!=="dll-reference"&&D[R].push(j[3]);for(K=new RegExp("\\("+te(Y)+'\\("(dll-reference\\s('+X+'))"\\)\\)'+L,"g");j=K.exec(M);)T[j[2]]||(D[R].push(j[1]),T[j[2]]=V(j[1]).m),D[j[2]]=D[j[2]]||[],D[j[2]].push(j[4]);for(var H=Object.keys(D),J=0;J<H.length;J++)for(var ne=0;ne<D[H[J]].length;ne++)h(D[H[J]][ne])&&(D[H[J]][ne]=1*D[H[J]][ne]);return D}function Z(T){var w=Object.keys(T);return w.reduce(function(R,D){return R||T[D].length>0},!1)}function S(T,w){for(var R={main:[w]},D={main:[]},M={main:{}};Z(R);)for(var k=Object.keys(R),Y=0;Y<k.length;Y++){var K=k[Y],j=R[K],H=j.pop();if(M[K]=M[K]||{},!(M[K][H]||!T[K][H])){M[K][H]=!0,D[K]=D[K]||[],D[K].push(H);for(var J=c(T,T[K][H],K),ne=Object.keys(J),se=0;se<ne.length;se++)R[ne[se]]=R[ne[se]]||[],R[ne[se]]=R[ne[se]].concat(J[ne[se]])}}return D}Te.exports=function(T,w){w=w||{};var R={main:V.m},D=w.all?{main:Object.keys(R.main)}:S(R,T),M="";Object.keys(D).filter(function(H){return H!=="main"}).forEach(function(H){for(var J=0;D[H][J];)J++;D[H].push(J),R[H][J]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",M=M+"var "+H+" = ("+Q.toString().replace("ENTRY_MODULE",JSON.stringify(J))+")({"+D[H].map(function(ne){return""+JSON.stringify(ne)+": "+R[H][ne].toString()}).join(",")+`});
`}),M=M+"new (("+Q.toString().replace("ENTRY_MODULE",JSON.stringify(T))+")({"+D.main.map(function(H){return""+JSON.stringify(H)+": "+R.main[H].toString()}).join(",")+"}))(self);";var k=new window.Blob([M],{type:"text/javascript"});if(w.bare)return k;var Y=window.URL||window.webkitURL||window.mozURL||window.msURL,K=Y.createObjectURL(k),j=new window.Worker(K);return j.objectURL=K,j}},"./src/crypt/decrypter.js":function(Te,ae,V){"use strict";V.r(ae);var Q=function(){function k(K,j){this.subtle=K,this.aesIV=j}var Y=k.prototype;return Y.decrypt=function(j,H){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},H,j)},k}(),X=function(){function k(K,j){this.subtle=K,this.key=j}var Y=k.prototype;return Y.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},k}(),L=X;function te(k){var Y=k.byteLength,K=Y&&new DataView(k).getUint8(Y-1);return K?k.slice(0,Y-K):k}var h=function(){function k(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.initTable()}var Y=k.prototype;return Y.uint8ArrayToUint32Array_=function(j){for(var H=new DataView(j),J=new Uint32Array(4),ne=0;ne<4;ne++)J[ne]=H.getUint32(ne*4);return J},Y.initTable=function(){var j=this.sBox,H=this.invSBox,J=this.subMix,ne=J[0],se=J[1],ve=J[2],ce=J[3],Se=this.invSubMix,Ue=Se[0],Fe=Se[1],Oe=Se[2],ut=Se[3],Le=new Uint32Array(256),Be=0,Ye=0,Ge=0;for(Ge=0;Ge<256;Ge++)Ge<128?Le[Ge]=Ge<<1:Le[Ge]=Ge<<1^283;for(Ge=0;Ge<256;Ge++){var Ce=Ye^Ye<<1^Ye<<2^Ye<<3^Ye<<4;Ce=Ce>>>8^Ce&255^99,j[Be]=Ce,H[Ce]=Be;var De=Le[Be],pe=Le[De],Je=Le[pe],we=Le[Ce]*257^Ce*16843008;ne[Be]=we<<24|we>>>8,se[Be]=we<<16|we>>>16,ve[Be]=we<<8|we>>>24,ce[Be]=we,we=Je*16843009^pe*65537^De*257^Be*16843008,Ue[Ce]=we<<24|we>>>8,Fe[Ce]=we<<16|we>>>16,Oe[Ce]=we<<8|we>>>24,ut[Ce]=we,Be?(Be=De^Le[Le[Le[Je^De]]],Ye^=Le[Le[Ye]]):Be=Ye=1}},Y.expandKey=function(j){for(var H=this.uint8ArrayToUint32Array_(j),J=!0,ne=0;ne<H.length&&J;)J=H[ne]===this.key[ne],ne++;if(!J){this.key=H;var se=this.keySize=H.length;if(se!==4&&se!==6&&se!==8)throw new Error("Invalid aes key size="+se);var ve=this.ksRows=(se+6+1)*4,ce,Se,Ue=this.keySchedule=new Uint32Array(ve),Fe=this.invKeySchedule=new Uint32Array(ve),Oe=this.sBox,ut=this.rcon,Le=this.invSubMix,Be=Le[0],Ye=Le[1],Ge=Le[2],Ce=Le[3],De,pe;for(ce=0;ce<ve;ce++){if(ce<se){De=Ue[ce]=H[ce];continue}pe=De,ce%se===0?(pe=pe<<8|pe>>>24,pe=Oe[pe>>>24]<<24|Oe[pe>>>16&255]<<16|Oe[pe>>>8&255]<<8|Oe[pe&255],pe^=ut[ce/se|0]<<24):se>6&&ce%se===4&&(pe=Oe[pe>>>24]<<24|Oe[pe>>>16&255]<<16|Oe[pe>>>8&255]<<8|Oe[pe&255]),Ue[ce]=De=(Ue[ce-se]^pe)>>>0}for(Se=0;Se<ve;Se++)ce=ve-Se,Se&3?pe=Ue[ce]:pe=Ue[ce-4],Se<4||ce<=4?Fe[Se]=pe:Fe[Se]=Be[Oe[pe>>>24]]^Ye[Oe[pe>>>16&255]]^Ge[Oe[pe>>>8&255]]^Ce[Oe[pe&255]],Fe[Se]=Fe[Se]>>>0}},Y.networkToHostOrderSwap=function(j){return j<<24|(j&65280)<<8|(j&16711680)>>8|j>>>24},Y.decrypt=function(j,H,J,ne){for(var se=this.keySize+6,ve=this.invKeySchedule,ce=this.invSBox,Se=this.invSubMix,Ue=Se[0],Fe=Se[1],Oe=Se[2],ut=Se[3],Le=this.uint8ArrayToUint32Array_(J),Be=Le[0],Ye=Le[1],Ge=Le[2],Ce=Le[3],De=new Int32Array(j),pe=new Int32Array(De.length),Je,we,_t,vt,_e,tt,rt,at,pt,At,et,mt,Qe,Rt,Ie=this.networkToHostOrderSwap;H<De.length;){for(pt=Ie(De[H]),At=Ie(De[H+1]),et=Ie(De[H+2]),mt=Ie(De[H+3]),_e=pt^ve[0],tt=mt^ve[1],rt=et^ve[2],at=At^ve[3],Qe=4,Rt=1;Rt<se;Rt++)Je=Ue[_e>>>24]^Fe[tt>>16&255]^Oe[rt>>8&255]^ut[at&255]^ve[Qe],we=Ue[tt>>>24]^Fe[rt>>16&255]^Oe[at>>8&255]^ut[_e&255]^ve[Qe+1],_t=Ue[rt>>>24]^Fe[at>>16&255]^Oe[_e>>8&255]^ut[tt&255]^ve[Qe+2],vt=Ue[at>>>24]^Fe[_e>>16&255]^Oe[tt>>8&255]^ut[rt&255]^ve[Qe+3],_e=Je,tt=we,rt=_t,at=vt,Qe=Qe+4;Je=ce[_e>>>24]<<24^ce[tt>>16&255]<<16^ce[rt>>8&255]<<8^ce[at&255]^ve[Qe],we=ce[tt>>>24]<<24^ce[rt>>16&255]<<16^ce[at>>8&255]<<8^ce[_e&255]^ve[Qe+1],_t=ce[rt>>>24]<<24^ce[at>>16&255]<<16^ce[_e>>8&255]<<8^ce[tt&255]^ve[Qe+2],vt=ce[at>>>24]<<24^ce[_e>>16&255]<<16^ce[tt>>8&255]<<8^ce[rt&255]^ve[Qe+3],Qe=Qe+3,pe[H]=Ie(Je^Be),pe[H+1]=Ie(vt^Ye),pe[H+2]=Ie(_t^Ge),pe[H+3]=Ie(we^Ce),Be=pt,Ye=At,Ge=et,Ce=mt,H=H+4}return ne?te(pe.buffer):pe.buffer},Y.destroy=function(){this.key=void 0,this.keySize=void 0,this.ksRows=void 0,this.sBox=void 0,this.invSBox=void 0,this.subMix=void 0,this.invSubMix=void 0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.rcon=void 0},k}(),c=h,Z=V("./src/errors.ts"),S=V("./src/utils/logger.js"),T=V("./src/events.js"),w=V("./src/utils/get-self-scope.js"),R=Object(w.getSelfScope)(),D=function(){function k(K,j,H){var J=H===void 0?{}:H,ne=J.removePKCS7Padding,se=ne===void 0?!0:ne;if(this.logEnabled=!0,this.observer=K,this.config=j,this.removePKCS7Padding=se,se)try{var ve=R.crypto;ve&&(this.subtle=ve.subtle||ve.webkitSubtle)}catch(ce){}this.disableWebCrypto=!this.subtle}var Y=k.prototype;return Y.isSync=function(){return this.disableWebCrypto&&this.config.enableSoftwareAES},Y.decrypt=function(j,H,J,ne){var se=this;if(this.disableWebCrypto&&this.config.enableSoftwareAES){this.logEnabled&&(S.logger.log("JS AES decrypt"),this.logEnabled=!1);var ve=this.decryptor;ve||(this.decryptor=ve=new c),ve.expandKey(H),ne(ve.decrypt(j,0,J,this.removePKCS7Padding))}else{this.logEnabled&&(S.logger.log("WebCrypto AES decrypt"),this.logEnabled=!1);var ce=this.subtle;this.key!==H&&(this.key=H,this.fastAesKey=new L(ce,H)),this.fastAesKey.expandKey().then(function(Se){var Ue=new Q(ce,J);Ue.decrypt(j,Se).catch(function(Fe){se.onWebCryptoError(Fe,j,H,J,ne)}).then(function(Fe){ne(Fe)})}).catch(function(Se){se.onWebCryptoError(Se,j,H,J,ne)})}},Y.onWebCryptoError=function(j,H,J,ne,se){this.config.enableSoftwareAES?(S.logger.log("WebCrypto Error, disable WebCrypto API"),this.disableWebCrypto=!0,this.logEnabled=!0,this.decrypt(H,J,ne,se)):(S.logger.error("decrypting error : "+j.message),this.observer.trigger(T.default.ERROR,{type:Z.ErrorTypes.MEDIA_ERROR,details:Z.ErrorDetails.FRAG_DECRYPT_ERROR,fatal:!0,reason:j.message}))},Y.destroy=function(){var j=this.decryptor;j&&(j.destroy(),this.decryptor=void 0)},k}(),M=ae.default=D},"./src/demux/demuxer-inline.js":function(Te,ae,V){"use strict";V.r(ae);var Q=V("./src/events.js"),X=V("./src/errors.ts"),L=V("./src/crypt/decrypter.js"),te=V("./src/polyfills/number.js"),h=V("./src/utils/logger.js"),c=V("./src/utils/get-self-scope.js");function Z(m,b,y,f){var g,x,E,_,I,O=navigator.userAgent.toLowerCase(),P=f,N=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];if(g=((b[y+2]&192)>>>6)+1,x=(b[y+2]&60)>>>2,x>N.length-1){m.trigger(Q.default.ERROR,{type:X.ErrorTypes.MEDIA_ERROR,details:X.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+x});return}return _=(b[y+2]&1)<<2,_|=(b[y+3]&192)>>>6,h.logger.log("manifest codec:"+f+",ADTS data:type:"+g+",sampleingIndex:"+x+"["+N[x]+"Hz],channelConfig:"+_),/firefox/i.test(O)?x>=6?(g=5,I=new Array(4),E=x-3):(g=2,I=new Array(2),E=x):O.indexOf("android")!==-1?(g=2,I=new Array(2),E=x):(g=5,I=new Array(4),f&&(f.indexOf("mp4a.40.29")!==-1||f.indexOf("mp4a.40.5")!==-1)||!f&&x>=6?E=x-3:((f&&f.indexOf("mp4a.40.2")!==-1&&(x>=6&&_===1||/vivaldi/i.test(O))||!f&&_===1)&&(g=2,I=new Array(2)),E=x)),I[0]=g<<3,I[0]|=(x&14)>>1,I[1]|=(x&1)<<7,I[1]|=_<<3,g===5&&(I[1]|=(E&14)>>1,I[2]=(E&1)<<7,I[2]|=2<<2,I[3]=0),{config:I,samplerate:N[x],channelCount:_,codec:"mp4a.40."+g,manifestCodec:P}}function S(m,b){return m[b]===255&&(m[b+1]&246)===240}function T(m,b){return m[b+1]&1?7:9}function w(m,b){return(m[b+3]&3)<<11|m[b+4]<<3|(m[b+5]&224)>>>5}function R(m,b){return!!(b+1<m.length&&S(m,b))}function D(m,b){if(R(m,b)){var y=T(m,b);if(b+y>=m.length)return!1;var f=w(m,b);if(f<=y)return!1;var g=b+f;if(g===m.length||g+1<m.length&&S(m,g))return!0}return!1}function M(m,b,y,f,g){if(!m.samplerate){var x=Z(b,y,f,g);m.config=x.config,m.samplerate=x.samplerate,m.channelCount=x.channelCount,m.codec=x.codec,m.manifestCodec=x.manifestCodec,h.logger.log("parsed codec:"+m.codec+",rate:"+x.samplerate+",nb channel:"+x.channelCount)}}function k(m){return 1024*9e4/m}function Y(m,b,y,f,g){var x,E,_,I=m.length;if(x=T(m,b),E=w(m,b),E-=x,E>0&&b+x+E<=I)return _=y+f*g,{headerLength:x,frameLength:E,stamp:_}}function K(m,b,y,f,g){var x=k(m.samplerate),E=Y(b,y,f,g,x);if(E){var _=E.stamp,I=E.headerLength,O=E.frameLength,P={unit:b.subarray(y+I,y+I+O),pts:_,dts:_};return m.samples.push(P),{sample:P,length:O+I}}}var j=V("./src/demux/id3.js"),H=function(){function m(y,f,g){this.observer=y,this.config=g,this.remuxer=f}var b=m.prototype;return b.resetInitSegment=function(f,g,x,E){this._audioTrack={container:"audio/adts",type:"audio",id:0,sequenceNumber:0,isAAC:!0,samples:[],len:0,manifestCodec:g,duration:E,inputTimeScale:9e4}},b.resetTimeStamp=function(){},m.probe=function(f){if(!f)return!1;for(var g=j.default.getID3Data(f,0)||[],x=g.length,E=f.length;x<E;x++)if(D(f,x))return h.logger.log("ADTS sync word found !"),!0;return!1},b.append=function(f,g,x,E){for(var _=this._audioTrack,I=j.default.getID3Data(f,0)||[],O=j.default.getTimeStamp(I),P=Object(te.isFiniteNumber)(O)?O*90:g*9e4,N=0,G=P,U=f.length,z=I.length,$=[{pts:G,dts:G,data:I}];z<U-1;)if(R(f,z)&&z+5<U){M(_,this.observer,f,z,_.manifestCodec);var W=K(_,f,z,P,N);if(W)z+=W.length,G=W.sample.pts,N++;else{h.logger.log("Unable to parse AAC frame");break}}else j.default.isHeader(f,z)?(I=j.default.getID3Data(f,z),$.push({pts:G,dts:G,data:I}),z+=I.length):z++;this.remuxer.remux(_,{samples:[]},{samples:$,inputTimeScale:9e4},{samples:[]},g,x,E)},b.destroy=function(){},m}(),J=H,ne=V("./src/demux/mp4demuxer.js"),se={BitratesMap:[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],SamplingRateMap:[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],SamplesCoefficients:[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],BytesInSlot:[0,1,1,4],appendFrame:function(b,y,f,g,x){if(!(f+24>y.length)){var E=this.parseHeader(y,f);if(E&&f+E.frameLength<=y.length){var _=E.samplesPerFrame*9e4/E.sampleRate,I=g+x*_,O={unit:y.subarray(f,f+E.frameLength),pts:I,dts:I};return b.config=[],b.channelCount=E.channelCount,b.samplerate=E.sampleRate,b.samples.push(O),{sample:O,length:E.frameLength}}}},parseHeader:function(b,y){var f=b[y+1]>>3&3,g=b[y+1]>>1&3,x=b[y+2]>>4&15,E=b[y+2]>>2&3,_=b[y+2]>>1&1;if(f!==1&&x!==0&&x!==15&&E!==3){var I=f===3?3-g:g===3?3:4,O=se.BitratesMap[I*14+x-1]*1e3,P=f===3?0:f===2?1:2,N=se.SamplingRateMap[P*3+E],G=b[y+3]>>6===3?1:2,U=se.SamplesCoefficients[f][g],z=se.BytesInSlot[g],$=U*8*z,W=parseInt(U*O/N+_,10)*z;return{sampleRate:N,channelCount:G,frameLength:W,samplesPerFrame:$}}},isHeaderPattern:function(b,y){return b[y]===255&&(b[y+1]&224)===224&&(b[y+1]&6)!==0},isHeader:function(b,y){return!!(y+1<b.length&&this.isHeaderPattern(b,y))},probe:function(b,y){if(y+1<b.length&&this.isHeaderPattern(b,y)){var f=4,g=this.parseHeader(b,y),x=f;g&&g.frameLength&&(x=g.frameLength);var E=y+x;if(E===b.length||E+1<b.length&&this.isHeaderPattern(b,E))return!0}return!1}},ve=se,ce=function(){function m(y){this.data=y,this.bytesAvailable=y.byteLength,this.word=0,this.bitsAvailable=0}var b=m.prototype;return b.loadWord=function(){var f=this.data,g=this.bytesAvailable,x=f.byteLength-g,E=new Uint8Array(4),_=Math.min(4,g);if(_===0)throw new Error("no bytes available");E.set(f.subarray(x,x+_)),this.word=new DataView(E.buffer).getUint32(0),this.bitsAvailable=_*8,this.bytesAvailable-=_},b.skipBits=function(f){var g;this.bitsAvailable>f?(this.word<<=f,this.bitsAvailable-=f):(f-=this.bitsAvailable,g=f>>3,f-=g>>3,this.bytesAvailable-=g,this.loadWord(),this.word<<=f,this.bitsAvailable-=f)},b.readBits=function(f){var g=Math.min(this.bitsAvailable,f),x=this.word>>>32-g;return f>32&&h.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=g,this.bitsAvailable>0?this.word<<=g:this.bytesAvailable>0&&this.loadWord(),g=f-g,g>0&&this.bitsAvailable?x<<g|this.readBits(g):x},b.skipLZ=function(){var f;for(f=0;f<this.bitsAvailable;++f)if((this.word&2147483648>>>f)!==0)return this.word<<=f,this.bitsAvailable-=f,f;return this.loadWord(),f+this.skipLZ()},b.skipUEG=function(){this.skipBits(1+this.skipLZ())},b.skipEG=function(){this.skipBits(1+this.skipLZ())},b.readUEG=function(){var f=this.skipLZ();return this.readBits(f+1)-1},b.readEG=function(){var f=this.readUEG();return 1&f?1+f>>>1:-1*(f>>>1)},b.readBoolean=function(){return this.readBits(1)===1},b.readUByte=function(){return this.readBits(8)},b.readUShort=function(){return this.readBits(16)},b.readUInt=function(){return this.readBits(32)},b.skipScalingList=function(f){var g=8,x=8,E,_;for(E=0;E<f;E++)x!==0&&(_=this.readEG(),x=(g+_+256)%256),g=x===0?g:x},b.readSPS=function(){var f=0,g=0,x=0,E=0,_,I,O,P,N,G,U,z,$,W=this.readUByte.bind(this),le=this.readBits.bind(this),re=this.readUEG.bind(this),de=this.readBoolean.bind(this),me=this.skipBits.bind(this),ge=this.skipEG.bind(this),Ae=this.skipUEG.bind(this),Re=this.skipScalingList.bind(this);if(W(),_=W(),I=le(5),me(3),O=W(),Ae(),_===100||_===110||_===122||_===244||_===44||_===83||_===86||_===118||_===128){var ke=re();if(ke===3&&me(1),Ae(),Ae(),me(1),de())for(z=ke!==3?8:12,$=0;$<z;$++)de()&&($<6?Re(16):Re(64))}Ae();var be=re();if(be===0)re();else if(be===1)for(me(1),ge(),ge(),P=re(),$=0;$<P;$++)ge();Ae(),me(1),N=re(),G=re(),U=le(1),U===0&&me(1),me(1),de()&&(f=re(),g=re(),x=re(),E=re());var he=[1,1];if(de()&&de()){var Ke=W();switch(Ke){case 1:he=[1,1];break;case 2:he=[12,11];break;case 3:he=[10,11];break;case 4:he=[16,11];break;case 5:he=[40,33];break;case 6:he=[24,11];break;case 7:he=[20,11];break;case 8:he=[32,11];break;case 9:he=[80,33];break;case 10:he=[18,11];break;case 11:he=[15,11];break;case 12:he=[64,33];break;case 13:he=[160,99];break;case 14:he=[4,3];break;case 15:he=[3,2];break;case 16:he=[2,1];break;case 255:{he=[W()<<8|W(),W()<<8|W()];break}}}return{width:Math.ceil((N+1)*16-f*2-g*2),height:(2-U)*(G+1)*16-(U?2:4)*(x+E),pixelRatio:he}},b.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},m}(),Se=ce,Ue=function(){function m(y,f,g,x){this.decryptdata=g,this.discardEPB=x,this.decrypter=new L.default(y,f,{removePKCS7Padding:!1})}var b=m.prototype;return b.decryptBuffer=function(f,g){this.decrypter.decrypt(f,this.decryptdata.key.buffer,this.decryptdata.iv.buffer,g)},b.decryptAacSample=function(f,g,x,E){var _=f[g].unit,I=_.subarray(16,_.length-_.length%16),O=I.buffer.slice(I.byteOffset,I.byteOffset+I.length),P=this;this.decryptBuffer(O,function(N){N=new Uint8Array(N),_.set(N,16),E||P.decryptAacSamples(f,g+1,x)})},b.decryptAacSamples=function(f,g,x){for(;;g++){if(g>=f.length){x();return}if(!(f[g].unit.length<32)){var E=this.decrypter.isSync();if(this.decryptAacSample(f,g,x,E),!E)return}}},b.getAvcEncryptedData=function(f){for(var g=Math.floor((f.length-48)/160)*16+16,x=new Int8Array(g),E=0,_=32;_<=f.length-16;_+=160,E+=16)x.set(f.subarray(_,_+16),E);return x},b.getAvcDecryptedUnit=function(f,g){g=new Uint8Array(g);for(var x=0,E=32;E<=f.length-16;E+=160,x+=16)f.set(g.subarray(x,x+16),E);return f},b.decryptAvcSample=function(f,g,x,E,_,I){var O=this.discardEPB(_.data),P=this.getAvcEncryptedData(O),N=this;this.decryptBuffer(P.buffer,function(G){_.data=N.getAvcDecryptedUnit(O,G),I||N.decryptAvcSamples(f,g,x+1,E)})},b.decryptAvcSamples=function(f,g,x,E){for(;;g++,x=0){if(g>=f.length){E();return}for(var _=f[g].units;!(x>=_.length);x++){var I=_[x];if(!(I.data.length<=48||I.type!==1&&I.type!==5)){var O=this.decrypter.isSync();if(this.decryptAvcSample(f,g,x,E,I,O),!O)return}}}},m}(),Fe=Ue,Oe={video:1,audio:2,id3:3,text:4},ut=function(){function m(y,f,g,x){this.observer=y,this.config=g,this.typeSupported=x,this.remuxer=f,this.sampleAes=null,this.pmtUnknownTypes={}}var b=m.prototype;return b.setDecryptData=function(f){f!=null&&f.key!=null&&f.method==="SAMPLE-AES"?this.sampleAes=new Fe(this.observer,this.config,f,this.discardEPB):this.sampleAes=null},m.probe=function(f){var g=m._syncOffset(f);return g<0?!1:(g&&h.logger.warn("MPEG2-TS detected but first sync word found @ offset "+g+", junk ahead ?"),!0)},m._syncOffset=function(f){for(var g=Math.min(1e3,f.length-564),x=0;x<g;){if(f[x]===71&&f[x+188]===71&&f[x+2*188]===71)return x;x++}return-1},m.createTrack=function(f,g){return{container:f==="video"||f==="audio"?"video/mp2t":void 0,type:f,id:Oe[f],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:f==="video"?0:void 0,isAAC:f==="audio"?!0:void 0,duration:f==="audio"?g:void 0}},b.resetInitSegment=function(f,g,x,E){this.pmtParsed=!1,this._pmtId=-1,this.pmtUnknownTypes={},this._avcTrack=m.createTrack("video",E),this._audioTrack=m.createTrack("audio",E),this._id3Track=m.createTrack("id3",E),this._txtTrack=m.createTrack("text",E),this.aacOverFlow=null,this.aacLastPTS=null,this.avcSample=null,this.audioCodec=g,this.videoCodec=x,this._duration=E},b.resetTimeStamp=function(){},b.append=function(f,g,x,E){var _,I=f.length,O,P,N,G,U,z=!1;this.pmtUnknownTypes={},this.contiguous=x;var $=this.pmtParsed,W=this._avcTrack,le=this._audioTrack,re=this._id3Track,de=W.pid,me=le.pid,ge=re.pid,Ae=this._pmtId,Re=W.pesData,ke=le.pesData,be=re.pesData,he=this._parsePAT,Ke=this._parsePMT.bind(this),Xe=this._parsePES,Me=this._parseAVCPES.bind(this),ze=this._parseAACPES.bind(this),je=this._parseMPEGPES.bind(this),$e=this._parseID3PES.bind(this),We=m._syncOffset(f);for(I-=(I+We)%188,_=We;_<I;_+=188)if(f[_]===71){if(O=!!(f[_+1]&64),P=((f[_+1]&31)<<8)+f[_+2],N=(f[_+3]&48)>>4,N>1){if(G=_+5+f[_+4],G===_+188)continue}else G=_+4;switch(P){case de:O&&(Re&&(U=Xe(Re))&&Me(U,!1),Re={data:[],size:0}),Re&&(Re.data.push(f.subarray(G,_+188)),Re.size+=_+188-G);break;case me:O&&(ke&&(U=Xe(ke))&&(le.isAAC?ze(U):je(U)),ke={data:[],size:0}),ke&&(ke.data.push(f.subarray(G,_+188)),ke.size+=_+188-G);break;case ge:O&&(be&&(U=Xe(be))&&$e(U),be={data:[],size:0}),be&&(be.data.push(f.subarray(G,_+188)),be.size+=_+188-G);break;case 0:O&&(G+=f[G]+1),Ae=this._pmtId=he(f,G);break;case Ae:O&&(G+=f[G]+1);var Pe=Ke(f,G,this.typeSupported.mpeg===!0||this.typeSupported.mp3===!0,this.sampleAes!=null);de=Pe.avc,de>0&&(W.pid=de),me=Pe.audio,me>0&&(le.pid=me,le.isAAC=Pe.isAAC),ge=Pe.id3,ge>0&&(re.pid=ge),z&&!$&&(h.logger.log("reparse from beginning"),z=!1,_=We-188),$=this.pmtParsed=!0;break;case 17:case 8191:break;default:z=!0;break}}else this.observer.trigger(Q.default.ERROR,{type:X.ErrorTypes.MEDIA_ERROR,details:X.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"TS packet did not start with 0x47"});Re&&(U=Xe(Re))?(Me(U,!0),W.pesData=null):W.pesData=Re,ke&&(U=Xe(ke))?(le.isAAC?ze(U):je(U),le.pesData=null):(ke&&ke.size&&h.logger.log("last AAC PES packet truncated,might overlap between fragments"),le.pesData=ke),be&&(U=Xe(be))?($e(U),re.pesData=null):re.pesData=be,this.sampleAes==null?this.remuxer.remux(le,W,re,this._txtTrack,g,x,E):this.decryptAndRemux(le,W,re,this._txtTrack,g,x,E)},b.decryptAndRemux=function(f,g,x,E,_,I,O){if(f.samples&&f.isAAC){var P=this;this.sampleAes.decryptAacSamples(f.samples,0,function(){P.decryptAndRemuxAvc(f,g,x,E,_,I,O)})}else this.decryptAndRemuxAvc(f,g,x,E,_,I,O)},b.decryptAndRemuxAvc=function(f,g,x,E,_,I,O){if(g.samples){var P=this;this.sampleAes.decryptAvcSamples(g.samples,0,0,function(){P.remuxer.remux(f,g,x,E,_,I,O)})}else this.remuxer.remux(f,g,x,E,_,I,O)},b.destroy=function(){this._initPTS=this._initDTS=void 0,this._duration=0},b._parsePAT=function(f,g){return(f[g+10]&31)<<8|f[g+11]},b._trackUnknownPmt=function(f,g,x){var E=this.pmtUnknownTypes[f]||0;return E===0&&(this.pmtUnknownTypes[f]=0,g.call(h.logger,x)),this.pmtUnknownTypes[f]++,E},b._parsePMT=function(f,g,x,E){var _,I,O,P,N={audio:-1,avc:-1,id3:-1,isAAC:!0};for(_=(f[g+1]&15)<<8|f[g+2],I=g+3+_-4,O=(f[g+10]&15)<<8|f[g+11],g+=12+O;g<I;){switch(P=(f[g+1]&31)<<8|f[g+2],f[g]){case 207:if(!E){this._trackUnknownPmt(f[g],h.logger.warn,"ADTS AAC with AES-128-CBC frame encryption found in unencrypted stream");break}case 15:N.audio===-1&&(N.audio=P);break;case 21:N.id3===-1&&(N.id3=P);break;case 219:if(!E){this._trackUnknownPmt(f[g],h.logger.warn,"H.264 with AES-128-CBC slice encryption found in unencrypted stream");break}case 27:N.avc===-1&&(N.avc=P);break;case 3:case 4:x?N.audio===-1&&(N.audio=P,N.isAAC=!1):this._trackUnknownPmt(f[g],h.logger.warn,"MPEG audio found, not supported in this browser");break;case 36:this._trackUnknownPmt(f[g],h.logger.warn,"Unsupported HEVC stream type found");break;default:this._trackUnknownPmt(f[g],h.logger.log,"Unknown stream type:"+f[g]);break}g+=((f[g+3]&15)<<8|f[g+4])+5}return N},b._parsePES=function(f){var g=0,x,E,_,I,O,P,N,G,U,z=f.data;if(!f||f.size===0)return null;for(;z[0].length<19&&z.length>1;){var $=new Uint8Array(z[0].length+z[1].length);$.set(z[0]),$.set(z[1],z[0].length),z[0]=$,z.splice(1,1)}if(x=z[0],_=(x[0]<<16)+(x[1]<<8)+x[2],_===1){if(I=(x[4]<<8)+x[5],I&&I>f.size-6||(E=x[7],E&192&&(N=(x[9]&14)*536870912+(x[10]&255)*4194304+(x[11]&254)*16384+(x[12]&255)*128+(x[13]&254)/2,E&64?(G=(x[14]&14)*536870912+(x[15]&255)*4194304+(x[16]&254)*16384+(x[17]&255)*128+(x[18]&254)/2,N-G>60*9e4&&(h.logger.warn(Math.round((N-G)/9e4)+"s delta between PTS and DTS, align them"),N=G)):G=N),O=x[8],U=O+9,f.size<=U))return null;f.size-=U,P=new Uint8Array(f.size);for(var W=0,le=z.length;W<le;W++){x=z[W];var re=x.byteLength;if(U)if(U>re){U-=re;continue}else x=x.subarray(U),re-=U,U=0;P.set(x,g),g+=re}return I&&(I-=O+3),{data:P,pts:N,dts:G,len:I}}else return null},b.pushAccesUnit=function(f,g){if(f.units.length&&f.frame){var x=g.samples,E=x.length;if(isNaN(f.pts))if(E){var _=x[E-1];f.pts=_.pts,f.dts=_.dts}else{g.dropped++;return}!this.config.forceKeyFrameOnDiscontinuity||f.key===!0||g.sps&&(E||this.contiguous)?(f.id=E,x.push(f)):g.dropped++}f.debug.length&&h.logger.log(f.pts+"/"+f.dts+":"+f.debug)},b._parseAVCPES=function(f,g){var x=this,E=this._avcTrack,_=this._parseAVCNALu(f.data),I=!1,O,P=this.avcSample,N,G=!1,U,z=this.pushAccesUnit.bind(this),$=function(le,re,de,me){return{key:le,pts:re,dts:de,units:[],debug:me}};f.data=null,P&&_.length&&!E.audFound&&(z(P,E),P=this.avcSample=$(!1,f.pts,f.dts,"")),_.forEach(function(W){switch(W.type){case 1:N=!0,P||(P=x.avcSample=$(!0,f.pts,f.dts,"")),I&&(P.debug+="NDR "),P.frame=!0;var le=W.data;if(G&&le.length>4){var re=new Se(le).readSliceType();(re===2||re===4||re===7||re===9)&&(P.key=!0)}break;case 5:N=!0,P||(P=x.avcSample=$(!0,f.pts,f.dts,"")),I&&(P.debug+="IDR "),P.key=!0,P.frame=!0;break;case 6:N=!0,I&&P&&(P.debug+="SEI "),O=new Se(x.discardEPB(W.data)),O.readUByte();for(var de=0,me=0,ge=!1,Ae=0;!ge&&O.bytesAvailable>1;){de=0;do Ae=O.readUByte(),de+=Ae;while(Ae===255);me=0;do Ae=O.readUByte(),me+=Ae;while(Ae===255);if(de===4&&O.bytesAvailable!==0){ge=!0;var Re=O.readUByte();if(Re===181){var ke=O.readUShort();if(ke===49){var be=O.readUInt();if(be===1195456820){var he=O.readUByte();if(he===3){var Ke=O.readUByte(),Xe=O.readUByte(),Me=31&Ke,ze=[Ke,Xe];for(U=0;U<Me;U++)ze.push(O.readUByte()),ze.push(O.readUByte()),ze.push(O.readUByte());x._insertSampleInOrder(x._txtTrack.samples,{type:3,pts:f.pts,bytes:ze})}}}}}else if(de===5&&O.bytesAvailable!==0){if(ge=!0,me>16){var je=[];for(U=0;U<16;U++)je.push(O.readUByte().toString(16)),(U===3||U===5||U===7||U===9)&&je.push("-");var $e=me-16,We=new Uint8Array($e);for(U=0;U<$e;U++)We[U]=O.readUByte();x._insertSampleInOrder(x._txtTrack.samples,{pts:f.pts,payloadType:de,uuid:je.join(""),userDataBytes:We,userData:Object(j.utf8ArrayToStr)(We.buffer)})}}else if(me<O.bytesAvailable)for(U=0;U<me;U++)O.readUByte()}break;case 7:if(N=!0,G=!0,I&&P&&(P.debug+="SPS "),!E.sps){O=new Se(W.data);var Pe=O.readSPS();E.width=Pe.width,E.height=Pe.height,E.pixelRatio=Pe.pixelRatio,E.sps=[W.data],E.duration=x._duration;var nt=W.data.subarray(1,4),xt="avc1.";for(U=0;U<3;U++){var st=nt[U].toString(16);st.length<2&&(st="0"+st),xt+=st}E.codec=xt}break;case 8:N=!0,I&&P&&(P.debug+="PPS "),E.pps||(E.pps=[W.data]);break;case 9:N=!1,E.audFound=!0,P&&z(P,E),P=x.avcSample=$(!1,f.pts,f.dts,I?"AUD ":"");break;case 12:N=!1;break;default:N=!1,P&&(P.debug+="unknown NAL "+W.type+" ");break}if(P&&N){var Ve=P.units;Ve.push(W)}}),g&&P&&(z(P,E),this.avcSample=null)},b._insertSampleInOrder=function(f,g){var x=f.length;if(x>0){if(g.pts>=f[x-1].pts)f.push(g);else for(var E=x-1;E>=0;E--)if(g.pts<f[E].pts){f.splice(E,0,g);break}}else f.push(g)},b._getLastNalUnit=function(){var f=this.avcSample,g;if(!f||f.units.length===0){var x=this._avcTrack,E=x.samples;f=E[E.length-1]}if(f){var _=f.units;g=_[_.length-1]}return g},b._parseAVCNALu=function(f){var g=0,x=f.byteLength,E,_,I=this._avcTrack,O=I.naluState||0,P=O,N=[],G,U,z=-1,$;for(O===-1&&(z=0,$=f[0]&31,O=0,g=1);g<x;){if(E=f[g++],!O){O=E?0:1;continue}if(O===1){O=E?0:2;continue}if(!E)O=3;else if(E===1){if(z>=0)G={data:f.subarray(z,g-O-1),type:$},N.push(G);else{var W=this._getLastNalUnit();if(W&&(P&&g<=4-P&&W.state&&(W.data=W.data.subarray(0,W.data.byteLength-P)),_=g-O-1,_>0)){var le=new Uint8Array(W.data.byteLength+_);le.set(W.data,0),le.set(f.subarray(0,_),W.data.byteLength),W.data=le}}g<x?(U=f[g]&31,z=g,$=U,O=0):O=-1}else O=0}if(z>=0&&O>=0&&(G={data:f.subarray(z,x),type:$,state:O},N.push(G)),N.length===0){var re=this._getLastNalUnit();if(re){var de=new Uint8Array(re.data.byteLength+f.byteLength);de.set(re.data,0),de.set(f,re.data.byteLength),re.data=de}}return I.naluState=O,N},b.discardEPB=function(f){for(var g=f.byteLength,x=[],E=1,_,I;E<g-2;)f[E]===0&&f[E+1]===0&&f[E+2]===3?(x.push(E+2),E+=2):E++;if(x.length===0)return f;_=g-x.length,I=new Uint8Array(_);var O=0;for(E=0;E<_;O++,E++)O===x[0]&&(O++,x.shift()),I[E]=f[O];return I},b._parseAACPES=function(f){var g=this._audioTrack,x=f.data,E=f.pts,_=0,I=this.aacOverFlow,O=this.aacLastPTS,P,N,G,U,z;if(I){var $=new Uint8Array(I.byteLength+x.byteLength);$.set(I,0),$.set(x,I.byteLength),x=$}for(G=_,z=x.length;G<z-1&&!R(x,G);G++);if(G){var W,le;if(G<z-1?(W="AAC PES did not start with ADTS header,offset:"+G,le=!1):(W="no ADTS header found in AAC PES",le=!0),h.logger.warn("parsing error:"+W),this.observer.trigger(Q.default.ERROR,{type:X.ErrorTypes.MEDIA_ERROR,details:X.ErrorDetails.FRAG_PARSING_ERROR,fatal:le,reason:W}),le)return}if(M(g,this.observer,x,G,this.audioCodec),N=0,P=k(g.samplerate),I&&O){var re=O+P;Math.abs(re-E)>1&&(h.logger.log("AAC: align PTS for overlapping frames by "+Math.round((re-E)/90)),E=re)}for(;G<z;)if(R(x,G)){if(G+5<z){var de=K(g,x,G,E,N);if(de){G+=de.length,U=de.sample.pts,N++;continue}}break}else G++;G<z?I=x.subarray(G,z):I=null,this.aacOverFlow=I,this.aacLastPTS=U},b._parseMPEGPES=function(f){for(var g=f.data,x=g.length,E=0,_=0,I=f.pts;_<x;)if(ve.isHeader(g,_)){var O=ve.appendFrame(this._audioTrack,g,_,I,E);if(O)_+=O.length,E++;else break}else _++},b._parseID3PES=function(f){this._id3Track.samples.push(f)},m}(),Le=ut,Be=function(){function m(y,f,g){this.observer=y,this.config=g,this.remuxer=f}var b=m.prototype;return b.resetInitSegment=function(f,g,x,E){this._audioTrack={container:"audio/mpeg",type:"audio",id:-1,sequenceNumber:0,isAAC:!1,samples:[],len:0,manifestCodec:g,duration:E,inputTimeScale:9e4}},b.resetTimeStamp=function(){},m.probe=function(f){var g,x,E=j.default.getID3Data(f,0);if(E&&j.default.getTimeStamp(E)!==void 0){for(g=E.length,x=Math.min(f.length-1,g+100);g<x;g++)if(ve.probe(f,g))return h.logger.log("MPEG Audio sync word found !"),!0}return!1},b.append=function(f,g,x,E){for(var _=j.default.getID3Data(f,0)||[],I=j.default.getTimeStamp(_),O=I!==void 0?90*I:g*9e4,P=_.length,N=f.length,G=0,U=0,z=this._audioTrack,$=[{pts:O,dts:O,data:_}];P<N;)if(ve.isHeader(f,P)){var W=ve.appendFrame(z,f,P,O,G);if(W)P+=W.length,U=W.sample.pts,G++;else break}else j.default.isHeader(f,P)?(_=j.default.getID3Data(f,P),$.push({pts:U,dts:U,data:_}),P+=_.length):P++;this.remuxer.remux(z,{samples:[]},{samples:$,inputTimeScale:9e4},{samples:[]},g,x,E)},b.destroy=function(){},m}(),Ye=Be,Ge=function(){function m(){}return m.getSilentFrame=function(y,f){switch(y){case"mp4a.40.2":if(f===1)return new Uint8Array([0,200,0,128,35,128]);if(f===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(f===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(f===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(f===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(f===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(f===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(f===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(f===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}return null},m}(),Ce=Ge,De=Math.pow(2,32)-1,pe=function(){function m(){}return m.init=function(){m.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};var y;for(y in m.types)m.types.hasOwnProperty(y)&&(m.types[y]=[y.charCodeAt(0),y.charCodeAt(1),y.charCodeAt(2),y.charCodeAt(3)]);var f=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),g=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);m.HDLR_TYPES={video:f,audio:g};var x=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),E=new Uint8Array([0,0,0,0,0,0,0,0]);m.STTS=m.STSC=m.STCO=E,m.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),m.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),m.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),m.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var _=new Uint8Array([105,115,111,109]),I=new Uint8Array([97,118,99,49]),O=new Uint8Array([0,0,0,1]);m.FTYP=m.box(m.types.ftyp,_,O,_,I),m.DINF=m.box(m.types.dinf,m.box(m.types.dref,x))},m.box=function(y){for(var f=Array.prototype.slice.call(arguments,1),g=8,x=f.length,E=x,_;x--;)g+=f[x].byteLength;for(_=new Uint8Array(g),_[0]=g>>24&255,_[1]=g>>16&255,_[2]=g>>8&255,_[3]=g&255,_.set(y,4),x=0,g=8;x<E;x++)_.set(f[x],g),g+=f[x].byteLength;return _},m.hdlr=function(y){return m.box(m.types.hdlr,m.HDLR_TYPES[y])},m.mdat=function(y){return m.box(m.types.mdat,y)},m.mdhd=function(y,f){f*=y;var g=Math.floor(f/(De+1)),x=Math.floor(f%(De+1));return m.box(m.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,y>>24&255,y>>16&255,y>>8&255,y&255,g>>24,g>>16&255,g>>8&255,g&255,x>>24,x>>16&255,x>>8&255,x&255,85,196,0,0]))},m.mdia=function(y){return m.box(m.types.mdia,m.mdhd(y.timescale,y.duration),m.hdlr(y.type),m.minf(y))},m.mfhd=function(y){return m.box(m.types.mfhd,new Uint8Array([0,0,0,0,y>>24,y>>16&255,y>>8&255,y&255]))},m.minf=function(y){return y.type==="audio"?m.box(m.types.minf,m.box(m.types.smhd,m.SMHD),m.DINF,m.stbl(y)):m.box(m.types.minf,m.box(m.types.vmhd,m.VMHD),m.DINF,m.stbl(y))},m.moof=function(y,f,g){return m.box(m.types.moof,m.mfhd(y),m.traf(g,f))},m.moov=function(y){for(var f=y.length,g=[];f--;)g[f]=m.trak(y[f]);return m.box.apply(null,[m.types.moov,m.mvhd(y[0].timescale,y[0].duration)].concat(g).concat(m.mvex(y)))},m.mvex=function(y){for(var f=y.length,g=[];f--;)g[f]=m.trex(y[f]);return m.box.apply(null,[m.types.mvex].concat(g))},m.mvhd=function(y,f){f*=y;var g=Math.floor(f/(De+1)),x=Math.floor(f%(De+1)),E=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,y>>24&255,y>>16&255,y>>8&255,y&255,g>>24,g>>16&255,g>>8&255,g&255,x>>24,x>>16&255,x>>8&255,x&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return m.box(m.types.mvhd,E)},m.sdtp=function(y){var f=y.samples||[],g=new Uint8Array(4+f.length),x,E;for(E=0;E<f.length;E++)x=f[E].flags,g[E+4]=x.dependsOn<<4|x.isDependedOn<<2|x.hasRedundancy;return m.box(m.types.sdtp,g)},m.stbl=function(y){return m.box(m.types.stbl,m.stsd(y),m.box(m.types.stts,m.STTS),m.box(m.types.stsc,m.STSC),m.box(m.types.stsz,m.STSZ),m.box(m.types.stco,m.STCO))},m.avc1=function(y){var f=[],g=[],x,E,_;for(x=0;x<y.sps.length;x++)E=y.sps[x],_=E.byteLength,f.push(_>>>8&255),f.push(_&255),f=f.concat(Array.prototype.slice.call(E));for(x=0;x<y.pps.length;x++)E=y.pps[x],_=E.byteLength,g.push(_>>>8&255),g.push(_&255),g=g.concat(Array.prototype.slice.call(E));var I=m.box(m.types.avcC,new Uint8Array([1,f[3],f[4],f[5],255,224|y.sps.length].concat(f).concat([y.pps.length]).concat(g))),O=y.width,P=y.height,N=y.pixelRatio[0],G=y.pixelRatio[1];return m.box(m.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,O>>8&255,O&255,P>>8&255,P&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),I,m.box(m.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),m.box(m.types.pasp,new Uint8Array([N>>24,N>>16&255,N>>8&255,N&255,G>>24,G>>16&255,G>>8&255,G&255])))},m.esds=function(y){var f=y.config.length;return new Uint8Array([0,0,0,0,3,23+f,0,1,0,4,15+f,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([f]).concat(y.config).concat([6,1,2]))},m.mp4a=function(y){var f=y.samplerate;return m.box(m.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,y.channelCount,0,16,0,0,0,0,f>>8&255,f&255,0,0]),m.box(m.types.esds,m.esds(y)))},m.mp3=function(y){var f=y.samplerate;return m.box(m.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,y.channelCount,0,16,0,0,0,0,f>>8&255,f&255,0,0]))},m.stsd=function(y){return y.type==="audio"?!y.isAAC&&y.codec==="mp3"?m.box(m.types.stsd,m.STSD,m.mp3(y)):m.box(m.types.stsd,m.STSD,m.mp4a(y)):m.box(m.types.stsd,m.STSD,m.avc1(y))},m.tkhd=function(y){var f=y.id,g=y.duration*y.timescale,x=y.width,E=y.height,_=Math.floor(g/(De+1)),I=Math.floor(g%(De+1));return m.box(m.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,f>>24&255,f>>16&255,f>>8&255,f&255,0,0,0,0,_>>24,_>>16&255,_>>8&255,_&255,I>>24,I>>16&255,I>>8&255,I&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,x>>8&255,x&255,0,0,E>>8&255,E&255,0,0]))},m.traf=function(y,f){var g=m.sdtp(y),x=y.id,E=Math.floor(f/(De+1)),_=Math.floor(f%(De+1));return m.box(m.types.traf,m.box(m.types.tfhd,new Uint8Array([0,0,0,0,x>>24,x>>16&255,x>>8&255,x&255])),m.box(m.types.tfdt,new Uint8Array([1,0,0,0,E>>24,E>>16&255,E>>8&255,E&255,_>>24,_>>16&255,_>>8&255,_&255])),m.trun(y,g.length+16+20+8+16+8+8),g)},m.trak=function(y){return y.duration=y.duration||4294967295,m.box(m.types.trak,m.tkhd(y),m.mdia(y))},m.trex=function(y){var f=y.id;return m.box(m.types.trex,new Uint8Array([0,0,0,0,f>>24,f>>16&255,f>>8&255,f&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},m.trun=function(y,f){var g=y.samples||[],x=g.length,E=12+16*x,_=new Uint8Array(E),I,O,P,N,G,U;for(f+=8+E,_.set([0,0,15,1,x>>>24&255,x>>>16&255,x>>>8&255,x&255,f>>>24&255,f>>>16&255,f>>>8&255,f&255],0),I=0;I<x;I++)O=g[I],P=O.duration,N=O.size,G=O.flags,U=O.cts,_.set([P>>>24&255,P>>>16&255,P>>>8&255,P&255,N>>>24&255,N>>>16&255,N>>>8&255,N&255,G.isLeading<<2|G.dependsOn,G.isDependedOn<<6|G.hasRedundancy<<4|G.paddingValue<<1|G.isNonSync,G.degradPrio&240<<8,G.degradPrio&15,U>>>24&255,U>>>16&255,U>>>8&255,U&255],12+16*I);return m.box(m.types.trun,_)},m.initSegment=function(y){m.types||m.init();var f=m.moov(y),g;return g=new Uint8Array(m.FTYP.byteLength+f.byteLength),g.set(m.FTYP),g.set(f,m.FTYP.byteLength),g},m}(),Je=pe,we=9e4;function _t(m,b,y,f){return y===void 0&&(y=1),f===void 0&&(f=!1),vt(m,b,1/y)}function vt(m,b,y,f){y===void 0&&(y=1),f===void 0&&(f=!1);var g=m*b*y;return f?Math.round(g):g}function _e(m,b){return b===void 0&&(b=!1),vt(m,1e3,1/we,b)}function tt(m,b){return b===void 0&&(b=1),vt(m,we,1/b)}var rt=tt(10),at=tt(.2),pt=null,At=function(){function m(y,f,g,x){if(this.observer=y,this.config=f,this.typeSupported=g,this.ISGenerated=!1,pt===null){var E=navigator.userAgent.match(/Chrome\/(\d+)/i);pt=E?parseInt(E[1]):0}}var b=m.prototype;return b.destroy=function(){},b.resetTimeStamp=function(f){this._initPTS=this._initDTS=f},b.resetInitSegment=function(){this.ISGenerated=!1},b.getVideoStartPts=function(f){var g=!1,x=f.reduce(function(E,_){var I=_.pts-E;return I<-4294967296?(g=!0,et(E,_.pts)):I>0?E:_.pts},f[0].pts);return g&&h.logger.debug("PTS rollover detected"),x},b.remux=function(f,g,x,E,_,I,O){if(this.ISGenerated||this.generateIS(f,g,_),this.ISGenerated){var P=f.samples.length,N=g.samples.length,G=_,U=_;if(P&&N){var z=this.getVideoStartPts(g.samples),$=et(f.samples[0].pts,z)-z,W=$/g.inputTimeScale;G+=Math.max(0,W),U+=Math.max(0,-W)}if(P){f.timescale||(h.logger.warn("regenerate InitSegment as audio detected"),this.generateIS(f,g,_));var le=this.remuxAudio(f,G,I,O);if(N){var re;le&&(re=le.endPTS-le.startPTS),g.timescale||(h.logger.warn("regenerate InitSegment as video detected"),this.generateIS(f,g,_)),this.remuxVideo(g,U,I,re)}}else if(N){var de=this.remuxVideo(g,U,I,0,O);de&&f.codec&&this.remuxEmptyAudio(f,G,I,de)}}x.samples.length&&this.remuxID3(x,_),E.samples.length&&this.remuxText(E,_),this.observer.trigger(Q.default.FRAG_PARSED)},b.generateIS=function(f,g,x){var E=this.observer,_=f.samples,I=g.samples,O=this.typeSupported,P="audio/mp4",N={},G={tracks:N},U=this._initPTS===void 0,z,$;if(U&&(z=$=1/0),f.config&&_.length&&(f.timescale=f.samplerate,h.logger.log("audio sampling rate : "+f.samplerate),f.isAAC||(O.mpeg?(P="audio/mpeg",f.codec=""):O.mp3&&(f.codec="mp3")),N.audio={container:P,codec:f.codec,initSegment:!f.isAAC&&O.mpeg?new Uint8Array:Je.initSegment([f]),metadata:{channelCount:f.channelCount}},U&&(z=$=_[0].pts-Math.round(f.inputTimeScale*x))),g.sps&&g.pps&&I.length){var W=g.inputTimeScale;if(g.timescale=W,N.video={container:"video/mp4",codec:g.codec,initSegment:Je.initSegment([g]),metadata:{width:g.width,height:g.height}},U){var le=this.getVideoStartPts(I),re=Math.round(W*x);$=Math.min($,et(I[0].dts,le)-re),z=Math.min(z,le-re),this.observer.trigger(Q.default.INIT_PTS_FOUND,{initPTS:z})}}else U&&N.audio&&this.observer.trigger(Q.default.INIT_PTS_FOUND,{initPTS:z});Object.keys(N).length?(E.trigger(Q.default.FRAG_PARSING_INIT_SEGMENT,G),this.ISGenerated=!0,U&&(this._initPTS=z,this._initDTS=$)):E.trigger(Q.default.ERROR,{type:X.ErrorTypes.MEDIA_ERROR,details:X.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"no audio/video samples found"})},b.remuxVideo=function(f,g,x,E){var _=f.timescale,I=f.samples,O=[],P=I.length,N=this._initPTS,G=8,U,z,$,W,le,re=Number.POSITIVE_INFINITY,de=Number.NEGATIVE_INFINITY,me=0,ge=!1,Ae=this.nextAvcDts;if(P!==0){if(!x){var Re=g*_,ke=I[0].pts-et(I[0].dts,I[0].pts);Ae=Re-ke}for(var be=0;be<P;be++){var he=I[be];he.pts=et(he.pts-N,Ae),he.dts=et(he.dts-N,Ae),he.dts>he.pts&&(me=Math.max(Math.min(me,he.pts-he.dts),-1*at)),he.dts<I[be>0?be-1:be].dts&&(ge=!0)}ge&&I.sort(function(Ct,Kt){var sr=Ct.dts-Kt.dts,Zt=Ct.pts-Kt.pts;return sr||Zt||Ct.id-Kt.id}),W=I[0].dts,le=I[P-1].dts;var Ke=Math.round((le-W)/(P-1));if(me<0){if(me<Ke*-2){h.logger.warn("PTS < DTS detected in video samples, offsetting DTS from PTS by "+_e(-Ke,!0)+" ms");for(var Xe=me,Me=0;Me<P;Me++)I[Me].dts=Xe=Math.max(Xe,I[Me].pts-Ke),I[Me].pts=Math.max(Xe,I[Me].pts)}else{h.logger.warn("PTS < DTS detected in video samples, shifting DTS by "+_e(me,!0)+" ms to overcome this issue");for(var ze=0;ze<P;ze++)I[ze].dts=I[ze].dts+me}W=I[0].dts,le=I[P-1].dts}if(x){var je=W-Ae,$e=je>Ke,We=je<-1;if($e||We){$e?h.logger.warn("AVC: "+_e(je,!0)+" ms ("+je+"dts) hole between fragments detected, filling it"):h.logger.warn("AVC: "+_e(-je,!0)+" ms ("+je+"dts) overlapping between fragments detected"),W=Ae;var Pe=I[0].pts-je;I[0].dts=W,I[0].pts=Pe,h.logger.log("Video: First PTS/DTS adjusted: "+_e(Pe,!0)+"/"+_e(W,!0)+", delta: "+_e(je,!0)+" ms")}}pt&&pt<75&&(W=Math.max(0,W));for(var nt=0,xt=0,st=0;st<P;st++){for(var Ve=I[st],ft=Ve.units,dt=ft.length,ht=0,bt=0;bt<dt;bt++)ht+=ft[bt].data.length;xt+=ht,nt+=dt,Ve.length=ht,Ve.dts=Math.max(Ve.dts,W),Ve.pts=Math.max(Ve.pts,Ve.dts,0),re=Math.min(Ve.pts,re),de=Math.max(Ve.pts,de)}le=I[P-1].dts;var C=xt+4*nt+8;try{z=new Uint8Array(C)}catch(Ct){this.observer.trigger(Q.default.ERROR,{type:X.ErrorTypes.MUX_ERROR,details:X.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:C,reason:"fail allocating video mdat "+C});return}var yt=new DataView(z.buffer);yt.setUint32(0,C),z.set(Je.types.mdat,4);for(var it=0;it<P;it++){for(var ot=I[it],Lt=ot.units,Dt=0,ct=void 0,Bt=0,Yt=Lt.length;Bt<Yt;Bt++){var Xt=Lt[Bt],ar=Xt.data,Ot=Xt.data.byteLength;yt.setUint32(G,Ot),G+=4,z.set(ar,G),G+=Ot,Dt+=4+Ot}if(it<P-1)U=I[it+1].dts-ot.dts;else{var zt=this.config,St=ot.dts-I[it>0?it-1:it].dts;if(zt.stretchShortVideoTrack){var qt=zt.maxBufferHole,It=Math.floor(qt*_),Gt=(E?re+E*_:this.nextAudioPts)-ot.pts;Gt>It?(U=Gt-St,U<0&&(U=St),h.logger.log("It is approximately "+_e(Gt,!1)+" ms to the next segment; using duration "+_e(U,!1)+" ms for the last video frame.")):U=St}else U=St}ct=Math.round(ot.pts-ot.dts),O.push({size:Dt,duration:U,cts:ct,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:ot.key?2:1,isNonSync:ot.key?0:1}})}this.nextAvcDts=le+U;var nr=f.dropped;if(f.nbNalu=0,f.dropped=0,O.length&&navigator.userAgent.toLowerCase().indexOf("chrome")>-1){var Qt=O[0].flags;Qt.dependsOn=2,Qt.isNonSync=0}f.samples=O,$=Je.moof(f.sequenceNumber++,W,f),f.samples=[];var $t={data1:$,data2:z,startPTS:re/_,endPTS:(de+U)/_,startDTS:W/_,endDTS:this.nextAvcDts/_,type:"video",hasAudio:!1,hasVideo:!0,nb:O.length,dropped:nr};return this.observer.trigger(Q.default.FRAG_PARSING_DATA,$t),$t}},b.remuxAudio=function(f,g,x,E){var _=f.inputTimeScale,I=f.timescale,O=_/I,P=f.isAAC?1024:1152,N=P*O,G=this._initPTS,U=!f.isAAC&&this.typeSupported.mpeg,z,$,W,le,re,de,me=U?0:8,ge=f.samples,Ae=[],Re=this.nextAudioPts;if(x|=ge.length&&Re&&(E&&Math.abs(g-Re/_)<.1||Math.abs(ge[0].pts-Re-G)<20*N),ge.forEach(function(ct){ct.pts=ct.dts=et(ct.pts-G,g*_)}),ge=ge.filter(function(ct){return ct.pts>=0}),ge.length!==0){if(x||(E?Re=Math.max(0,g*_):Re=ge[0].pts),f.isAAC)for(var ke=this.config.maxAudioFramesDrift,be=0,he=Re;be<ge.length;){var Ke=ge[be],Xe=Ke.pts,Me=Xe-he;if(Me<=-ke*N)x||be>0?(h.logger.warn("Dropping 1 audio frame @ "+_e(he,!0)/1e3+"s due to "+_e(Me,!0)+" ms overlap."),ge.splice(be,1)):(h.logger.warn("Audio frame @ "+_e(Xe,!0)/1e3+"s overlaps nextAudioPts by "+_e(Me,!0)+" ms."),he=Xe+N,be++);else if(Me>=ke*N&&Me<rt&&he){var ze=Math.round(Me/N);h.logger.warn("Injecting "+ze+" audio frames @ "+_e(he,!0)/1e3+"s due to "+_e(Me,!0)+" ms gap.");for(var je=0;je<ze;je++){var $e=Math.max(he,0);$=Ce.getSilentFrame(f.manifestCodec||f.codec,f.channelCount),$||(h.logger.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),$=Ke.unit.subarray()),ge.splice(be,0,{unit:$,pts:$e,dts:$e}),he+=N,be++}Ke.pts=Ke.dts=he,he+=N,be++}else Math.abs(Me)>.1*N,Ke.pts=Ke.dts=he,he+=N,be++}for(var We=ge.length,Pe=0;We--;)Pe+=ge[We].unit.byteLength;for(var nt=0,xt=ge.length;nt<xt;nt++){var st=ge[nt],Ve=st.unit,ft=st.pts;if(de!==void 0&&z)z.duration=Math.round((ft-de)/O);else{var dt=ft-Re,ht=0;if(x&&f.isAAC&&dt){if(dt>0&&dt<rt)ht=Math.round((ft-Re)/N),h.logger.log(_e(dt,!0)+" ms hole between AAC samples detected,filling it"),ht>0&&($=Ce.getSilentFrame(f.manifestCodec||f.codec,f.channelCount),$||($=Ve.subarray()),Pe+=ht*$.length);else if(dt<-12){h.logger.log("drop overlapping AAC sample, expected/parsed/delta: "+_e(Re,!0)+" ms / "+_e(ft,!0)+" ms / "+_e(-dt,!0)+" ms"),Pe-=Ve.byteLength;continue}ft=Re}if(re=ft,Pe>0){Pe+=me;try{W=new Uint8Array(Pe)}catch(ct){this.observer.trigger(Q.default.ERROR,{type:X.ErrorTypes.MUX_ERROR,details:X.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:Pe,reason:"fail allocating audio mdat "+Pe});return}if(!U){var bt=new DataView(W.buffer);bt.setUint32(0,Pe),W.set(Je.types.mdat,4)}}else return;for(var C=0;C<ht;C++)$=Ce.getSilentFrame(f.manifestCodec||f.codec,f.channelCount),$||(h.logger.log("Unable to get silent frame for given audio codec; duplicating this frame instead."),$=Ve.subarray()),W.set($,me),me+=$.byteLength,z={size:$.byteLength,cts:0,duration:1024,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},Ae.push(z)}W.set(Ve,me);var yt=Ve.byteLength;me+=yt,z={size:yt,cts:0,duration:0,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},Ae.push(z),de=ft}var it=0;if(We=Ae.length,We>=2&&(it=Ae[We-2].duration,z.duration=it),We){this.nextAudioPts=Re=de+O*it,f.samples=Ae,U?le=new Uint8Array:le=Je.moof(f.sequenceNumber++,re/O,f),f.samples=[];var ot=re/_,Lt=Re/_,Dt={data1:le,data2:W,startPTS:ot,endPTS:Lt,startDTS:ot,endDTS:Lt,type:"audio",hasAudio:!0,hasVideo:!1,nb:We};return this.observer.trigger(Q.default.FRAG_PARSING_DATA,Dt),Dt}return null}},b.remuxEmptyAudio=function(f,g,x,E){var _=f.inputTimeScale,I=f.samplerate?f.samplerate:_,O=_/I,P=this.nextAudioPts,N=(P!==void 0?P:E.startDTS*_)+this._initDTS,G=E.endDTS*_+this._initDTS,U=1024,z=O*U,$=Math.ceil((G-N)/z),W=Ce.getSilentFrame(f.manifestCodec||f.codec,f.channelCount);if(h.logger.warn("remux empty Audio"),!W){h.logger.trace("Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec!");return}for(var le=[],re=0;re<$;re++){var de=N+re*z;le.push({unit:W,pts:de,dts:de})}f.samples=le,this.remuxAudio(f,g,x)},b.remuxID3=function(f,g){var x=f.samples.length;if(!!x){for(var E=f.inputTimeScale,_=this._initPTS,I=this._initDTS,O=0;O<x;O++){var P=f.samples[O];P.pts=et(P.pts-_,g*E)/E,P.dts=et(P.dts-I,g*E)/E}this.observer.trigger(Q.default.FRAG_PARSING_METADATA,{samples:f.samples}),f.samples=[]}},b.remuxText=function(f,g){var x=f.samples.length,E=f.inputTimeScale,_=this._initPTS;if(x){for(var I=0;I<x;I++){var O=f.samples[I];O.pts=et(O.pts-_,g*E)/E}f.samples.sort(function(P,N){return P.pts-N.pts}),this.observer.trigger(Q.default.FRAG_PARSING_USERDATA,{samples:f.samples})}f.samples=[]},m}();function et(m,b){var y;if(b===void 0)return m;for(b<m?y=-8589934592:y=8589934592;Math.abs(m-b)>4294967296;)m+=y;return m}var mt=At,Qe=function(){function m(y){this.observer=y}var b=m.prototype;return b.destroy=function(){},b.resetTimeStamp=function(){},b.resetInitSegment=function(){},b.remux=function(f,g,x,E,_,I,O,P){var N=this.observer,G="";f&&(G+="audio"),g&&(G+="video"),N.trigger(Q.default.FRAG_PARSING_DATA,{data1:P,startPTS:_,startDTS:_,type:G,hasAudio:!!f,hasVideo:!!g,nb:1,dropped:0}),N.trigger(Q.default.FRAG_PARSED)},m}(),Rt=Qe,Ie=Object(c.getSelfScope)(),Ft;try{Ft=Ie.performance.now.bind(Ie.performance)}catch(m){h.logger.debug("Unable to use Performance API on this environment"),Ft=Ie.Date.now}var ir=function(){function m(y,f,g,x){this.observer=y,this.typeSupported=f,this.config=g,this.vendor=x}var b=m.prototype;return b.destroy=function(){var f=this.demuxer;f&&f.destroy()},b.push=function(f,g,x,E,_,I,O,P,N,G,U,z){var $=this;if(f.byteLength>0&&g!=null&&g.key!=null&&g.method==="AES-128"){var W=this.decrypter;W==null&&(W=this.decrypter=new L.default(this.observer,this.config));var le=Ft();W.decrypt(f,g.key.buffer,g.iv.buffer,function(re){var de=Ft();$.observer.trigger(Q.default.FRAG_DECRYPTED,{stats:{tstart:le,tdecrypt:de}}),$.pushDecrypted(new Uint8Array(re),g,new Uint8Array(x),E,_,I,O,P,N,G,U,z)})}else this.pushDecrypted(new Uint8Array(f),g,new Uint8Array(x),E,_,I,O,P,N,G,U,z)},b.pushDecrypted=function(f,g,x,E,_,I,O,P,N,G,U,z){var $=this.demuxer,W=this.remuxer;if(!$||O||P){for(var le=this.observer,re=this.typeSupported,de=this.config,me=[{demux:Le,remux:mt},{demux:ne.default,remux:Rt},{demux:J,remux:mt},{demux:Ye,remux:mt}],ge,Ae=0,Re=me.length;Ae<Re&&(ge=me[Ae],!ge.demux.probe(f));Ae++);if(!ge){le.trigger(Q.default.ERROR,{type:X.ErrorTypes.MEDIA_ERROR,details:X.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"});return}(!W||!(W instanceof ge.remux))&&(W=new ge.remux(le,de,re,this.vendor)),(!$||!($ instanceof ge.demux))&&($=new ge.demux(le,W,de,re),this.probe=ge.demux.probe),this.demuxer=$,this.remuxer=W}(O||P)&&($.resetInitSegment(x,E,_,G),W.resetInitSegment()),O&&($.resetTimeStamp(z),W.resetTimeStamp(z)),typeof $.setDecryptData=="function"&&$.setDecryptData(g),$.append(f,I,N,U)},m}(),Ut=ae.default=ir},"./src/demux/demuxer-worker.js":function(Te,ae,V){"use strict";V.r(ae);var Q=V("./src/demux/demuxer-inline.js"),X=V("./src/events.js"),L=V("./src/utils/logger.js"),te=V("./node_modules/eventemitter3/index.js"),h=V.n(te),c=function(S){var T=new te.EventEmitter;T.trigger=function(D){for(var M=arguments.length,k=new Array(M>1?M-1:0),Y=1;Y<M;Y++)k[Y-1]=arguments[Y];T.emit.apply(T,[D,D].concat(k))},T.off=function(D){for(var M=arguments.length,k=new Array(M>1?M-1:0),Y=1;Y<M;Y++)k[Y-1]=arguments[Y];T.removeListener.apply(T,[D].concat(k))};var w=function(D,M){S.postMessage({event:D,data:M})};S.addEventListener("message",function(R){var D=R.data;switch(D.cmd){case"init":var M=JSON.parse(D.config);S.demuxer=new Q.default(T,D.typeSupported,M,D.vendor),Object(L.enableLogs)(M.debug),w("init",null);break;case"demux":S.demuxer.push(D.data,D.decryptdata,D.initSegment,D.audioCodec,D.videoCodec,D.timeOffset,D.discontinuity,D.trackSwitch,D.contiguous,D.duration,D.accurateTimeOffset,D.defaultInitPTS);break;default:break}}),T.on(X.default.FRAG_DECRYPTED,w),T.on(X.default.FRAG_PARSING_INIT_SEGMENT,w),T.on(X.default.FRAG_PARSED,w),T.on(X.default.ERROR,w),T.on(X.default.FRAG_PARSING_METADATA,w),T.on(X.default.FRAG_PARSING_USERDATA,w),T.on(X.default.INIT_PTS_FOUND,w),T.on(X.default.FRAG_PARSING_DATA,function(R,D){var M=[],k={event:R,data:D};D.data1&&(k.data1=D.data1.buffer,M.push(D.data1.buffer),delete D.data1),D.data2&&(k.data2=D.data2.buffer,M.push(D.data2.buffer),delete D.data2),S.postMessage(k,M)})};ae.default=c},"./src/demux/id3.js":function(Te,ae,V){"use strict";V.r(ae),V.d(ae,"utf8ArrayToStr",function(){return h});var Q=V("./src/utils/get-self-scope.js"),X=function(){function c(){}return c.isHeader=function(S,T){return T+10<=S.length&&S[T]===73&&S[T+1]===68&&S[T+2]===51&&S[T+3]<255&&S[T+4]<255&&S[T+6]<128&&S[T+7]<128&&S[T+8]<128&&S[T+9]<128},c.isFooter=function(S,T){return T+10<=S.length&&S[T]===51&&S[T+1]===68&&S[T+2]===73&&S[T+3]<255&&S[T+4]<255&&S[T+6]<128&&S[T+7]<128&&S[T+8]<128&&S[T+9]<128},c.getID3Data=function(S,T){for(var w=T,R=0;c.isHeader(S,T);){R+=10;var D=c._readSize(S,T+6);R+=D,c.isFooter(S,T+10)&&(R+=10),T+=R}if(R>0)return S.subarray(w,w+R)},c._readSize=function(S,T){var w=0;return w=(S[T]&127)<<21,w|=(S[T+1]&127)<<14,w|=(S[T+2]&127)<<7,w|=S[T+3]&127,w},c.getTimeStamp=function(S){for(var T=c.getID3Frames(S),w=0;w<T.length;w++){var R=T[w];if(c.isTimeStampFrame(R))return c._readTimeStamp(R)}},c.isTimeStampFrame=function(S){return S&&S.key==="PRIV"&&S.info==="com.apple.streaming.transportStreamTimestamp"},c._getFrameData=function(S){var T=String.fromCharCode(S[0],S[1],S[2],S[3]),w=c._readSize(S,4),R=10;return{type:T,size:w,data:S.subarray(R,R+w)}},c.getID3Frames=function(S){for(var T=0,w=[];c.isHeader(S,T);){var R=c._readSize(S,T+6);T+=10;for(var D=T+R;T+8<D;){var M=c._getFrameData(S.subarray(T)),k=c._decodeFrame(M);k&&w.push(k),T+=M.size+10}c.isFooter(S,T)&&(T+=10)}return w},c._decodeFrame=function(S){return S.type==="PRIV"?c._decodePrivFrame(S):S.type[0]==="W"?c._decodeURLFrame(S):c._decodeTextFrame(S)},c._readTimeStamp=function(S){if(S.data.byteLength===8){var T=new Uint8Array(S.data),w=T[3]&1,R=(T[4]<<23)+(T[5]<<15)+(T[6]<<7)+T[7];return R/=45,w&&(R+=4772185884e-2),Math.round(R)}},c._decodePrivFrame=function(S){if(!(S.size<2)){var T=c._utf8ArrayToStr(S.data,!0),w=new Uint8Array(S.data.subarray(T.length+1));return{key:S.type,info:T,data:w.buffer}}},c._decodeTextFrame=function(S){if(!(S.size<2))if(S.type==="TXXX"){var T=1,w=c._utf8ArrayToStr(S.data.subarray(T),!0);T+=w.length+1;var R=c._utf8ArrayToStr(S.data.subarray(T));return{key:S.type,info:w,data:R}}else{var D=c._utf8ArrayToStr(S.data.subarray(1));return{key:S.type,data:D}}},c._decodeURLFrame=function(S){if(S.type==="WXXX"){if(S.size<2)return;var T=1,w=c._utf8ArrayToStr(S.data.subarray(T),!0);T+=w.length+1;var R=c._utf8ArrayToStr(S.data.subarray(T));return{key:S.type,info:w,data:R}}else{var D=c._utf8ArrayToStr(S.data);return{key:S.type,data:D}}},c._utf8ArrayToStr=function(S,T){T===void 0&&(T=!1);var w=te();if(w){var R=w.decode(S);if(T){var D=R.indexOf("\0");return D!==-1?R.substring(0,D):R}return R.replace(/\0/g,"")}for(var M=S.length,k,Y,K,j="",H=0;H<M;){if(k=S[H++],k===0&&T)return j;if(k===0||k===3)continue;switch(k>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:j+=String.fromCharCode(k);break;case 12:case 13:Y=S[H++],j+=String.fromCharCode((k&31)<<6|Y&63);break;case 14:Y=S[H++],K=S[H++],j+=String.fromCharCode((k&15)<<12|(Y&63)<<6|(K&63)<<0);break;default:}}return j},c}(),L;function te(){var c=Object(Q.getSelfScope)();return!L&&typeof c.TextDecoder!="undefined"&&(L=new c.TextDecoder("utf-8")),L}var h=X._utf8ArrayToStr;ae.default=X},"./src/demux/mp4demuxer.js":function(Te,ae,V){"use strict";V.r(ae);var Q=V("./src/utils/logger.js"),X=V("./src/events.js"),L=Math.pow(2,32)-1,te=function(){function h(Z,S){this.observer=Z,this.remuxer=S}var c=h.prototype;return c.resetTimeStamp=function(S){this.initPTS=S},c.resetInitSegment=function(S,T,w,R){if(S&&S.byteLength){var D=this.initData=h.parseInitSegment(S);T==null&&(T="mp4a.40.5"),w==null&&(w="avc1.42e01e");var M={};D.audio&&D.video?M.audiovideo={container:"video/mp4",codec:T+","+w,initSegment:R?S:null}:(D.audio&&(M.audio={container:"audio/mp4",codec:T,initSegment:R?S:null}),D.video&&(M.video={container:"video/mp4",codec:w,initSegment:R?S:null})),this.observer.trigger(X.default.FRAG_PARSING_INIT_SEGMENT,{tracks:M})}else T&&(this.audioCodec=T),w&&(this.videoCodec=w)},h.probe=function(S){return h.findBox({data:S,start:0,end:Math.min(S.length,16384)},["moof"]).length>0},h.bin2str=function(S){return String.fromCharCode.apply(null,S)},h.readUint16=function(S,T){S.data&&(T+=S.start,S=S.data);var w=S[T]<<8|S[T+1];return w<0?65536+w:w},h.readUint32=function(S,T){S.data&&(T+=S.start,S=S.data);var w=S[T]<<24|S[T+1]<<16|S[T+2]<<8|S[T+3];return w<0?4294967296+w:w},h.writeUint32=function(S,T,w){S.data&&(T+=S.start,S=S.data),S[T]=w>>24,S[T+1]=w>>16&255,S[T+2]=w>>8&255,S[T+3]=w&255},h.findBox=function(S,T){var w=[],R,D,M,k,Y,K,j;if(S.data?(K=S.start,k=S.end,S=S.data):(K=0,k=S.byteLength),!T.length)return null;for(R=K;R<k;)D=h.readUint32(S,R),M=h.bin2str(S.subarray(R+4,R+8)),j=D>1?R+D:k,M===T[0]&&(T.length===1?w.push({data:S,start:R+8,end:j}):(Y=h.findBox({data:S,start:R+8,end:j},T.slice(1)),Y.length&&(w=w.concat(Y)))),R=j;return w},h.parseSegmentIndex=function(S){var T=h.findBox(S,["moov"])[0],w=T?T.end:null,R=0,D=h.findBox(S,["sidx"]),M;if(!D||!D[0])return null;M=[],D=D[0];var k=D.data[0];R=k===0?8:16;var Y=h.readUint32(D,R);R+=4;var K=0,j=0;k===0?R+=8:R+=16,R+=2;var H=D.end+j,J=h.readUint16(D,R);R+=2;for(var ne=0;ne<J;ne++){var se=R,ve=h.readUint32(D,se);se+=4;var ce=ve&2147483647,Se=(ve&2147483648)>>>31;if(Se===1){console.warn("SIDX has hierarchical references (not supported)");return}var Ue=h.readUint32(D,se);se+=4,M.push({referenceSize:ce,subsegmentDuration:Ue,info:{duration:Ue/Y,start:H,end:H+ce-1}}),H+=ce,se+=4,R=se}return{earliestPresentationTime:K,timescale:Y,version:k,referencesCount:J,references:M,moovEndOffset:w}},h.parseInitSegment=function(S){var T=[],w=h.findBox(S,["moov","trak"]);return w.forEach(function(R){var D=h.findBox(R,["tkhd"])[0];if(D){var M=D.data[D.start],k=M===0?12:20,Y=h.readUint32(D,k),K=h.findBox(R,["mdia","mdhd"])[0];if(K){M=K.data[K.start],k=M===0?12:20;var j=h.readUint32(K,k),H=h.findBox(R,["mdia","hdlr"])[0];if(H){var J=h.bin2str(H.data.subarray(H.start+8,H.start+12)),ne={soun:"audio",vide:"video"}[J];if(ne){var se=h.findBox(R,["mdia","minf","stbl","stsd"]);if(se.length){se=se[0];var ve=h.bin2str(se.data.subarray(se.start+12,se.start+16));Q.logger.log("MP4Demuxer:"+ne+":"+ve+" found")}T[Y]={timescale:j,type:ne},T[ne]={timescale:j,id:Y}}}}}}),T},h.getStartDTS=function(S,T){var w,R,D;return w=h.findBox(T,["moof","traf"]),R=[].concat.apply([],w.map(function(M){return h.findBox(M,["tfhd"]).map(function(k){var Y,K,j;return Y=h.readUint32(k,4),K=S[Y].timescale||9e4,j=h.findBox(M,["tfdt"]).map(function(H){var J,ne;return J=H.data[H.start],ne=h.readUint32(H,4),J===1&&(ne*=Math.pow(2,32),ne+=h.readUint32(H,8)),ne})[0],j/K})})),D=Math.min.apply(null,R),isFinite(D)?D:0},h.offsetStartDTS=function(S,T,w){h.findBox(T,["moof","traf"]).map(function(R){return h.findBox(R,["tfhd"]).map(function(D){var M=h.readUint32(D,4),k=S[M].timescale||9e4;h.findBox(R,["tfdt"]).map(function(Y){var K=Y.data[Y.start],j=h.readUint32(Y,4);if(K===0)h.writeUint32(Y,4,j-w*k);else{j*=Math.pow(2,32),j+=h.readUint32(Y,8),j-=w*k,j=Math.max(j,0);var H=Math.floor(j/(L+1)),J=Math.floor(j%(L+1));h.writeUint32(Y,4,H),h.writeUint32(Y,8,J)}})})})},c.append=function(S,T,w,R){var D=this.initData;D||(this.resetInitSegment(S,this.audioCodec,this.videoCodec,!1),D=this.initData);var M,k=this.initPTS;if(k===void 0){var Y=h.getStartDTS(D,S);this.initPTS=k=Y-T,this.observer.trigger(X.default.INIT_PTS_FOUND,{initPTS:k})}h.offsetStartDTS(D,S,k),M=h.getStartDTS(D,S),this.remuxer.remux(D.audio,D.video,null,null,M,w,R,S)},c.destroy=function(){},h}();ae.default=te},"./src/errors.ts":function(Te,ae,V){"use strict";V.r(ae),V.d(ae,"ErrorTypes",function(){return Q}),V.d(ae,"ErrorDetails",function(){return X});var Q;(function(L){L.NETWORK_ERROR="networkError",L.MEDIA_ERROR="mediaError",L.KEY_SYSTEM_ERROR="keySystemError",L.MUX_ERROR="muxError",L.OTHER_ERROR="otherError"})(Q||(Q={}));var X;(function(L){L.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",L.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",L.KEY_SYSTEM_NO_SESSION="keySystemNoSession",L.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",L.KEY_SYSTEM_NO_INIT_DATA="keySystemNoInitData",L.MANIFEST_LOAD_ERROR="manifestLoadError",L.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",L.MANIFEST_PARSING_ERROR="manifestParsingError",L.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",L.LEVEL_EMPTY_ERROR="levelEmptyError",L.LEVEL_LOAD_ERROR="levelLoadError",L.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",L.LEVEL_SWITCH_ERROR="levelSwitchError",L.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",L.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",L.FRAG_LOAD_ERROR="fragLoadError",L.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",L.FRAG_DECRYPT_ERROR="fragDecryptError",L.FRAG_PARSING_ERROR="fragParsingError",L.REMUX_ALLOC_ERROR="remuxAllocError",L.KEY_LOAD_ERROR="keyLoadError",L.KEY_LOAD_TIMEOUT="keyLoadTimeOut",L.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",L.BUFFER_APPEND_ERROR="bufferAppendError",L.BUFFER_APPENDING_ERROR="bufferAppendingError",L.BUFFER_STALLED_ERROR="bufferStalledError",L.BUFFER_FULL_ERROR="bufferFullError",L.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",L.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",L.INTERNAL_EXCEPTION="internalException"})(X||(X={}))},"./src/events.js":function(Te,ae,V){"use strict";V.r(ae);var Q={MEDIA_ATTACHING:"hlsMediaAttaching",MEDIA_ATTACHED:"hlsMediaAttached",MEDIA_DETACHING:"hlsMediaDetaching",MEDIA_DETACHED:"hlsMediaDetached",BUFFER_RESET:"hlsBufferReset",BUFFER_CODECS:"hlsBufferCodecs",BUFFER_CREATED:"hlsBufferCreated",BUFFER_APPENDING:"hlsBufferAppending",BUFFER_APPENDED:"hlsBufferAppended",BUFFER_EOS:"hlsBufferEos",BUFFER_FLUSHING:"hlsBufferFlushing",BUFFER_FLUSHED:"hlsBufferFlushed",MANIFEST_LOADING:"hlsManifestLoading",MANIFEST_LOADED:"hlsManifestLoaded",MANIFEST_PARSED:"hlsManifestParsed",LEVEL_SWITCHING:"hlsLevelSwitching",LEVEL_SWITCHED:"hlsLevelSwitched",LEVEL_LOADING:"hlsLevelLoading",LEVEL_LOADED:"hlsLevelLoaded",LEVEL_UPDATED:"hlsLevelUpdated",LEVEL_PTS_UPDATED:"hlsLevelPtsUpdated",LEVELS_UPDATED:"hlsLevelsUpdated",AUDIO_TRACKS_UPDATED:"hlsAudioTracksUpdated",AUDIO_TRACK_SWITCHING:"hlsAudioTrackSwitching",AUDIO_TRACK_SWITCHED:"hlsAudioTrackSwitched",AUDIO_TRACK_LOADING:"hlsAudioTrackLoading",AUDIO_TRACK_LOADED:"hlsAudioTrackLoaded",SUBTITLE_TRACKS_UPDATED:"hlsSubtitleTracksUpdated",SUBTITLE_TRACK_SWITCH:"hlsSubtitleTrackSwitch",SUBTITLE_TRACK_LOADING:"hlsSubtitleTrackLoading",SUBTITLE_TRACK_LOADED:"hlsSubtitleTrackLoaded",SUBTITLE_FRAG_PROCESSED:"hlsSubtitleFragProcessed",CUES_PARSED:"hlsCuesParsed",NON_NATIVE_TEXT_TRACKS_FOUND:"hlsNonNativeTextTracksFound",INIT_PTS_FOUND:"hlsInitPtsFound",FRAG_LOADING:"hlsFragLoading",FRAG_LOAD_PROGRESS:"hlsFragLoadProgress",FRAG_LOAD_EMERGENCY_ABORTED:"hlsFragLoadEmergencyAborted",FRAG_LOADED:"hlsFragLoaded",FRAG_DECRYPTED:"hlsFragDecrypted",FRAG_PARSING_INIT_SEGMENT:"hlsFragParsingInitSegment",FRAG_PARSING_USERDATA:"hlsFragParsingUserdata",FRAG_PARSING_METADATA:"hlsFragParsingMetadata",FRAG_PARSING_DATA:"hlsFragParsingData",FRAG_PARSED:"hlsFragParsed",FRAG_BUFFERED:"hlsFragBuffered",FRAG_CHANGED:"hlsFragChanged",FPS_DROP:"hlsFpsDrop",FPS_DROP_LEVEL_CAPPING:"hlsFpsDropLevelCapping",ERROR:"hlsError",DESTROYING:"hlsDestroying",KEY_LOADING:"hlsKeyLoading",KEY_LOADED:"hlsKeyLoaded",STREAM_STATE_TRANSITION:"hlsStreamStateTransition",LIVE_BACK_BUFFER_REACHED:"hlsLiveBackBufferReached"};ae.default=Q},"./src/hls.ts":function(Te,ae,V){"use strict";V.r(ae),V.d(ae,"default",function(){return Wr});var Q={};V.r(Q),V.d(Q,"newCue",function(){return Fi});var X=V("./node_modules/url-toolkit/src/url-toolkit.js"),L=V("./src/errors.ts"),te=V("./src/polyfills/number.js"),h=V("./src/events.js"),c=V("./src/utils/logger.js"),Z={hlsEventGeneric:!0,hlsHandlerDestroying:!0,hlsHandlerDestroyed:!0},S=function(){function o(i){this.hls=void 0,this.handledEvents=void 0,this.useGenericHandler=void 0,this.hls=i,this.onEvent=this.onEvent.bind(this);for(var r=arguments.length,e=new Array(r>1?r-1:0),t=1;t<r;t++)e[t-1]=arguments[t];this.handledEvents=e,this.useGenericHandler=!0,this.registerListeners()}var n=o.prototype;return n.destroy=function(){this.onHandlerDestroying(),this.unregisterListeners(),this.onHandlerDestroyed()},n.onHandlerDestroying=function(){},n.onHandlerDestroyed=function(){},n.isEventHandler=function(){return typeof this.handledEvents=="object"&&this.handledEvents.length&&typeof this.onEvent=="function"},n.registerListeners=function(){this.isEventHandler()&&this.handledEvents.forEach(function(r){if(Z[r])throw new Error("Forbidden event-name: "+r);this.hls.on(r,this.onEvent)},this)},n.unregisterListeners=function(){this.isEventHandler()&&this.handledEvents.forEach(function(r){this.hls.off(r,this.onEvent)},this)},n.onEvent=function(r,e){this.onEventGeneric(r,e)},n.onEventGeneric=function(r,e){var t=function(s,l){var u="on"+s.replace("hls","");if(typeof this[u]!="function")throw new Error("Event "+s+" has no generic handler in this "+this.constructor.name+" class (tried "+u+")");return this[u].bind(this,l)};try{t.call(this,r,e).call()}catch(a){c.logger.error("An internal error happened while handling event "+r+'. Error message: "'+a.message+'". Here is a stacktrace:',a),this.hls.trigger(h.default.ERROR,{type:L.ErrorTypes.OTHER_ERROR,details:L.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:r,err:a})}},o}(),T=S,w;(function(o){o.MANIFEST="manifest",o.LEVEL="level",o.AUDIO_TRACK="audioTrack",o.SUBTITLE_TRACK="subtitleTrack"})(w||(w={}));var R;(function(o){o.MAIN="main",o.AUDIO="audio",o.SUBTITLE="subtitle"})(R||(R={}));var D=V("./src/demux/mp4demuxer.js");function M(o,n){for(var i=0;i<n.length;i++){var r=n[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(o,r.key,r)}}function k(o,n,i){return n&&M(o.prototype,n),i&&M(o,i),o}var Y=function(){function o(n,i){this._uri=null,this.baseuri=void 0,this.reluri=void 0,this.method=null,this.key=null,this.iv=null,this.baseuri=n,this.reluri=i}return k(o,[{key:"uri",get:function(){return!this._uri&&this.reluri&&(this._uri=Object(X.buildAbsoluteURL)(this.baseuri,this.reluri,{alwaysNormalize:!0})),this._uri}}]),o}();function K(o,n){for(var i=0;i<n.length;i++){var r=n[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(o,r.key,r)}}function j(o,n,i){return n&&K(o.prototype,n),i&&K(o,i),o}var H;(function(o){o.AUDIO="audio",o.VIDEO="video"})(H||(H={}));var J=function(){function o(){var i;this._url=null,this._byteRange=null,this._decryptdata=null,this._elementaryStreams=(i={},i[H.AUDIO]=!1,i[H.VIDEO]=!1,i),this.deltaPTS=0,this.rawProgramDateTime=null,this.programDateTime=null,this.title=null,this.tagList=[],this.cc=void 0,this.type=void 0,this.relurl=void 0,this.baseurl=void 0,this.duration=void 0,this.start=void 0,this.sn=0,this.urlId=0,this.level=0,this.levelkey=void 0,this.loader=void 0}var n=o.prototype;return n.setByteRange=function(r,e){var t=r.split("@",2),a=[];t.length===1?a[0]=e?e.byteRangeEndOffset:0:a[0]=parseInt(t[1]),a[1]=parseInt(t[0])+a[0],this._byteRange=a},n.addElementaryStream=function(r){this._elementaryStreams[r]=!0},n.hasElementaryStream=function(r){return this._elementaryStreams[r]===!0},n.createInitializationVector=function(r){for(var e=new Uint8Array(16),t=12;t<16;t++)e[t]=r>>8*(15-t)&255;return e},n.setDecryptDataFromLevelKey=function(r,e){var t=r;return(r==null?void 0:r.method)&&r.uri&&!r.iv&&(t=new Y(r.baseuri,r.reluri),t.method=r.method,t.iv=this.createInitializationVector(e)),t},j(o,[{key:"url",get:function(){return!this._url&&this.relurl&&(this._url=Object(X.buildAbsoluteURL)(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url},set:function(r){this._url=r}},{key:"byteRange",get:function(){return this._byteRange?this._byteRange:[]}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"decryptdata",get:function(){if(!this.levelkey&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkey){var r=this.sn;typeof r!="number"&&(this.levelkey&&this.levelkey.method==="AES-128"&&!this.levelkey.iv&&c.logger.warn('missing IV for initialization segment with method="'+this.levelkey.method+'" - compliance issue'),r=0),this._decryptdata=this.setDecryptDataFromLevelKey(this.levelkey,r)}return this._decryptdata}},{key:"endProgramDateTime",get:function(){if(this.programDateTime===null||!Object(te.isFiniteNumber)(this.programDateTime))return null;var r=Object(te.isFiniteNumber)(this.duration)?this.duration:0;return this.programDateTime+r*1e3}},{key:"encrypted",get:function(){return!!(this.decryptdata&&this.decryptdata.uri!==null&&this.decryptdata.key===null)}}]),o}();function ne(o,n){for(var i=0;i<n.length;i++){var r=n[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(o,r.key,r)}}function se(o,n,i){return n&&ne(o.prototype,n),i&&ne(o,i),o}var ve=function(){function o(n){this.endCC=0,this.endSN=0,this.fragments=[],this.initSegment=null,this.live=!0,this.needSidxRanges=!1,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=n,this.version=null}return se(o,[{key:"hasProgramDateTime",get:function(){return!!(this.fragments[0]&&Object(te.isFiniteNumber)(this.fragments[0].programDateTime))}}]),o}(),ce=/^(\d+)x(\d+)$/,Se=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,Ue=function(){function o(i){typeof i=="string"&&(i=o.parseAttrList(i));for(var r in i)i.hasOwnProperty(r)&&(this[r]=i[r])}var n=o.prototype;return n.decimalInteger=function(r){var e=parseInt(this[r],10);return e>Number.MAX_SAFE_INTEGER?1/0:e},n.hexadecimalInteger=function(r){if(this[r]){var e=(this[r]||"0x").slice(2);e=(e.length&1?"0":"")+e;for(var t=new Uint8Array(e.length/2),a=0;a<e.length/2;a++)t[a]=parseInt(e.slice(a*2,a*2+2),16);return t}else return null},n.hexadecimalIntegerAsNumber=function(r){var e=parseInt(this[r],16);return e>Number.MAX_SAFE_INTEGER?1/0:e},n.decimalFloatingPoint=function(r){return parseFloat(this[r])},n.enumeratedString=function(r){return this[r]},n.decimalResolution=function(r){var e=ce.exec(this[r]);if(e!==null)return{width:parseInt(e[1],10),height:parseInt(e[2],10)}},o.parseAttrList=function(r){var e,t={};for(Se.lastIndex=0;(e=Se.exec(r))!==null;){var a=e[2],s='"';a.indexOf(s)===0&&a.lastIndexOf(s)===a.length-1&&(a=a.slice(1,-1)),t[e[1]]=a}return t},o}(),Fe=Ue,Oe={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,drac:!0,dvav:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0}};function ut(o,n){var i=Oe[n];return!!i&&i[o.slice(0,4)]===!0}function Le(o,n){return MediaSource.isTypeSupported((n||"video")+'/mp4;codecs="'+o+'"')}var Be=/(?:#EXT-X-STREAM-INF:([^\n\r]*)[\r\n]+([^\r\n]+)|#EXT-X-SESSION-DATA:([^\n\r]*)[\r\n]+)/g,Ye=/#EXT-X-MEDIA:(.*)/g,Ge=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/|(?!#)([\S+ ?]+)/.source,/|#EXT-X-BYTERANGE:*(.+)/.source,/|#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/|#.*/.source].join(""),"g"),Ce=/(?:(?:#(EXTM3U))|(?:#EXT-X-(PLAYLIST-TYPE):(.+))|(?:#EXT-X-(MEDIA-SEQUENCE): *(\d+))|(?:#EXT-X-(TARGETDURATION): *(\d+))|(?:#EXT-X-(KEY):(.+))|(?:#EXT-X-(START):(.+))|(?:#EXT-X-(ENDLIST))|(?:#EXT-X-(DISCONTINUITY-SEQ)UENCE:(\d+))|(?:#EXT-X-(DIS)CONTINUITY))|(?:#EXT-X-(VERSION):(\d+))|(?:#EXT-X-(MAP):(.+))|(?:(#)([^:]*):(.*))|(?:(#)(.*))(?:.*)\r?\n?/,De=/\.(mp4|m4s|m4v|m4a)$/i,pe=function(){function o(){}return o.findGroup=function(i,r){for(var e=0;e<i.length;e++){var t=i[e];if(t.id===r)return t}},o.convertAVC1ToAVCOTI=function(i){var r=i.split("."),e;return r.length>2?(e=r.shift()+".",e+=parseInt(r.shift()).toString(16),e+=("000"+parseInt(r.shift()).toString(16)).substr(-4)):e=i,e},o.resolve=function(i,r){return X.buildAbsoluteURL(r,i,{alwaysNormalize:!0})},o.parseMasterPlaylist=function(i,r){var e=[],t={},a=!1;Be.lastIndex=0;function s(A,F){["video","audio"].forEach(function(B){var q=A.filter(function(ee){return ut(ee,B)});if(q.length){var ie=q.filter(function(ee){return ee.lastIndexOf("avc1",0)===0||ee.lastIndexOf("mp4a",0)===0});F[B+"Codec"]=ie.length>0?ie[0]:q[0],A=A.filter(function(ee){return q.indexOf(ee)===-1})}}),F.unknownCodecs=A}for(var l;(l=Be.exec(i))!=null;)if(l[1]){var u={},d=u.attrs=new Fe(l[1]);u.url=o.resolve(l[2],r);var v=d.decimalResolution("RESOLUTION");v&&(u.width=v.width,u.height=v.height),u.bitrate=d.decimalInteger("AVERAGE-BANDWIDTH")||d.decimalInteger("BANDWIDTH"),u.name=d.NAME,s([].concat((d.CODECS||"").split(/[ ,]+/)),u),u.videoCodec&&u.videoCodec.indexOf("avc1")!==-1&&(u.videoCodec=o.convertAVC1ToAVCOTI(u.videoCodec)),e.push(u)}else if(l[3]){var p=new Fe(l[3]);p["DATA-ID"]&&(a=!0,t[p["DATA-ID"]]=p)}return{levels:e,sessionData:a?t:null}},o.parseMasterPlaylistMedia=function(i,r,e,t){t===void 0&&(t=[]);var a,s=[],l=0;for(Ye.lastIndex=0;(a=Ye.exec(i))!==null;){var u=new Fe(a[1]);if(u.TYPE===e){var d={attrs:u,id:l++,groupId:u["GROUP-ID"],instreamId:u["INSTREAM-ID"],name:u.NAME||u.LANGUAGE,type:e,default:u.DEFAULT==="YES",autoselect:u.AUTOSELECT==="YES",forced:u.FORCED==="YES",lang:u.LANGUAGE};if(u.URI&&(d.url=o.resolve(u.URI,r)),t.length){var v=o.findGroup(t,d.groupId);d.audioCodec=v?v.codec:t[0].codec}s.push(d)}}return s},o.parseLevelPlaylist=function(i,r,e,t,a){var s=0,l=0,u=new ve(r),d=0,v=null,p=new J,A,F,B,q=null;for(Ge.lastIndex=0;(A=Ge.exec(i))!==null;){var ie=A[1];if(ie){p.duration=parseFloat(ie);var ee=(" "+A[2]).slice(1);p.title=ee||null,p.tagList.push(ee?["INF",ie,ee]:["INF",ie])}else if(A[3]){if(Object(te.isFiniteNumber)(p.duration)){var ue=s++;p.type=t,p.start=l,B&&(p.levelkey=B),p.sn=ue,p.level=e,p.cc=d,p.urlId=a,p.baseurl=r,p.relurl=(" "+A[3]).slice(1),we(p,v),u.fragments.push(p),v=p,l+=p.duration,p=new J}}else if(A[4]){var fe=(" "+A[4]).slice(1);v?p.setByteRange(fe,v):p.setByteRange(fe)}else if(A[5])p.rawProgramDateTime=(" "+A[5]).slice(1),p.tagList.push(["PROGRAM-DATE-TIME",p.rawProgramDateTime]),q===null&&(q=u.fragments.length);else{if(A=A[0].match(Ce),!A){c.logger.warn("No matches on slow regex match for level playlist!");continue}for(F=1;F<A.length&&typeof A[F]=="undefined";F++);var Ee=(" "+A[F+1]).slice(1),Ne=(" "+A[F+2]).slice(1);switch(A[F]){case"#":p.tagList.push(Ne?[Ee,Ne]:[Ee]);break;case"PLAYLIST-TYPE":u.type=Ee.toUpperCase();break;case"MEDIA-SEQUENCE":s=u.startSN=parseInt(Ee);break;case"TARGETDURATION":u.targetduration=parseFloat(Ee);break;case"VERSION":u.version=parseInt(Ee);break;case"EXTM3U":break;case"ENDLIST":u.live=!1;break;case"DIS":d++,p.tagList.push(["DIS"]);break;case"DISCONTINUITY-SEQ":d=parseInt(Ee);break;case"KEY":{var lt=Ee,Ze=new Fe(lt),Tt=Ze.enumeratedString("METHOD"),oe=Ze.URI,xe=Ze.hexadecimalInteger("IV"),He=Ze.KEYFORMAT||"identity";if(He==="com.apple.streamingkeydelivery"){c.logger.warn("Keyformat com.apple.streamingkeydelivery is not supported");continue}Tt&&(B=new Y(r,oe),oe&&["AES-128","SAMPLE-AES","SAMPLE-AES-CENC"].indexOf(Tt)>=0&&(B.method=Tt,B.key=null,B.iv=xe));break}case"START":{var Mt=new Fe(Ee),Nt=Mt.decimalFloatingPoint("TIME-OFFSET");Object(te.isFiniteNumber)(Nt)&&(u.startTimeOffset=Nt);break}case"MAP":{var Ht=new Fe(Ee);p.relurl=Ht.URI,Ht.BYTERANGE&&p.setByteRange(Ht.BYTERANGE),p.baseurl=r,p.level=e,p.type=t,p.sn="initSegment",u.initSegment=p,p=new J,p.rawProgramDateTime=u.initSegment.rawProgramDateTime;break}default:c.logger.warn("line parsed but not handled: "+A);break}}}return p=v,p&&!p.relurl&&(u.fragments.pop(),l-=p.duration),u.totalduration=l,u.averagetargetduration=l/u.fragments.length,u.endSN=s-1,u.startCC=u.fragments[0]?u.fragments[0].cc:0,u.endCC=d,!u.initSegment&&u.fragments.length&&u.fragments.every(function(rr){return De.test(rr.relurl)})&&(c.logger.warn("MP4 fragments found but no init segment (probably no MAP, incomplete M3U8), trying to fetch SIDX"),p=new J,p.relurl=u.fragments[0].relurl,p.baseurl=r,p.level=e,p.type=t,p.sn="initSegment",u.initSegment=p,u.needSidxRanges=!0),q&&Je(u.fragments,q),u},o}();function Je(o,n){for(var i=o[n],r=n-1;r>=0;r--){var e=o[r];e.programDateTime=i.programDateTime-e.duration*1e3,i=e}}function we(o,n){o.rawProgramDateTime?o.programDateTime=Date.parse(o.rawProgramDateTime):n!=null&&n.programDateTime&&(o.programDateTime=n.endProgramDateTime),Object(te.isFiniteNumber)(o.programDateTime)||(o.programDateTime=null,o.rawProgramDateTime=null)}function _t(o,n){o.prototype=Object.create(n.prototype),o.prototype.constructor=o,o.__proto__=n}var vt=window,_e=vt.performance,tt=function(o){_t(n,o);function n(r){var e;return e=o.call(this,r,h.default.MANIFEST_LOADING,h.default.LEVEL_LOADING,h.default.AUDIO_TRACK_LOADING,h.default.SUBTITLE_TRACK_LOADING)||this,e.loaders={},e}n.canHaveQualityLevels=function(e){return e!==w.AUDIO_TRACK&&e!==w.SUBTITLE_TRACK},n.mapContextToLevelType=function(e){var t=e.type;switch(t){case w.AUDIO_TRACK:return R.AUDIO;case w.SUBTITLE_TRACK:return R.SUBTITLE;default:return R.MAIN}},n.getResponseUrl=function(e,t){var a=e.url;return(a===void 0||a.indexOf("data:")===0)&&(a=t.url),a};var i=n.prototype;return i.createInternalLoader=function(e){var t=this.hls.config,a=t.pLoader,s=t.loader,l=a||s,u=new l(t);return e.loader=u,this.loaders[e.type]=u,u},i.getInternalLoader=function(e){return this.loaders[e.type]},i.resetInternalLoader=function(e){this.loaders[e]&&delete this.loaders[e]},i.destroyInternalLoaders=function(){for(var e in this.loaders){var t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}},i.destroy=function(){this.destroyInternalLoaders(),o.prototype.destroy.call(this)},i.onManifestLoading=function(e){this.load({url:e.url,type:w.MANIFEST,level:0,id:null,responseType:"text"})},i.onLevelLoading=function(e){this.load({url:e.url,type:w.LEVEL,level:e.level,id:e.id,responseType:"text"})},i.onAudioTrackLoading=function(e){this.load({url:e.url,type:w.AUDIO_TRACK,level:null,id:e.id,responseType:"text"})},i.onSubtitleTrackLoading=function(e){this.load({url:e.url,type:w.SUBTITLE_TRACK,level:null,id:e.id,responseType:"text"})},i.load=function(e){var t=this.hls.config;c.logger.debug("Loading playlist of type "+e.type+", level: "+e.level+", id: "+e.id);var a=this.getInternalLoader(e);if(a){var s=a.context;if(s&&s.url===e.url)return c.logger.trace("playlist request ongoing"),!1;c.logger.warn("aborting previous loader for type: "+e.type),a.abort()}var l,u,d,v;switch(e.type){case w.MANIFEST:l=t.manifestLoadingMaxRetry,u=t.manifestLoadingTimeOut,d=t.manifestLoadingRetryDelay,v=t.manifestLoadingMaxRetryTimeout;break;case w.LEVEL:l=0,v=0,d=0,u=t.levelLoadingTimeOut;break;default:l=t.levelLoadingMaxRetry,u=t.levelLoadingTimeOut,d=t.levelLoadingRetryDelay,v=t.levelLoadingMaxRetryTimeout;break}a=this.createInternalLoader(e);var p={timeout:u,maxRetry:l,retryDelay:d,maxRetryDelay:v},A={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};return c.logger.debug("Calling internal loader delegate for URL: "+e.url),a.load(e,p,A),!0},i.loadsuccess=function(e,t,a,s){if(s===void 0&&(s=null),a.isSidxRequest){this._handleSidxRequest(e,a),this._handlePlaylistLoaded(e,t,a,s);return}if(this.resetInternalLoader(a.type),typeof e.data!="string")throw new Error('expected responseType of "text" for PlaylistLoader');var l=e.data;if(t.tload=_e.now(),l.indexOf("#EXTM3U")!==0){this._handleManifestParsingError(e,a,"no EXTM3U delimiter",s);return}l.indexOf("#EXTINF:")>0||l.indexOf("#EXT-X-TARGETDURATION:")>0?this._handleTrackOrLevelPlaylist(e,t,a,s):this._handleMasterPlaylist(e,t,a,s)},i.loaderror=function(e,t,a){a===void 0&&(a=null),this._handleNetworkError(t,a,!1,e)},i.loadtimeout=function(e,t,a){a===void 0&&(a=null),this._handleNetworkError(t,a,!0)},i._handleMasterPlaylist=function(e,t,a,s){var l=this.hls,u=e.data,d=n.getResponseUrl(e,a),v=pe.parseMasterPlaylist(u,d),p=v.levels,A=v.sessionData;if(!p.length){this._handleManifestParsingError(e,a,"no level found in manifest",s);return}var F=p.map(function(ue){return{id:ue.attrs.AUDIO,codec:ue.audioCodec}}),B=pe.parseMasterPlaylistMedia(u,d,"AUDIO",F),q=pe.parseMasterPlaylistMedia(u,d,"SUBTITLES"),ie=pe.parseMasterPlaylistMedia(u,d,"CLOSED-CAPTIONS");if(B.length){var ee=!1;B.forEach(function(ue){ue.url||(ee=!0)}),ee===!1&&p[0].audioCodec&&!p[0].attrs.AUDIO&&(c.logger.log("audio codec signaled in quality level, but no embedded audio track signaled, create one"),B.unshift({type:"main",name:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:{},url:""}))}l.trigger(h.default.MANIFEST_LOADED,{levels:p,audioTracks:B,subtitles:q,captions:ie,url:d,stats:t,networkDetails:s,sessionData:A})},i._handleTrackOrLevelPlaylist=function(e,t,a,s){var l=this.hls,u=a.id,d=a.level,v=a.type,p=n.getResponseUrl(e,a),A=Object(te.isFiniteNumber)(u)?u:0,F=Object(te.isFiniteNumber)(d)?d:A,B=n.mapContextToLevelType(a),q=pe.parseLevelPlaylist(e.data,p,F,B,A);if(q.tload=t.tload,!q.fragments.length){l.trigger(h.default.ERROR,{type:L.ErrorTypes.NETWORK_ERROR,details:L.ErrorDetails.LEVEL_EMPTY_ERROR,fatal:!1,url:p,reason:"no fragments found in level",level:typeof a.level=="number"?a.level:void 0});return}if(v===w.MANIFEST){var ie={url:p,details:q};l.trigger(h.default.MANIFEST_LOADED,{levels:[ie],audioTracks:[],url:p,stats:t,networkDetails:s,sessionData:null})}if(t.tparsed=_e.now(),q.needSidxRanges){var ee=q.initSegment.url;this.load({url:ee,isSidxRequest:!0,type:v,level:d,levelDetails:q,id:u,rangeStart:0,rangeEnd:2048,responseType:"arraybuffer"});return}a.levelDetails=q,this._handlePlaylistLoaded(e,t,a,s)},i._handleSidxRequest=function(e,t){if(typeof e.data=="string")throw new Error("sidx request must be made with responseType of array buffer");var a=D.default.parseSegmentIndex(new Uint8Array(e.data));if(!!a){var s=a.references,l=t.levelDetails;s.forEach(function(u,d){var v=u.info;if(!!l){var p=l.fragments[d];p.byteRange.length===0&&p.setByteRange(String(1+v.end-v.start)+"@"+String(v.start))}}),l&&l.initSegment.setByteRange(String(a.moovEndOffset)+"@0")}},i._handleManifestParsingError=function(e,t,a,s){this.hls.trigger(h.default.ERROR,{type:L.ErrorTypes.NETWORK_ERROR,details:L.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:!0,url:e.url,reason:a,networkDetails:s})},i._handleNetworkError=function(e,t,a,s){a===void 0&&(a=!1),s===void 0&&(s=null),c.logger.info("A network error occured while loading a "+e.type+"-type playlist");var l,u,d=this.getInternalLoader(e);switch(e.type){case w.MANIFEST:l=a?L.ErrorDetails.MANIFEST_LOAD_TIMEOUT:L.ErrorDetails.MANIFEST_LOAD_ERROR,u=!0;break;case w.LEVEL:l=a?L.ErrorDetails.LEVEL_LOAD_TIMEOUT:L.ErrorDetails.LEVEL_LOAD_ERROR,u=!1;break;case w.AUDIO_TRACK:l=a?L.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:L.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,u=!1;break;default:u=!1}d&&(d.abort(),this.resetInternalLoader(e.type));var v={type:L.ErrorTypes.NETWORK_ERROR,details:l,fatal:u,url:e.url,loader:d,context:e,networkDetails:t};s&&(v.response=s),this.hls.trigger(h.default.ERROR,v)},i._handlePlaylistLoaded=function(e,t,a,s){var l=a.type,u=a.level,d=a.id,v=a.levelDetails;if(!v||!v.targetduration){this._handleManifestParsingError(e,a,"invalid target duration",s);return}var p=n.canHaveQualityLevels(a.type);if(p)this.hls.trigger(h.default.LEVEL_LOADED,{details:v,level:u||0,id:d||0,stats:t,networkDetails:s});else switch(l){case w.AUDIO_TRACK:this.hls.trigger(h.default.AUDIO_TRACK_LOADED,{details:v,id:d,stats:t,networkDetails:s});break;case w.SUBTITLE_TRACK:this.hls.trigger(h.default.SUBTITLE_TRACK_LOADED,{details:v,id:d,stats:t,networkDetails:s});break}},n}(T),rt=tt;function at(o,n){o.prototype=Object.create(n.prototype),o.prototype.constructor=o,o.__proto__=n}var pt=function(o){at(n,o);function n(r){var e;return e=o.call(this,r,h.default.FRAG_LOADING)||this,e.loaders={},e}var i=n.prototype;return i.destroy=function(){var e=this.loaders;for(var t in e){var a=e[t];a&&a.destroy()}this.loaders={},o.prototype.destroy.call(this)},i.onFragLoading=function(e){var t=e.frag,a=t.type,s=this.loaders,l=this.hls.config,u=l.fLoader,d=l.loader;t.loaded=0;var v=s[a];v&&(c.logger.warn("abort previous fragment loader for type: "+a),v.abort()),v=s[a]=t.loader=l.fLoader?new u(l):new d(l);var p,A,F;p={url:t.url,frag:t,responseType:"arraybuffer",progressData:!1};var B=t.byteRangeStartOffset,q=t.byteRangeEndOffset;Object(te.isFiniteNumber)(B)&&Object(te.isFiniteNumber)(q)&&(p.rangeStart=B,p.rangeEnd=q),A={timeout:l.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:l.fragLoadingMaxRetryTimeout},F={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this),onProgress:this.loadprogress.bind(this)},v.load(p,A,F)},i.loadsuccess=function(e,t,a,s){s===void 0&&(s=null);var l=e.data,u=a.frag;u.loader=void 0,this.loaders[u.type]=void 0,this.hls.trigger(h.default.FRAG_LOADED,{payload:l,frag:u,stats:t,networkDetails:s})},i.loaderror=function(e,t,a){a===void 0&&(a=null);var s=t.frag,l=s.loader;l&&l.abort(),this.loaders[s.type]=void 0,this.hls.trigger(h.default.ERROR,{type:L.ErrorTypes.NETWORK_ERROR,details:L.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:t.frag,response:e,networkDetails:a})},i.loadtimeout=function(e,t,a){a===void 0&&(a=null);var s=t.frag,l=s.loader;l&&l.abort(),this.loaders[s.type]=void 0,this.hls.trigger(h.default.ERROR,{type:L.ErrorTypes.NETWORK_ERROR,details:L.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:t.frag,networkDetails:a})},i.loadprogress=function(e,t,a,s){s===void 0&&(s=null);var l=t.frag;l.loaded=e.loaded,this.hls.trigger(h.default.FRAG_LOAD_PROGRESS,{frag:l,stats:e,networkDetails:s})},n}(T),At=pt;function et(o,n){o.prototype=Object.create(n.prototype),o.prototype.constructor=o,o.__proto__=n}var mt=function(o){et(n,o);function n(r){var e;return e=o.call(this,r,h.default.KEY_LOADING)||this,e.loaders={},e.decryptkey=null,e.decrypturl=null,e}var i=n.prototype;return i.destroy=function(){for(var e in this.loaders){var t=this.loaders[e];t&&t.destroy()}this.loaders={},o.prototype.destroy.call(this)},i.onKeyLoading=function(e){var t=e.frag,a=t.type,s=this.loaders[a];if(!t.decryptdata){c.logger.warn("Missing decryption data on fragment in onKeyLoading");return}var l=t.decryptdata.uri;if(l!==this.decrypturl||this.decryptkey===null){var u=this.hls.config;if(s&&(c.logger.warn("abort previous key loader for type:"+a),s.abort()),!l){c.logger.warn("key uri is falsy");return}t.loader=this.loaders[a]=new u.loader(u),this.decrypturl=l,this.decryptkey=null;var d={url:l,frag:t,responseType:"arraybuffer"},v={timeout:u.fragLoadingTimeOut,maxRetry:0,retryDelay:u.fragLoadingRetryDelay,maxRetryDelay:u.fragLoadingMaxRetryTimeout},p={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};t.loader.load(d,v,p)}else this.decryptkey&&(t.decryptdata.key=this.decryptkey,this.hls.trigger(h.default.KEY_LOADED,{frag:t}))},i.loadsuccess=function(e,t,a){var s=a.frag;if(!s.decryptdata){c.logger.error("after key load, decryptdata unset");return}this.decryptkey=s.decryptdata.key=new Uint8Array(e.data),s.loader=void 0,delete this.loaders[s.type],this.hls.trigger(h.default.KEY_LOADED,{frag:s})},i.loaderror=function(e,t){var a=t.frag,s=a.loader;s&&s.abort(),delete this.loaders[a.type],this.hls.trigger(h.default.ERROR,{type:L.ErrorTypes.NETWORK_ERROR,details:L.ErrorDetails.KEY_LOAD_ERROR,fatal:!1,frag:a,response:e})},i.loadtimeout=function(e,t){var a=t.frag,s=a.loader;s&&s.abort(),delete this.loaders[a.type],this.hls.trigger(h.default.ERROR,{type:L.ErrorTypes.NETWORK_ERROR,details:L.ErrorDetails.KEY_LOAD_TIMEOUT,fatal:!1,frag:a})},n}(T),Qe=mt;function Rt(o,n){o.prototype=Object.create(n.prototype),o.prototype.constructor=o,o.__proto__=n}var Ie={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"},Ft=function(o){Rt(n,o);function n(r){var e;return e=o.call(this,r,h.default.BUFFER_APPENDED,h.default.FRAG_BUFFERED,h.default.FRAG_LOADED)||this,e.bufferPadding=.2,e.fragments=Object.create(null),e.timeRanges=Object.create(null),e.config=r.config,e}var i=n.prototype;return i.destroy=function(){this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.config=null,T.prototype.destroy.call(this),o.prototype.destroy.call(this)},i.getBufferedFrag=function(e,t){var a=this.fragments,s=Object.keys(a).filter(function(u){var d=a[u];if(d.body.type!==t||!d.buffered)return!1;var v=d.body;return v.startPTS<=e&&e<=v.endPTS});if(s.length===0)return null;var l=s.pop();return a[l].body},i.detectEvictedFragments=function(e,t){var a=this;Object.keys(this.fragments).forEach(function(s){var l=a.fragments[s];if(!(!l||!l.buffered)){var u=l.range[e];if(!!u)for(var d=u.time,v=0;v<d.length;v++){var p=d[v];if(!a.isTimeBuffered(p.startPTS,p.endPTS,t)){a.removeFragment(l.body);break}}}})},i.detectPartialFragments=function(e){var t=this,a=this.getFragmentKey(e),s=this.fragments[a];s&&(s.buffered=!0,Object.keys(this.timeRanges).forEach(function(l){if(e.hasElementaryStream(l)){var u=t.timeRanges[l];s.range[l]=t.getBufferedTimes(e.startPTS,e.endPTS,u)}}))},i.getBufferedTimes=function(e,t,a){for(var s=[],l,u,d=!1,v=0;v<a.length;v++)if(l=a.start(v)-this.bufferPadding,u=a.end(v)+this.bufferPadding,e>=l&&t<=u){s.push({startPTS:Math.max(e,a.start(v)),endPTS:Math.min(t,a.end(v))});break}else if(e<u&&t>l)s.push({startPTS:Math.max(e,a.start(v)),endPTS:Math.min(t,a.end(v))}),d=!0;else if(t<=l)break;return{time:s,partial:d}},i.getFragmentKey=function(e){return e.type+"_"+e.level+"_"+e.urlId+"_"+e.sn},i.getPartialFragment=function(e){var t=this,a,s,l,u=null,d=0;return Object.keys(this.fragments).forEach(function(v){var p=t.fragments[v];t.isPartial(p)&&(s=p.body.startPTS-t.bufferPadding,l=p.body.endPTS+t.bufferPadding,e>=s&&e<=l&&(a=Math.min(e-s,l-e),d<=a&&(u=p.body,d=a)))}),u},i.getState=function(e){var t=this.getFragmentKey(e),a=this.fragments[t],s=Ie.NOT_LOADED;return a!==void 0&&(a.buffered?this.isPartial(a)===!0?s=Ie.PARTIAL:s=Ie.OK:s=Ie.APPENDING),s},i.isPartial=function(e){return e.buffered===!0&&(e.range.video!==void 0&&e.range.video.partial===!0||e.range.audio!==void 0&&e.range.audio.partial===!0)},i.isTimeBuffered=function(e,t,a){for(var s,l,u=0;u<a.length;u++){if(s=a.start(u)-this.bufferPadding,l=a.end(u)+this.bufferPadding,e>=s&&t<=l)return!0;if(t<=s)return!1}return!1},i.onFragLoaded=function(e){var t=e.frag;!Object(te.isFiniteNumber)(t.sn)||t.bitrateTest||(this.fragments[this.getFragmentKey(t)]={body:t,range:Object.create(null),buffered:!1})},i.onBufferAppended=function(e){var t=this;this.timeRanges=e.timeRanges,Object.keys(this.timeRanges).forEach(function(a){var s=t.timeRanges[a];t.detectEvictedFragments(a,s)})},i.onFragBuffered=function(e){this.detectPartialFragments(e.frag)},i.hasFragment=function(e){var t=this.getFragmentKey(e);return this.fragments[t]!==void 0},i.removeFragment=function(e){var t=this.getFragmentKey(e);delete this.fragments[t]},i.removeAllFragments=function(){this.fragments=Object.create(null)},n}(T),ir={search:function(n,i){for(var r=0,e=n.length-1,t=null,a=null;r<=e;){t=(r+e)/2|0,a=n[t];var s=i(a);if(s>0)r=t+1;else if(s<0)e=t-1;else return a}return null}},Ut=ir,m=function(){function o(){}return o.isBuffered=function(i,r){try{if(i){for(var e=i.buffered,t=0;t<e.length;t++)if(r>=e.start(t)&&r<=e.end(t))return!0}}catch(a){}return!1},o.bufferInfo=function(i,r,e){try{if(i){var t=i.buffered,a=[],s;for(s=0;s<t.length;s++)a.push({start:t.start(s),end:t.end(s)});return this.bufferedInfo(a,r,e)}}catch(l){}return{len:0,start:r,end:r,nextStart:void 0}},o.bufferedInfo=function(i,r,e){i.sort(function(q,ie){var ee=q.start-ie.start;return ee||ie.end-q.end});var t=[];if(e)for(var a=0;a<i.length;a++){var s=t.length;if(s){var l=t[s-1].end;i[a].start-l<e?i[a].end>l&&(t[s-1].end=i[a].end):t.push(i[a])}else t.push(i[a])}else t=i;for(var u=0,d,v=r,p=r,A=0;A<t.length;A++){var F=t[A].start,B=t[A].end;if(r+e>=F&&r<B)v=F,p=B,u=p-r;else if(r+e<F){d=F;break}}return{len:u,start:v,end:p,nextStart:d}},o}(),b=V("./node_modules/eventemitter3/index.js"),y=V("./node_modules/webworkify-webpack/index.js"),f=V("./src/demux/demuxer-inline.js");function g(){return window.MediaSource||window.WebKitMediaSource}var x=V("./src/utils/get-self-scope.js");function E(o,n){o.prototype=Object.create(n.prototype),o.prototype.constructor=o,o.__proto__=n}var _=function(o){E(n,o);function n(){return o.apply(this,arguments)||this}var i=n.prototype;return i.trigger=function(e){for(var t=arguments.length,a=new Array(t>1?t-1:0),s=1;s<t;s++)a[s-1]=arguments[s];this.emit.apply(this,[e,e].concat(a))},n}(b.EventEmitter),I=Object(x.getSelfScope)(),O=g()||{isTypeSupported:function(){return!1}},P=function(){function o(i,r){var e=this;this.hls=i,this.id=r;var t=this.observer=new _,a=i.config,s=function(p,A){A=A||{},A.frag=e.frag,A.id=e.id,i.trigger(p,A)};t.on(h.default.FRAG_DECRYPTED,s),t.on(h.default.FRAG_PARSING_INIT_SEGMENT,s),t.on(h.default.FRAG_PARSING_DATA,s),t.on(h.default.FRAG_PARSED,s),t.on(h.default.ERROR,s),t.on(h.default.FRAG_PARSING_METADATA,s),t.on(h.default.FRAG_PARSING_USERDATA,s),t.on(h.default.INIT_PTS_FOUND,s);var l={mp4:O.isTypeSupported("video/mp4"),mpeg:O.isTypeSupported("audio/mpeg"),mp3:O.isTypeSupported('audio/mp4; codecs="mp3"')},u=navigator.vendor;if(a.enableWorker&&typeof Worker!="undefined"){c.logger.log("demuxing in webworker");var d;try{d=this.w=y("./src/demux/demuxer-worker.js"),this.onwmsg=this.onWorkerMessage.bind(this),d.addEventListener("message",this.onwmsg),d.onerror=function(v){i.trigger(h.default.ERROR,{type:L.ErrorTypes.OTHER_ERROR,details:L.ErrorDetails.INTERNAL_EXCEPTION,fatal:!0,event:"demuxerWorker",err:{message:v.message+" ("+v.filename+":"+v.lineno+")"}})},d.postMessage({cmd:"init",typeSupported:l,vendor:u,id:r,config:JSON.stringify(a)})}catch(v){c.logger.warn("Error in worker:",v),c.logger.error("Error while initializing DemuxerWorker, fallback on DemuxerInline"),d&&I.URL.revokeObjectURL(d.objectURL),this.demuxer=new f.default(t,l,a,u),this.w=void 0}}else this.demuxer=new f.default(t,l,a,u)}var n=o.prototype;return n.destroy=function(){var r=this.w;if(r)r.removeEventListener("message",this.onwmsg),r.terminate(),this.w=null;else{var e=this.demuxer;e&&(e.destroy(),this.demuxer=null)}var t=this.observer;t&&(t.removeAllListeners(),this.observer=null)},n.push=function(r,e,t,a,s,l,u,d){var v=this.w,p=Object(te.isFiniteNumber)(s.startPTS)?s.startPTS:s.start,A=s.decryptdata,F=this.frag,B=!(F&&s.cc===F.cc),q=!(F&&s.level===F.level),ie=F&&s.sn===F.sn+1,ee=!q&&ie;if(B&&c.logger.log(this.id+":discontinuity detected"),q&&c.logger.log(this.id+":switch detected"),this.frag=s,v)v.postMessage({cmd:"demux",data:r,decryptdata:A,initSegment:e,audioCodec:t,videoCodec:a,timeOffset:p,discontinuity:B,trackSwitch:q,contiguous:ee,duration:l,accurateTimeOffset:u,defaultInitPTS:d},r instanceof ArrayBuffer?[r]:[]);else{var ue=this.demuxer;ue&&ue.push(r,A,e,t,a,p,B,q,ee,l,u,d)}},n.onWorkerMessage=function(r){var e=r.data,t=this.hls;switch(e.event){case"init":I.URL.revokeObjectURL(this.w.objectURL);break;case h.default.FRAG_PARSING_DATA:e.data.data1=new Uint8Array(e.data1),e.data2&&(e.data.data2=new Uint8Array(e.data2));default:e.data=e.data||{},e.data.frag=this.frag,e.data.id=this.id,t.trigger(e.event,e.data);break}},o}(),N=P;function G(o,n,i){switch(n){case"audio":o.audioGroupIds||(o.audioGroupIds=[]),o.audioGroupIds.push(i);break;case"text":o.textGroupIds||(o.textGroupIds=[]),o.textGroupIds.push(i);break}}function U(o,n,i){var r=o[n],e=o[i],t=e.startPTS;if(Object(te.isFiniteNumber)(t))i>n?(r.duration=t-r.start,r.duration<0&&c.logger.warn("negative duration computed for frag "+r.sn+",level "+r.level+", there should be some duration drift between playlist and fragment!")):(e.duration=r.start-t,e.duration<0&&c.logger.warn("negative duration computed for frag "+e.sn+",level "+e.level+", there should be some duration drift between playlist and fragment!"));else if(i>n){var a=r.cc===e.cc;e.start=r.start+(a&&r.minEndPTS?r.minEndPTS-r.start:r.duration)}else e.start=Math.max(r.start-e.duration,0)}function z(o,n,i,r,e,t){var a=i,s=r;if(Object(te.isFiniteNumber)(n.startPTS)){var l=Math.abs(n.startPTS-i);Object(te.isFiniteNumber)(n.deltaPTS)?n.deltaPTS=Math.max(l,n.deltaPTS):n.deltaPTS=l,a=Math.max(i,n.startPTS),i=Math.min(i,n.startPTS),s=Math.min(r,n.endPTS),r=Math.max(r,n.endPTS),e=Math.min(e,n.startDTS),t=Math.max(t,n.endDTS)}var u=i-n.start;n.start=n.startPTS=i,n.maxStartPTS=a,n.endPTS=r,n.minEndPTS=s,n.startDTS=e,n.endDTS=t,n.duration=r-i;var d=n.sn;if(!o||d<o.startSN||d>o.endSN)return 0;var v,p,A;for(v=d-o.startSN,p=o.fragments,p[v]=n,A=v;A>0;A--)U(p,A,A-1);for(A=v;A<p.length-1;A++)U(p,A,A+1);return o.PTSKnown=!0,u}function $(o,n){n.initSegment&&o.initSegment&&(n.initSegment=o.initSegment);var i=0,r;if(le(o,n,function(a,s){i=a.cc-s.cc,Object(te.isFiniteNumber)(a.startPTS)&&(s.start=s.startPTS=a.startPTS,s.endPTS=a.endPTS,s.duration=a.duration,s.backtracked=a.backtracked,s.dropped=a.dropped,r=s),n.PTSKnown=!0}),!!n.PTSKnown){if(i){c.logger.log("discontinuity sliding from playlist, take drift into account");for(var e=n.fragments,t=0;t<e.length;t++)e[t].cc+=i}r?z(n,r,r.startPTS,r.endPTS,r.startDTS,r.endDTS):re(o,n),n.PTSKnown=o.PTSKnown}}function W(o,n,i){i===void 0&&(i=0);var r=-1;le(o,n,function(a,s,l){s.start=a.start,r=l});var e=n.fragments;if(r<0){e.forEach(function(a){a.start+=i});return}for(var t=r+1;t<e.length;t++)e[t].start=e[t-1].start+e[t-1].duration}function le(o,n,i){if(!(!o||!n))for(var r=Math.max(o.startSN,n.startSN)-n.startSN,e=Math.min(o.endSN,n.endSN)-n.startSN,t=n.startSN-o.startSN,a=r;a<=e;a++){var s=o.fragments[t+a],l=n.fragments[a];if(!s||!l)break;i(s,l,a)}}function re(o,n){var i=n.startSN-o.startSN,r=o.fragments,e=n.fragments;if(!(i<0||i>r.length))for(var t=0;t<e.length;t++)e[t].start+=r[i].start}function de(o,n,i){var r=1e3*(n.averagetargetduration?n.averagetargetduration:n.targetduration),e=r/2;return o&&n.endSN===o.endSN&&(r=e),i&&(r=Math.max(e,r-(window.performance.now()-i))),Math.round(r)}var me={toString:function(n){for(var i="",r=n.length,e=0;e<r;e++)i+="["+n.start(e).toFixed(3)+","+n.end(e).toFixed(3)+"]";return i}},ge=me;function Ae(o,n){for(var i=null,r=0;r<o.length;r+=1){var e=o[r];if(e&&e.cc===n){i=e;break}}return i}function Re(o,n){return Ut.search(o,function(i){return i.cc<n?1:i.cc>n?-1:0})}function ke(o,n,i){var r=!1;return n&&n.details&&i&&(i.endCC>i.startCC||o&&o.cc<i.startCC)&&(r=!0),r}function be(o,n){var i=o.fragments,r=n.fragments;if(!r.length||!i.length){c.logger.log("No fragments to align");return}var e=Ae(i,r[0].cc);if(!e||e&&!e.startPTS){c.logger.log("No frag in previous level to align on");return}return e}function he(o,n){n.fragments.forEach(function(i){if(i){var r=i.start+o;i.start=i.startPTS=r,i.endPTS=r+i.duration}}),n.PTSKnown=!0}function Ke(o,n,i){Xe(o,i,n),!i.PTSKnown&&n&&Me(i,n.details)}function Xe(o,n,i){if(ke(o,i,n)){var r=be(i.details,n);r&&(c.logger.log("Adjusting PTS using last level due to CC increase within current level"),he(r.start,n))}}function Me(o,n){if(n&&n.fragments.length){if(!o.hasProgramDateTime||!n.hasProgramDateTime)return;var i=n.fragments[0].programDateTime,r=o.fragments[0].programDateTime,e=(r-i)/1e3+n.fragments[0].start;Object(te.isFiniteNumber)(e)&&(c.logger.log("adjusting PTS using programDateTime delta, sliding:"+e.toFixed(3)),he(e,o))}}function ze(o,n,i){if(n===null||!Array.isArray(o)||!o.length||!Object(te.isFiniteNumber)(n))return null;var r=o[0].programDateTime;if(n<(r||0))return null;var e=o[o.length-1].endProgramDateTime;if(n>=(e||0))return null;i=i||0;for(var t=0;t<o.length;++t){var a=o[t];if(We(n,i,a))return a}return null}function je(o,n,i,r){i===void 0&&(i=0),r===void 0&&(r=0);var e=null;if(o?e=n[o.sn-n[0].sn+1]:i===0&&n[0].start===0&&(e=n[0]),e&&$e(i,r,e)===0)return e;var t=Ut.search(n,$e.bind(null,i,r));return t||e}function $e(o,n,i){o===void 0&&(o=0),n===void 0&&(n=0);var r=Math.min(n,i.duration+(i.deltaPTS?i.deltaPTS:0));return i.start+i.duration-r<=o?1:i.start-r>o&&i.start?-1:0}function We(o,n,i){var r=Math.min(n,i.duration+(i.deltaPTS?i.deltaPTS:0))*1e3,e=i.endProgramDateTime||0;return e-r>o}var Pe=250,nt=2,xt=.1,st=.05,Ve=function(){function o(i,r,e,t){this.config=i,this.media=r,this.fragmentTracker=e,this.hls=t,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1}var n=o.prototype;return n.poll=function(r){var e=this.config,t=this.media,a=this.stalled,s=t.currentTime,l=t.seeking,u=this.seeking&&!l,d=!this.seeking&&l;if(this.seeking=l,s!==r){if(this.moved=!0,a!==null){if(this.stallReported){var v=self.performance.now()-a;c.logger.warn("playback not stuck anymore @"+s+", after "+Math.round(v)+"ms"),this.stallReported=!1}this.stalled=null,this.nudgeRetry=0}return}if((d||u)&&(this.stalled=null),!(t.paused||t.ended||t.playbackRate===0||!t.buffered.length)){var p=m.bufferInfo(t,s,0),A=p.len>0,F=p.nextStart||0;if(!(!A&&!F)){if(l){var B=p.len>nt,q=!F||F-s>nt&&!this.fragmentTracker.getPartialFragment(s);if(B||q)return;this.moved=!1}if(!this.moved&&this.stalled){var ie=Math.max(F,p.start||0)-s;if(ie>0&&ie<=nt){this._trySkipBufferHole(null);return}}var ee=self.performance.now();if(a===null){this.stalled=ee;return}var ue=ee-a;!l&&ue>=Pe&&this._reportStall(p.len);var fe=m.bufferInfo(t,s,e.maxBufferHole);this._tryFixBufferStall(fe,ue)}}},n._tryFixBufferStall=function(r,e){var t=this.config,a=this.fragmentTracker,s=this.media,l=s.currentTime,u=a.getPartialFragment(l);if(u){var d=this._trySkipBufferHole(u);if(d)return}r.len>t.maxBufferHole&&e>t.highBufferWatchdogPeriod*1e3&&(c.logger.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())},n._reportStall=function(r){var e=this.hls,t=this.media,a=this.stallReported;a||(this.stallReported=!0,c.logger.warn("Playback stalling at @"+t.currentTime+" due to low buffer (buffer="+r+")"),e.trigger(h.default.ERROR,{type:L.ErrorTypes.MEDIA_ERROR,details:L.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:r}))},n._trySkipBufferHole=function(r){for(var e=this.config,t=this.hls,a=this.media,s=a.currentTime,l=0,u=0;u<a.buffered.length;u++){var d=a.buffered.start(u);if(s+e.maxBufferHole>=l&&s<d){var v=Math.max(d+st,a.currentTime+xt);return c.logger.warn("skipping hole, adjusting currentTime from "+s+" to "+v),this.moved=!0,this.stalled=null,a.currentTime=v,r&&t.trigger(h.default.ERROR,{type:L.ErrorTypes.MEDIA_ERROR,details:L.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,reason:"fragment loaded with buffer holes, seeking from "+s+" to "+v,frag:r}),v}l=a.buffered.end(u)}return 0},n._tryNudgeBuffer=function(){var r=this.config,e=this.hls,t=this.media,a=t.currentTime,s=(this.nudgeRetry||0)+1;if(this.nudgeRetry=s,s<r.nudgeMaxRetry){var l=a+s*r.nudgeOffset;c.logger.warn("Nudging 'currentTime' from "+a+" to "+l),t.currentTime=l,e.trigger(h.default.ERROR,{type:L.ErrorTypes.MEDIA_ERROR,details:L.ErrorDetails.BUFFER_NUDGE_ON_STALL,fatal:!1})}else c.logger.error("Playhead still not moving while enough data buffered @"+a+" after "+r.nudgeMaxRetry+" nudges"),e.trigger(h.default.ERROR,{type:L.ErrorTypes.MEDIA_ERROR,details:L.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!0})},o}();function ft(o){if(o===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return o}function dt(o,n){o.prototype=Object.create(n.prototype),o.prototype.constructor=o,o.__proto__=n}var ht=function(o){dt(n,o);function n(r){for(var e,t=arguments.length,a=new Array(t>1?t-1:0),s=1;s<t;s++)a[s-1]=arguments[s];return e=o.call.apply(o,[this,r].concat(a))||this,e._boundTick=void 0,e._tickTimer=null,e._tickInterval=null,e._tickCallCount=0,e._boundTick=e.tick.bind(ft(e)),e}var i=n.prototype;return i.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},i.hasInterval=function(){return!!this._tickInterval},i.hasNextTick=function(){return!!this._tickTimer},i.setInterval=function(e){return this._tickInterval?!1:(this._tickInterval=self.setInterval(this._boundTick,e),!0)},i.clearInterval=function(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1},i.clearNextTick=function(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1},i.tick=function(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&(this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)),this._tickCallCount=0)},i.doTick=function(){},n}(T);function bt(o,n){o.prototype=Object.create(n.prototype),o.prototype.constructor=o,o.__proto__=n}var C={STOPPED:"STOPPED",STARTING:"STARTING",IDLE:"IDLE",PAUSED:"PAUSED",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",BUFFER_FLUSHING:"BUFFER_FLUSHING",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"},yt=function(o){bt(n,o);function n(){return o.apply(this,arguments)||this}var i=n.prototype;return i.doTick=function(){},i.startLoad=function(){},i.stopLoad=function(){var e=this.fragCurrent;e&&(e.loader&&e.loader.abort(),this.fragmentTracker.removeFragment(e)),this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=C.STOPPED},i._streamEnded=function(e,t){var a=this.fragCurrent,s=this.fragmentTracker;if(!t.live&&a&&!a.backtracked&&a.sn===t.endSN&&!e.nextStart){var l=s.getState(a);return l===Ie.PARTIAL||l===Ie.OK}return!1},i.onMediaSeeking=function(){var e=this.config,t=this.media,a=this.mediaBuffer,s=this.state,l=t?t.currentTime:null,u=m.bufferInfo(a||t,l,this.config.maxBufferHole);if(c.logger.log("media seeking to "+(Object(te.isFiniteNumber)(l)?l.toFixed(3):l)),s===C.FRAG_LOADING){var d=this.fragCurrent;if(u.len===0&&d){var v=e.maxFragLookUpTolerance,p=d.start-v,A=d.start+d.duration+v;l<p||l>A?(d.loader&&(c.logger.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),d.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.state=C.IDLE):c.logger.log("seeking outside of buffer but within currently loaded fragment range")}}else s===C.ENDED&&(u.len===0&&(this.fragPrevious=null,this.fragCurrent=null),this.state=C.IDLE);t&&(this.lastCurrentTime=l),this.loadedmetadata||(this.nextLoadPosition=this.startPosition=l),this.tick()},i.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},i.onHandlerDestroying=function(){this.stopLoad(),o.prototype.onHandlerDestroying.call(this)},i.onHandlerDestroyed=function(){this.state=C.STOPPED,this.fragmentTracker=null},i.computeLivePosition=function(e,t){var a=this.config.liveSyncDuration!==void 0?this.config.liveSyncDuration:this.config.liveSyncDurationCount*t.targetduration;return e+Math.max(0,t.totalduration-a)},n}(ht);function it(o,n){for(var i=0;i<n.length;i++){var r=n[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(o,r.key,r)}}function ot(o,n,i){return n&&it(o.prototype,n),i&&it(o,i),o}function Lt(o,n){o.prototype=Object.create(n.prototype),o.prototype.constructor=o,o.__proto__=n}var Dt=100,ct=function(o){Lt(n,o);function n(r,e){var t;return t=o.call(this,r,h.default.MEDIA_ATTACHED,h.default.MEDIA_DETACHING,h.default.MANIFEST_LOADING,h.default.MANIFEST_PARSED,h.default.LEVEL_LOADED,h.default.LEVELS_UPDATED,h.default.KEY_LOADED,h.default.FRAG_LOADED,h.default.FRAG_LOAD_EMERGENCY_ABORTED,h.default.FRAG_PARSING_INIT_SEGMENT,h.default.FRAG_PARSING_DATA,h.default.FRAG_PARSED,h.default.ERROR,h.default.AUDIO_TRACK_SWITCHING,h.default.AUDIO_TRACK_SWITCHED,h.default.BUFFER_CREATED,h.default.BUFFER_APPENDED,h.default.BUFFER_FLUSHED)||this,t.fragmentTracker=e,t.config=r.config,t.audioCodecSwap=!1,t._state=C.STOPPED,t.stallReported=!1,t.gapController=null,t.altAudio=!1,t.audioOnly=!1,t.bitrateTest=!1,t}var i=n.prototype;return i.startLoad=function(e){if(this.levels){var t=this.lastCurrentTime,a=this.hls;if(this.stopLoad(),this.setInterval(Dt),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var s=a.startLevel;s===-1&&(a.config.testBandwidth?(s=0,this.bitrateTest=!0):s=a.nextAutoLevel),this.level=a.nextLoadLevel=s,this.loadedmetadata=!1}t>0&&e===-1&&(c.logger.log("override startPosition with lastCurrentTime @"+t.toFixed(3)),e=t),this.state=C.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()}else this.forceStartLoad=!0,this.state=C.STOPPED},i.stopLoad=function(){this.forceStartLoad=!1,o.prototype.stopLoad.call(this)},i.doTick=function(){switch(this.state){case C.BUFFER_FLUSHING:this.fragLoadError=0;break;case C.IDLE:this._doTickIdle();break;case C.WAITING_LEVEL:var e=this.levels[this.level];e&&e.details&&(this.state=C.IDLE);break;case C.FRAG_LOADING_WAITING_RETRY:var t=window.performance.now(),a=this.retryDate;(!a||t>=a||this.media&&this.media.seeking)&&(c.logger.log("mediaController: retryDate reached, switch back to IDLE state"),this.state=C.IDLE);break;case C.ERROR:case C.STOPPED:case C.FRAG_LOADING:case C.PARSING:case C.PARSED:case C.ENDED:break;default:break}this._checkBuffer(),this._checkFragmentChanged()},i._doTickIdle=function(){var e=this.hls,t=e.config,a=this.media;if(!(this.levelLastLoaded===void 0||!a&&(this.startFragRequested||!t.startFragPrefetch))){if(this.altAudio&&this.audioOnly){this.demuxer.frag=null;return}var s;this.loadedmetadata?s=a.currentTime:s=this.nextLoadPosition;var l=e.nextLoadLevel,u=this.levels[l];if(!!u){var d=u.bitrate,v;d?v=Math.max(8*t.maxBufferSize/d,t.maxBufferLength):v=t.maxBufferLength,v=Math.min(v,t.maxMaxBufferLength);var p=s<t.maxBufferHole?Math.max(nt,t.maxBufferHole):t.maxBufferHole,A=m.bufferInfo(this.mediaBuffer?this.mediaBuffer:a,s,p),F=A.len;if(!(F>=v)){c.logger.trace("buffer length of "+F.toFixed(3)+" is below max of "+v.toFixed(3)+". checking for more payload ..."),this.level=e.nextLoadLevel=l;var B=u.details;if(!B||B.live&&this.levelLastLoaded!==l){this.state=C.WAITING_LEVEL;return}if(this._streamEnded(A,B)){var q={};this.altAudio&&(q.type="video"),this.hls.trigger(h.default.BUFFER_EOS,q),this.state=C.ENDED;return}this._fetchPayloadOrEos(s,A,B)}}}},i._fetchPayloadOrEos=function(e,t,a){var s=this.fragPrevious,l=this.level,u=a.fragments,d=u.length;if(d!==0){var v=u[0].start,p=u[d-1].start+u[d-1].duration,A=t.end,F;if(a.initSegment&&!a.initSegment.data)F=a.initSegment;else if(a.live){var B=this.config.initialLiveManifestSize;if(d<B){c.logger.warn("Can not start playback of a level, reason: not enough fragments "+d+" < "+B);return}if(F=this._ensureFragmentAtLivePoint(a,A,v,p,s,u),F===null)return}else A<v&&(F=u[0]);F||(F=this._findFragment(v,s,d,u,A,p,a)),F&&(F.encrypted?this._loadKey(F,a):this._loadFragment(F,a,e,A))}},i._ensureFragmentAtLivePoint=function(e,t,a,s,l,u){var d=this.hls.config,v=this.media,p,A=1/0;if(d.liveMaxLatencyDuration!==void 0?A=d.liveMaxLatencyDuration:Object(te.isFiniteNumber)(d.liveMaxLatencyDurationCount)&&(A=d.liveMaxLatencyDurationCount*e.targetduration),t<Math.max(a-d.maxFragLookUpTolerance,s-A)){var F=this.liveSyncPosition=this.computeLivePosition(a,e);t=F,v&&!v.paused&&v.readyState&&v.duration>F&&F>v.currentTime&&(c.logger.log("buffer end: "+t.toFixed(3)+" is located too far from the end of live sliding playlist, reset currentTime to : "+F.toFixed(3)),v.currentTime=F),this.nextLoadPosition=F}if(e.PTSKnown&&t>s&&v&&v.readyState)return null;if(this.startFragRequested&&!e.PTSKnown&&l)if(e.hasProgramDateTime)c.logger.log("live playlist, switching playlist, load frag with same PDT: "+l.programDateTime),p=ze(u,l.endProgramDateTime,d.maxFragLookUpTolerance);else{var B=l.sn+1;if(B>=e.startSN&&B<=e.endSN){var q=u[B-e.startSN];l.cc===q.cc&&(p=q,c.logger.log("live playlist, switching playlist, load frag with next SN: "+p.sn))}p||(p=Ut.search(u,function(ie){return l.cc-ie.cc}),p&&c.logger.log("live playlist, switching playlist, load frag with same CC: "+p.sn))}return p},i._findFragment=function(e,t,a,s,l,u,d){var v=this.hls.config,p;if(l<u){var A=l>u-v.maxFragLookUpTolerance?0:v.maxFragLookUpTolerance;p=je(t,s,l,A)}else p=s[a-1];if(p){var F=p.sn-d.startSN,B=t&&p.level===t.level,q=s[F-1],ie=s[F+1];if(t&&p.sn===t.sn)if(B&&!p.backtracked)if(p.sn<d.endSN){var ee=t.deltaPTS;ee&&ee>v.maxBufferHole&&t.dropped&&F?(p=q,c.logger.warn("Previous fragment was dropped with large PTS gap between audio and video. Maybe fragment is not starting with a keyframe? Loading previous one to try to overcome this")):(p=ie,this.fragmentTracker.getState(p)!==Ie.OK&&c.logger.log("Re-loading fragment with SN: "+p.sn))}else p=null;else p.backtracked&&(ie&&ie.backtracked?(c.logger.warn("Already backtracked from fragment "+ie.sn+", will not backtrack to fragment "+p.sn+". Loading fragment "+ie.sn),p=ie):(c.logger.warn("Loaded fragment with dropped frames, backtracking 1 segment to find a keyframe"),p.dropped=0,q?(p=q,p.backtracked=!0):F&&(p=null)))}return p},i._loadKey=function(e,t){c.logger.log("Loading key for "+e.sn+" of ["+t.startSN+"-"+t.endSN+"], level "+this.level),this.state=C.KEY_LOADING,this.hls.trigger(h.default.KEY_LOADING,{frag:e})},i._loadFragment=function(e,t,a,s){var l=this.fragmentTracker.getState(e);this.fragCurrent=e,e.sn!=="initSegment"&&(this.startFragRequested=!0),Object(te.isFiniteNumber)(e.sn)&&!e.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),e.backtracked||l===Ie.NOT_LOADED||l===Ie.PARTIAL?(e.autoLevel=this.hls.autoLevelEnabled,e.bitrateTest=this.bitrateTest,c.logger.log("Loading "+e.sn+" of ["+t.startSN+"-"+t.endSN+"], level "+this.level+", "+(this.loadedmetadata?"currentTime":"nextLoadPosition")+": "+parseFloat(a.toFixed(3))+", bufferEnd: "+parseFloat(s.toFixed(3))),this.hls.trigger(h.default.FRAG_LOADING,{frag:e}),this.demuxer||(this.demuxer=new N(this.hls,"main")),this.state=C.FRAG_LOADING):l===Ie.APPENDING&&this._reduceMaxBufferLength(e.duration)&&this.fragmentTracker.removeFragment(e)},i.getBufferedFrag=function(e){return this.fragmentTracker.getBufferedFrag(e,R.MAIN)},i.followingBufferedFrag=function(e){return e?this.getBufferedFrag(e.endPTS+.5):null},i._checkFragmentChanged=function(){var e,t,a=this.media;if(a&&a.readyState&&a.seeking===!1&&(t=a.currentTime,t>this.lastCurrentTime&&(this.lastCurrentTime=t),m.isBuffered(a,t)?e=this.getBufferedFrag(t):m.isBuffered(a,t+.1)&&(e=this.getBufferedFrag(t+.1)),e)){var s=e;if(s!==this.fragPlaying){this.hls.trigger(h.default.FRAG_CHANGED,{frag:s});var l=s.level;(!this.fragPlaying||this.fragPlaying.level!==l)&&this.hls.trigger(h.default.LEVEL_SWITCHED,{level:l}),this.fragPlaying=s}}},i.immediateLevelSwitch=function(){if(c.logger.log("immediateLevelSwitch"),!this.immediateSwitch){this.immediateSwitch=!0;var e=this.media,t;e?(t=e.paused,t||e.pause()):t=!0,this.previouslyPaused=t}var a=this.fragCurrent;a&&a.loader&&a.loader.abort(),this.fragCurrent=null,this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},i.immediateLevelSwitchEnd=function(){var e=this.media;e&&e.buffered.length&&(this.immediateSwitch=!1,e.currentTime>0&&m.isBuffered(e,e.currentTime)&&(e.currentTime-=1e-4),this.previouslyPaused||e.play())},i.nextLevelSwitch=function(){var e=this.media;if(e&&e.readyState){var t,a=this.getBufferedFrag(e.currentTime);if(a&&a.startPTS>1&&this.flushMainBuffer(0,a.startPTS-1),e.paused)t=0;else{var s=this.hls.nextLoadLevel,l=this.levels[s],u=this.fragLastKbps;u&&this.fragCurrent?t=this.fragCurrent.duration*l.bitrate/(1e3*u)+1:t=0}var d=this.getBufferedFrag(e.currentTime+t);if(d){var v=this.followingBufferedFrag(d);if(v){var p=this.fragCurrent;p&&p.loader&&p.loader.abort(),this.fragCurrent=null;var A=Math.max(d.endPTS,v.maxStartPTS+Math.min(this.config.maxFragLookUpTolerance,v.duration));this.flushMainBuffer(A,Number.POSITIVE_INFINITY)}}}},i.flushMainBuffer=function(e,t){this.state=C.BUFFER_FLUSHING;var a={startOffset:e,endOffset:t};this.altAudio&&(a.type="video"),this.hls.trigger(h.default.BUFFER_FLUSHING,a)},i.onMediaAttached=function(e){var t=this.media=this.mediaBuffer=e.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),this.onvended=this.onMediaEnded.bind(this),t.addEventListener("seeking",this.onvseeking),t.addEventListener("seeked",this.onvseeked),t.addEventListener("ended",this.onvended);var a=this.config;this.levels&&a.autoStartLoad&&this.hls.startLoad(a.startPosition),this.gapController=new Ve(a,t,this.fragmentTracker,this.hls)},i.onMediaDetaching=function(){var e=this.media;e&&e.ended&&(c.logger.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0);var t=this.levels;t&&t.forEach(function(a){a.details&&a.details.fragments.forEach(function(s){s.backtracked=void 0})}),e&&(e.removeEventListener("seeking",this.onvseeking),e.removeEventListener("seeked",this.onvseeked),e.removeEventListener("ended",this.onvended),this.onvseeking=this.onvseeked=this.onvended=null),this.fragmentTracker.removeAllFragments(),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.stopLoad()},i.onMediaSeeked=function(){var e=this.media,t=e?e.currentTime:void 0;Object(te.isFiniteNumber)(t)&&c.logger.log("media seeked to "+t.toFixed(3)),this.tick()},i.onManifestLoading=function(){c.logger.log("trigger BUFFER_RESET"),this.hls.trigger(h.default.BUFFER_RESET),this.fragmentTracker.removeAllFragments(),this.stalled=!1,this.startPosition=this.lastCurrentTime=0},i.onManifestParsed=function(e){var t=!1,a=!1,s;e.levels.forEach(function(u){s=u.audioCodec,s&&(s.indexOf("mp4a.40.2")!==-1&&(t=!0),s.indexOf("mp4a.40.5")!==-1&&(a=!0))}),this.audioCodecSwitch=t&&a,this.audioCodecSwitch&&c.logger.log("both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.altAudio=e.altAudio,this.levels=e.levels,this.startFragRequested=!1;var l=this.config;(l.autoStartLoad||this.forceStartLoad)&&this.hls.startLoad(l.startPosition)},i.onLevelLoaded=function(e){var t=e.details,a=e.level,s=this.levels[this.levelLastLoaded],l=this.levels[a],u=t.totalduration,d=0;if(c.logger.log("level "+a+" loaded ["+t.startSN+","+t.endSN+"],duration:"+u),t.live||l.details&&l.details.live){var v=l.details;v&&t.fragments.length>0?($(v,t),d=t.fragments[0].start,this.liveSyncPosition=this.computeLivePosition(d,v),t.PTSKnown&&Object(te.isFiniteNumber)(d)?c.logger.log("live playlist sliding:"+d.toFixed(3)):(c.logger.log("live playlist - outdated PTS, unknown sliding"),Ke(this.fragPrevious,s,t))):(c.logger.log("live playlist - first load, unknown sliding"),t.PTSKnown=!1,Ke(this.fragPrevious,s,t))}else t.PTSKnown=!1;if(l.details=t,this.levelLastLoaded=a,this.hls.trigger(h.default.LEVEL_UPDATED,{details:t,level:a}),this.startFragRequested===!1){if(this.startPosition===-1||this.lastCurrentTime===-1){var p=t.startTimeOffset;Object(te.isFiniteNumber)(p)?(p<0&&(c.logger.log("negative start time offset "+p+", count from end of last fragment"),p=d+u+p),c.logger.log("start time offset found in playlist, adjust startPosition to "+p),this.startPosition=p):t.live?(this.startPosition=this.computeLivePosition(d,t),c.logger.log("configure startPosition to "+this.startPosition)):this.startPosition=0,this.lastCurrentTime=this.startPosition}this.nextLoadPosition=this.startPosition}this.state===C.WAITING_LEVEL&&(this.state=C.IDLE),this.tick()},i.onKeyLoaded=function(){this.state===C.KEY_LOADING&&(this.state=C.IDLE,this.tick())},i.onFragLoaded=function(e){var t=this.fragCurrent,a=this.hls,s=this.levels,l=this.media,u=e.frag;if(this.state===C.FRAG_LOADING&&t&&u.type==="main"&&u.level===t.level&&u.sn===t.sn){var d=e.stats,v=s[t.level],p=v.details;if(this.bitrateTest=!1,this.stats=d,c.logger.log("Loaded "+t.sn+" of ["+p.startSN+" ,"+p.endSN+"],level "+t.level),u.bitrateTest&&a.nextLoadLevel)this.state=C.IDLE,this.startFragRequested=!1,d.tparsed=d.tbuffered=window.performance.now(),a.trigger(h.default.FRAG_BUFFERED,{stats:d,frag:t,id:"main"}),this.tick();else if(u.sn==="initSegment")this.state=C.IDLE,d.tparsed=d.tbuffered=window.performance.now(),p.initSegment.data=e.payload,a.trigger(h.default.FRAG_BUFFERED,{stats:d,frag:t,id:"main"}),this.tick();else{c.logger.log("Parsing "+t.sn+" of ["+p.startSN+" ,"+p.endSN+"],level "+t.level+", cc "+t.cc),this.state=C.PARSING,this.pendingBuffering=!0,this.appended=!1,u.bitrateTest&&(u.bitrateTest=!1,this.fragmentTracker.onFragLoaded({frag:u}));var A=!(l&&l.seeking)&&(p.PTSKnown||!p.live),F=p.initSegment?p.initSegment.data:[],B=this._getAudioCodec(v),q=this.demuxer=this.demuxer||new N(this.hls,"main");q.push(e.payload,F,B,v.videoCodec,t,p.totalduration,A)}}this.fragLoadError=0},i.onFragParsingInitSegment=function(e){var t=this.fragCurrent,a=e.frag;if(t&&e.id==="main"&&a.sn===t.sn&&a.level===t.level&&this.state===C.PARSING){var s=e.tracks,l,u;if(this.audioOnly=s.audio&&!s.video,this.altAudio&&!this.audioOnly&&delete s.audio,u=s.audio,u){var d=this.levels[this.level].audioCodec,v=navigator.userAgent.toLowerCase();d&&this.audioCodecSwap&&(c.logger.log("swapping playlist audio codec"),d.indexOf("mp4a.40.5")!==-1?d="mp4a.40.2":d="mp4a.40.5"),this.audioCodecSwitch&&u.metadata.channelCount!==1&&v.indexOf("firefox")===-1&&(d="mp4a.40.5"),v.indexOf("android")!==-1&&u.container!=="audio/mpeg"&&(d="mp4a.40.2",c.logger.log("Android: force audio codec to "+d)),u.levelCodec=d,u.id=e.id}u=s.video,u&&(u.levelCodec=this.levels[this.level].videoCodec,u.id=e.id),this.hls.trigger(h.default.BUFFER_CODECS,s);for(l in s){u=s[l],c.logger.log("main track:"+l+",container:"+u.container+",codecs[level/parsed]=["+u.levelCodec+"/"+u.codec+"]");var p=u.initSegment;p&&(this.appended=!0,this.pendingBuffering=!0,this.hls.trigger(h.default.BUFFER_APPENDING,{type:l,data:p,parent:"main",content:"initSegment"}))}this.tick()}},i.onFragParsingData=function(e){var t=this,a=this.fragCurrent,s=e.frag;if(a&&e.id==="main"&&s.sn===a.sn&&s.level===a.level&&!(e.type==="audio"&&this.altAudio)&&this.state===C.PARSING){var l=this.levels[this.level],u=a;if(Object(te.isFiniteNumber)(e.endPTS)||(e.endPTS=e.startPTS+a.duration,e.endDTS=e.startDTS+a.duration),e.hasAudio===!0&&u.addElementaryStream(H.AUDIO),e.hasVideo===!0&&u.addElementaryStream(H.VIDEO),c.logger.log("Parsed "+e.type+",PTS:["+e.startPTS.toFixed(3)+","+e.endPTS.toFixed(3)+"],DTS:["+e.startDTS.toFixed(3)+"/"+e.endDTS.toFixed(3)+"],nb:"+e.nb+",dropped:"+(e.dropped||0)),e.type==="video")if(u.dropped=e.dropped,u.dropped)if(u.backtracked)c.logger.warn("Already backtracked on this fragment, appending with the gap",u.sn);else{var d=l.details;if(d&&u.sn===d.startSN)c.logger.warn("missing video frame(s) on first frag, appending with gap",u.sn);else{c.logger.warn("missing video frame(s), backtracking fragment",u.sn),this.fragmentTracker.removeFragment(u),u.backtracked=!0,this.nextLoadPosition=e.startPTS,this.state=C.IDLE,this.fragPrevious=u,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.tick();return}}else u.backtracked=!1;var v=z(l.details,u,e.startPTS,e.endPTS,e.startDTS,e.endDTS),p=this.hls;p.trigger(h.default.LEVEL_PTS_UPDATED,{details:l.details,level:this.level,drift:v,type:e.type,start:e.startPTS,end:e.endPTS}),[e.data1,e.data2].forEach(function(A){A&&A.length&&t.state===C.PARSING&&(t.appended=!0,t.pendingBuffering=!0,p.trigger(h.default.BUFFER_APPENDING,{type:e.type,data:A,parent:"main",content:"data"}))}),this.tick()}},i.onFragParsed=function(e){var t=this.fragCurrent,a=e.frag;t&&e.id==="main"&&a.sn===t.sn&&a.level===t.level&&this.state===C.PARSING&&(this.stats.tparsed=window.performance.now(),this.state=C.PARSED,this._checkAppendedParsed())},i.onAudioTrackSwitching=function(e){var t=this.altAudio,a=!!e.url,s=e.id;if(!a){if(this.mediaBuffer!==this.media){c.logger.log("switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var l=this.fragCurrent;l.loader&&(c.logger.log("switching to main audio track, cancel main fragment load"),l.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=C.IDLE}var u=this.hls;t&&u.trigger(h.default.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),u.trigger(h.default.AUDIO_TRACK_SWITCHED,{id:s})}},i.onAudioTrackSwitched=function(e){var t=e.id,a=!!this.hls.audioTracks[t].url;if(a){var s=this.videoBuffer;s&&this.mediaBuffer!==s&&(c.logger.log("switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=s)}this.altAudio=a,this.tick()},i.onBufferCreated=function(e){var t=e.tracks,a,s,l=!1;for(var u in t){var d=t[u];d.id==="main"?(s=u,a=d,u==="video"&&(this.videoBuffer=t[u].buffer)):l=!0}l&&a?(c.logger.log("alternate track found, use "+s+".buffered to schedule main fragment loading"),this.mediaBuffer=a.buffer):this.mediaBuffer=this.media},i.onBufferAppended=function(e){if(e.parent==="main"){var t=this.state;(t===C.PARSING||t===C.PARSED)&&(this.pendingBuffering=e.pending>0,this._checkAppendedParsed())}},i._checkAppendedParsed=function(){if(this.state===C.PARSED&&(!this.appended||!this.pendingBuffering)){var e=this.fragCurrent;if(e){var t=this.mediaBuffer?this.mediaBuffer:this.media;c.logger.log("main buffered : "+ge.toString(t.buffered)),this.fragPrevious=e;var a=this.stats;a.tbuffered=window.performance.now(),this.fragLastKbps=Math.round(8*a.total/(a.tbuffered-a.tfirst)),this.hls.trigger(h.default.FRAG_BUFFERED,{stats:a,frag:e,id:"main"}),this.state=C.IDLE}(this.loadedmetadata||this.startPosition<=0)&&this.tick()}},i.onError=function(e){var t=e.frag||this.fragCurrent;if(!(t&&t.type!=="main")){var a=!!this.media&&m.isBuffered(this.media,this.media.currentTime)&&m.isBuffered(this.media,this.media.currentTime+.5);switch(e.details){case L.ErrorDetails.FRAG_LOAD_ERROR:case L.ErrorDetails.FRAG_LOAD_TIMEOUT:case L.ErrorDetails.KEY_LOAD_ERROR:case L.ErrorDetails.KEY_LOAD_TIMEOUT:if(!e.fatal)if(this.fragLoadError+1<=this.config.fragLoadingMaxRetry){var s=Math.min(Math.pow(2,this.fragLoadError)*this.config.fragLoadingRetryDelay,this.config.fragLoadingMaxRetryTimeout);c.logger.warn("mediaController: frag loading failed, retry in "+s+" ms"),this.retryDate=window.performance.now()+s,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.fragLoadError++,this.state=C.FRAG_LOADING_WAITING_RETRY}else c.logger.error("mediaController: "+e.details+" reaches max retry, redispatch as fatal ..."),e.fatal=!0,this.state=C.ERROR;break;case L.ErrorDetails.LEVEL_LOAD_ERROR:case L.ErrorDetails.LEVEL_LOAD_TIMEOUT:this.state!==C.ERROR&&(e.fatal?(this.state=C.ERROR,c.logger.warn("streamController: "+e.details+",switch to "+this.state+" state ...")):!e.levelRetry&&this.state===C.WAITING_LEVEL&&(this.state=C.IDLE));break;case L.ErrorDetails.BUFFER_FULL_ERROR:e.parent==="main"&&(this.state===C.PARSING||this.state===C.PARSED)&&(a?(this._reduceMaxBufferLength(this.config.maxBufferLength),this.state=C.IDLE):(c.logger.warn("buffer full error also media.currentTime is not buffered, flush everything"),this.fragCurrent=null,this.flushMainBuffer(0,Number.POSITIVE_INFINITY)));break;default:break}}},i._reduceMaxBufferLength=function(e){var t=this.config;return t.maxMaxBufferLength>=e?(t.maxMaxBufferLength/=2,c.logger.warn("main:reduce max buffer length to "+t.maxMaxBufferLength+"s"),!0):!1},i._checkBuffer=function(){var e=this.media;if(!(!e||e.readyState===0)){var t=this.mediaBuffer?this.mediaBuffer:e,a=t.buffered;!this.loadedmetadata&&a.length?(this.loadedmetadata=!0,this._seekToStartPos()):this.immediateSwitch?this.immediateLevelSwitchEnd():this.gapController.poll(this.lastCurrentTime,a)}},i.onFragLoadEmergencyAborted=function(){this.state=C.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tick()},i.onBufferFlushed=function(){var e=this.mediaBuffer?this.mediaBuffer:this.media;if(e){var t=this.audioOnly?H.AUDIO:H.VIDEO;this.fragmentTracker.detectEvictedFragments(t,e.buffered)}this.state=C.IDLE,this.fragPrevious=null},i.onLevelsUpdated=function(e){this.levels=e.levels},i.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},i._seekToStartPos=function(){var e=this.media,t=e.currentTime,a=this.startPosition;if(t!==a&&a>=0){if(e.seeking){c.logger.log("could not seek to "+a+", already seeking at "+t);return}var s=e.buffered.length?e.buffered.start(0):0,l=s-a;l>0&&l<this.config.maxBufferHole&&(c.logger.log("adjusting start position by "+l+" to match buffer start"),a+=l,this.startPosition=a),c.logger.log("seek to target start position "+a+" from current time "+t+". ready state "+e.readyState),e.currentTime=a}},i._getAudioCodec=function(e){var t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&(c.logger.log("swapping playlist audio codec"),t&&(t.indexOf("mp4a.40.5")!==-1?t="mp4a.40.2":t="mp4a.40.5")),t},ot(n,[{key:"state",set:function(e){if(this.state!==e){var t=this.state;this._state=e,c.logger.log("main stream-controller: "+t+"->"+e),this.hls.trigger(h.default.STREAM_STATE_TRANSITION,{previousState:t,nextState:e})}},get:function(){return this._state}},{key:"currentLevel",get:function(){var e=this.media;if(e){var t=this.getBufferedFrag(e.currentTime);if(t)return t.level}return-1}},{key:"nextBufferedFrag",get:function(){var e=this.media;return e?this.followingBufferedFrag(this.getBufferedFrag(e.currentTime)):null}},{key:"nextLevel",get:function(){var e=this.nextBufferedFrag;return e?e.level:-1}},{key:"liveSyncPosition",get:function(){return this._liveSyncPosition},set:function(e){this._liveSyncPosition=e}}]),n}(yt),Bt=ct;function Yt(o,n){for(var i=0;i<n.length;i++){var r=n[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(o,r.key,r)}}function Xt(o,n,i){return n&&Yt(o.prototype,n),i&&Yt(o,i),o}function ar(o,n){o.prototype=Object.create(n.prototype),o.prototype.constructor=o,o.__proto__=n}var Ot,zt=function(o){ar(n,o);function n(r){var e;return e=o.call(this,r,h.default.MANIFEST_LOADED,h.default.LEVEL_LOADED,h.default.AUDIO_TRACK_SWITCHED,h.default.FRAG_LOADED,h.default.ERROR)||this,e.canload=!1,e.currentLevelIndex=null,e.manualLevelIndex=-1,e.timer=null,Ot=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),e}var i=n.prototype;return i.onHandlerDestroying=function(){this.clearTimer(),this.manualLevelIndex=-1},i.clearTimer=function(){this.timer!==null&&(clearTimeout(this.timer),this.timer=null)},i.startLoad=function(){var e=this._levels;this.canload=!0,this.levelRetryCount=0,e&&e.forEach(function(t){t.loadError=0;var a=t.details;a&&a.live&&(t.details=void 0)}),this.timer!==null&&this.loadLevel()},i.stopLoad=function(){this.canload=!1},i.onManifestLoaded=function(e){var t=[],a=[],s,l={},u=null,d=!1,v=!1;if(e.levels.forEach(function(F){var B=F.attrs;F.loadError=0,F.fragmentError=!1,d=d||!!F.videoCodec,v=v||!!F.audioCodec,Ot&&F.audioCodec&&F.audioCodec.indexOf("mp4a.40.34")!==-1&&(F.audioCodec=void 0),u=l[F.bitrate],u?u.url.push(F.url):(F.url=[F.url],F.urlId=0,l[F.bitrate]=F,t.push(F)),B&&(B.AUDIO&&G(u||F,"audio",B.AUDIO),B.SUBTITLES&&G(u||F,"text",B.SUBTITLES))}),d&&v&&(t=t.filter(function(F){var B=F.videoCodec;return!!B})),t=t.filter(function(F){var B=F.audioCodec,q=F.videoCodec;return(!B||Le(B,"audio"))&&(!q||Le(q,"video"))}),e.audioTracks&&(a=e.audioTracks.filter(function(F){return!F.audioCodec||Le(F.audioCodec,"audio")}),a.forEach(function(F,B){F.id=B})),t.length>0){s=t[0].bitrate,t.sort(function(F,B){return F.bitrate-B.bitrate}),this._levels=t;for(var p=0;p<t.length;p++)if(t[p].bitrate===s){this._firstLevel=p,c.logger.log("manifest loaded,"+t.length+" level(s) found, first bitrate:"+s);break}var A=v&&!d;this.hls.trigger(h.default.MANIFEST_PARSED,{levels:t,audioTracks:a,firstLevel:this._firstLevel,stats:e.stats,audio:v,video:d,altAudio:!A&&a.some(function(F){return!!F.url})})}else this.hls.trigger(h.default.ERROR,{type:L.ErrorTypes.MEDIA_ERROR,details:L.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:this.hls.url,reason:"no level with compatible codecs found in manifest"})},i.setLevelInternal=function(e){var t=this._levels,a=this.hls;if(e>=0&&e<t.length){if(this.clearTimer(),this.currentLevelIndex!==e){c.logger.log("switching to level "+e),this.currentLevelIndex=e;var s=t[e];s.level=e,a.trigger(h.default.LEVEL_SWITCHING,s)}var l=t[e],u=l.details;if(!u||u.live){var d=l.urlId;a.trigger(h.default.LEVEL_LOADING,{url:l.url[d],level:e,id:d})}}else a.trigger(h.default.ERROR,{type:L.ErrorTypes.OTHER_ERROR,details:L.ErrorDetails.LEVEL_SWITCH_ERROR,level:e,fatal:!1,reason:"invalid level idx"})},i.onError=function(e){if(e.fatal){e.type===L.ErrorTypes.NETWORK_ERROR&&this.clearTimer();return}var t=!1,a=!1,s;switch(e.details){case L.ErrorDetails.FRAG_LOAD_ERROR:case L.ErrorDetails.FRAG_LOAD_TIMEOUT:case L.ErrorDetails.KEY_LOAD_ERROR:case L.ErrorDetails.KEY_LOAD_TIMEOUT:s=e.frag.level,a=!0;break;case L.ErrorDetails.LEVEL_LOAD_ERROR:case L.ErrorDetails.LEVEL_LOAD_TIMEOUT:s=e.context.level,t=!0;break;case L.ErrorDetails.REMUX_ALLOC_ERROR:s=e.level,t=!0;break}s!==void 0&&this.recoverLevel(e,s,t,a)},i.recoverLevel=function(e,t,a,s){var l=this,u=this.hls.config,d=e.details,v=this._levels[t],p,A,F;if(v.loadError++,v.fragmentError=s,a)if(this.levelRetryCount+1<=u.levelLoadingMaxRetry)A=Math.min(Math.pow(2,this.levelRetryCount)*u.levelLoadingRetryDelay,u.levelLoadingMaxRetryTimeout),this.timer=setTimeout(function(){return l.loadLevel()},A),e.levelRetry=!0,this.levelRetryCount++,c.logger.warn("level controller, "+d+", retry in "+A+" ms, current retry count is "+this.levelRetryCount);else{c.logger.error("level controller, cannot recover from "+d+" error"),this.currentLevelIndex=null,this.clearTimer(),e.fatal=!0;return}(a||s)&&(p=v.url.length,p>1&&v.loadError<p?(v.urlId=(v.urlId+1)%p,v.details=void 0,c.logger.warn("level controller, "+d+" for level "+t+": switching to redundant URL-id "+v.urlId)):this.manualLevelIndex===-1?(F=t===0?this._levels.length-1:t-1,c.logger.warn("level controller, "+d+": switch to "+F),this.hls.nextAutoLevel=this.currentLevelIndex=F):s&&(c.logger.warn("level controller, "+d+": reload a fragment"),this.currentLevelIndex=null))},i.onFragLoaded=function(e){var t=e.frag;if(t!==void 0&&t.type==="main"){var a=this._levels[t.level];a!==void 0&&(a.fragmentError=!1,a.loadError=0,this.levelRetryCount=0)}},i.onLevelLoaded=function(e){var t=this,a=e.level,s=e.details;if(a===this.currentLevelIndex){var l=this._levels[a];if(l.fragmentError||(l.loadError=0,this.levelRetryCount=0),s.live){var u=de(l.details,s,e.stats.trequest);c.logger.log("live playlist, reload in "+Math.round(u)+" ms"),this.timer=setTimeout(function(){return t.loadLevel()},u)}else this.clearTimer()}},i.onAudioTrackSwitched=function(e){var t=this.hls.audioTracks[e.id].groupId,a=this.hls.levels[this.currentLevelIndex];if(!!a&&a.audioGroupIds){for(var s=-1,l=0;l<a.audioGroupIds.length;l++)if(a.audioGroupIds[l]===t){s=l;break}s!==a.urlId&&(a.urlId=s,this.startLoad())}},i.loadLevel=function(){if(c.logger.debug("call to loadLevel"),this.currentLevelIndex!==null&&this.canload){var e=this._levels[this.currentLevelIndex];if(typeof e=="object"&&e.url.length>0){var t=this.currentLevelIndex,a=e.urlId,s=e.url[a];c.logger.log("Attempt loading level index "+t+" with URL-id "+a),this.hls.trigger(h.default.LEVEL_LOADING,{url:s,level:t,id:a})}}},i.removeLevel=function(e,t){var a=this.levels.filter(function(s,l){return l!==e?!0:s.url.length>1&&t!==void 0?(s.url=s.url.filter(function(u,d){return d!==t}),s.urlId=0,!0):!1}).map(function(s,l){var u=s.details;return u&&u.fragments&&u.fragments.forEach(function(d){d.level=l}),s});this._levels=a,this.hls.trigger(h.default.LEVELS_UPDATED,{levels:a})},Xt(n,[{key:"levels",get:function(){return this._levels}},{key:"level",get:function(){return this.currentLevelIndex},set:function(e){var t=this._levels;t&&(e=Math.min(e,t.length-1),(this.currentLevelIndex!==e||!t[e].details)&&this.setLevelInternal(e))}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(e){this.manualLevelIndex=e,this._startLevel===void 0&&(this._startLevel=e),e!==-1&&(this.level=e)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(e){this._firstLevel=e}},{key:"startLevel",get:function(){if(this._startLevel===void 0){var e=this.hls.config.startLevel;return e!==void 0?e:this._firstLevel}else return this._startLevel},set:function(e){this._startLevel=e}},{key:"nextLoadLevel",get:function(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(e){this.level=e,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=e)}}]),n}(T),St=V("./src/demux/id3.js");function qt(o,n){var i;try{i=new Event("addtrack")}catch(r){i=document.createEvent("Event"),i.initEvent("addtrack",!1,!1)}i.track=o,n.dispatchEvent(i)}function It(o){if(o!=null&&o.cues)for(;o.cues.length>0;)o.removeCue(o.cues[0])}function Gt(o,n){if(n<o[0].endTime)return o[0];if(n>o[o.length-1].endTime)return o[o.length-1];for(var i=0,r=o.length-1;i<=r;){var e=Math.floor((r+i)/2);if(n<o[e].endTime)r=e-1;else if(n>o[e].endTime)i=e+1;else return o[e]}return o[i].endTime-n<n-o[r].endTime?o[i]:o[r]}function nr(o,n){o.prototype=Object.create(n.prototype),o.prototype.constructor=o,o.__proto__=n}var Qt=.25,$t=function(o){nr(n,o);function n(r){var e;return e=o.call(this,r,h.default.MEDIA_ATTACHED,h.default.MEDIA_DETACHING,h.default.FRAG_PARSING_METADATA,h.default.LIVE_BACK_BUFFER_REACHED)||this,e.id3Track=void 0,e.media=void 0,e}var i=n.prototype;return i.destroy=function(){T.prototype.destroy.call(this)},i.onMediaAttached=function(e){this.media=e.media,this.media},i.onMediaDetaching=function(){It(this.id3Track),this.id3Track=void 0,this.media=void 0},i.getID3Track=function(e){for(var t=0;t<e.length;t++){var a=e[t];if(a.kind==="metadata"&&a.label==="id3")return qt(a,this.media),a}return this.media.addTextTrack("metadata","id3")},i.onFragParsingMetadata=function(e){var t=e.frag,a=e.samples;this.id3Track||(this.id3Track=this.getID3Track(this.media.textTracks),this.id3Track.mode="hidden");for(var s=window.WebKitDataCue||window.VTTCue||window.TextTrackCue,l=0;l<a.length;l++){var u=St.default.getID3Frames(a[l].data);if(u){var d=Math.max(a[l].pts,0),v=l<a.length-1?a[l+1].pts:t.endPTS;v||(v=t.start+t.duration);var p=v-d;p<=0&&(v=d+Qt);for(var A=0;A<u.length;A++){var F=u[A];if(!St.default.isTimeStampFrame(F)){var B=new s(d,v,"");B.value=F,this.id3Track.addCue(B)}}}}},i.onLiveBackBufferReached=function(e){var t=e.bufferEnd,a=this.id3Track;if(!(!a||!a.cues||!a.cues.length)){var s=Gt(a.cues,t);if(!!s)for(;a.cues[0]!==s;)a.removeCue(a.cues[0])}},n}(T),Ct=$t;function Kt(){var o=g();if(!o)return!1;var n=self.SourceBuffer||self.WebKitSourceBuffer,i=o&&typeof o.isTypeSupported=="function"&&o.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),r=!n||n.prototype&&typeof n.prototype.appendBuffer=="function"&&typeof n.prototype.remove=="function";return!!i&&!!r}var sr=function(){function o(i){this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.alpha_=i?Math.exp(Math.log(.5)/i):0,this.estimate_=0,this.totalWeight_=0}var n=o.prototype;return n.sample=function(r,e){var t=Math.pow(this.alpha_,r);this.estimate_=e*(1-t)+t*this.estimate_,this.totalWeight_+=r},n.getTotalWeight=function(){return this.totalWeight_},n.getEstimate=function(){if(this.alpha_){var r=1-Math.pow(this.alpha_,this.totalWeight_);return this.estimate_/r}else return this.estimate_},o}(),Zt=sr,qr=function(){function o(i,r,e,t){this.hls=void 0,this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.hls=i,this.defaultEstimate_=t,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new Zt(r),this.fast_=new Zt(e)}var n=o.prototype;return n.sample=function(r,e){r=Math.max(r,this.minDelayMs_);var t=8*e,a=r/1e3,s=t/a;this.fast_.sample(a,s),this.slow_.sample(a,s)},n.canEstimate=function(){var r=this.fast_;return r&&r.getTotalWeight()>=this.minWeight_},n.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},n.destroy=function(){},o}(),Qr=qr;function vr(o,n){for(var i=0;i<n.length;i++){var r=n[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(o,r.key,r)}}function $r(o,n,i){return n&&vr(o.prototype,n),i&&vr(o,i),o}function Zr(o){if(o===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return o}function Jr(o,n){o.prototype=Object.create(n.prototype),o.prototype.constructor=o,o.__proto__=n}var ei=window,ti=ei.performance,ri=function(o){Jr(n,o);function n(r){var e;return e=o.call(this,r,h.default.FRAG_LOADING,h.default.FRAG_LOADED,h.default.FRAG_BUFFERED,h.default.ERROR)||this,e.lastLoadedFragLevel=0,e._nextAutoLevel=-1,e.hls=r,e.timer=null,e._bwEstimator=null,e.onCheck=e._abandonRulesCheck.bind(Zr(e)),e}var i=n.prototype;return i.destroy=function(){this.clearTimer(),T.prototype.destroy.call(this)},i.onFragLoading=function(e){var t=e.frag;if(t.type==="main"&&(this.timer||(this.fragCurrent=t,this.timer=setInterval(this.onCheck,100)),!this._bwEstimator)){var a=this.hls,s=a.config,l=t.level,u=a.levels[l].details.live,d,v;u?(d=s.abrEwmaFastLive,v=s.abrEwmaSlowLive):(d=s.abrEwmaFastVoD,v=s.abrEwmaSlowVoD),this._bwEstimator=new Qr(a,v,d,s.abrEwmaDefaultEstimate)}},i._abandonRulesCheck=function(){var e=this.hls,t=e.media,a=this.fragCurrent;if(!!a){var s=a.loader;if(!s||s.stats&&s.stats.aborted){c.logger.warn("frag loader destroy or aborted, disarm abandonRules"),this.clearTimer(),this._nextAutoLevel=-1;return}var l=s.stats;if(t&&l&&(!t.paused&&t.playbackRate!==0||!t.readyState)&&a.autoLevel&&a.level){var u=ti.now()-l.trequest,d=Math.abs(t.playbackRate);if(u>500*a.duration/d){var v=e.levels,p=Math.max(1,l.bw?l.bw/8:l.loaded*1e3/u),A=v[a.level];if(!A)return;var F=A.realBitrate?Math.max(A.realBitrate,A.bitrate):A.bitrate,B=l.total?l.total:Math.max(l.loaded,Math.round(a.duration*F/8)),q=t.currentTime,ie=(B-l.loaded)/p,ee=(m.bufferInfo(t,q,e.config.maxBufferHole).end-q)/d;if(ee<2*a.duration/d&&ie>ee){var ue=e.minAutoLevel,fe,Ee;for(Ee=a.level-1;Ee>ue;Ee--){var Ne=v[Ee].realBitrate?Math.max(v[Ee].realBitrate,v[Ee].bitrate):v[Ee].bitrate,lt=a.duration*Ne/(8*.8*p);if(lt<ee)break}fe<ie&&(c.logger.warn("loading too slow, abort fragment loading and switch to level "+Ee+":fragLoadedDelay["+Ee+"]<fragLoadedDelay["+(a.level-1)+"];bufferStarvationDelay:"+fe.toFixed(1)+"<"+ie.toFixed(1)+":"+ee.toFixed(1)),e.nextLoadLevel=Ee,this._bwEstimator.sample(u,l.loaded),s.abort(),this.clearTimer(),e.trigger(h.default.FRAG_LOAD_EMERGENCY_ABORTED,{frag:a,stats:l}))}}}}},i.onFragLoaded=function(e){var t=e.frag;if(t.type==="main"&&Object(te.isFiniteNumber)(t.sn)){if(this.clearTimer(),this.lastLoadedFragLevel=t.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var a=this.hls.levels[t.level],s=(a.loaded?a.loaded.bytes:0)+e.stats.loaded,l=(a.loaded?a.loaded.duration:0)+e.frag.duration;a.loaded={bytes:s,duration:l},a.realBitrate=Math.round(8*s/l)}if(e.frag.bitrateTest){var u=e.stats;u.tparsed=u.tbuffered=u.tload,this.onFragBuffered(e)}}},i.onFragBuffered=function(e){var t=e.stats,a=e.frag;if(t.aborted!==!0&&a.type==="main"&&Object(te.isFiniteNumber)(a.sn)&&(!a.bitrateTest||t.tload===t.tbuffered)){var s=t.tparsed-t.trequest;c.logger.log("latency/loading/parsing/append/kbps:"+Math.round(t.tfirst-t.trequest)+"/"+Math.round(t.tload-t.tfirst)+"/"+Math.round(t.tparsed-t.tload)+"/"+Math.round(t.tbuffered-t.tparsed)+"/"+Math.round(8*t.loaded/(t.tbuffered-t.trequest))),this._bwEstimator.sample(s,t.loaded),t.bwEstimate=this._bwEstimator.getEstimate(),a.bitrateTest?this.bitrateTestDelay=s/1e3:this.bitrateTestDelay=0}},i.onError=function(e){switch(e.details){case L.ErrorDetails.FRAG_LOAD_ERROR:case L.ErrorDetails.FRAG_LOAD_TIMEOUT:this.clearTimer();break;default:break}},i.clearTimer=function(){clearInterval(this.timer),this.timer=null},i._findBestLevel=function(e,t,a,s,l,u,d,v,p){for(var A=l;A>=s;A--){var F=p[A];if(!!F){var B=F.details,q=B?B.totalduration/B.fragments.length:t,ie=B?B.live:!1,ee=void 0;A<=e?ee=d*a:ee=v*a;var ue=p[A].realBitrate?Math.max(p[A].realBitrate,p[A].bitrate):p[A].bitrate,fe=ue*q/ee;if(c.logger.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+A+"/"+Math.round(ee)+"/"+ue+"/"+q+"/"+u+"/"+fe),ee>ue&&(!fe||ie&&!this.bitrateTestDelay||fe<u))return A}}return-1},$r(n,[{key:"nextAutoLevel",get:function(){var e=this._nextAutoLevel,t=this._bwEstimator;if(e!==-1&&(!t||!t.canEstimate()))return e;var a=this._nextABRAutoLevel;return e!==-1&&(a=Math.min(e,a)),a},set:function(e){this._nextAutoLevel=e}},{key:"_nextABRAutoLevel",get:function(){var e=this.hls,t=e.maxAutoLevel,a=e.levels,s=e.config,l=e.minAutoLevel,u=e.media,d=this.lastLoadedFragLevel,v=this.fragCurrent?this.fragCurrent.duration:0,p=u?u.currentTime:0,A=u&&u.playbackRate!==0?Math.abs(u.playbackRate):1,F=this._bwEstimator?this._bwEstimator.getEstimate():s.abrEwmaDefaultEstimate,B=(m.bufferInfo(u,p,s.maxBufferHole).end-p)/A,q=this._findBestLevel(d,v,F,l,t,B,s.abrBandWidthFactor,s.abrBandWidthUpFactor,a);if(q>=0)return q;c.logger.trace("rebuffering expected to happen, lets try to find a quality level minimizing the rebuffering");var ie=v?Math.min(v,s.maxStarvationDelay):s.maxStarvationDelay,ee=s.abrBandWidthFactor,ue=s.abrBandWidthUpFactor;if(B===0){var fe=this.bitrateTestDelay;if(fe){var Ee=v?Math.min(v,s.maxLoadingDelay):s.maxLoadingDelay;ie=Ee-fe,c.logger.trace("bitrate test took "+Math.round(1e3*fe)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*ie)+" ms"),ee=ue=1}}return q=this._findBestLevel(d,v,F,l,t,B+ie,ee,ue,a),Math.max(q,0)}}]),n}(T),ii=ri;function ai(o,n){o.prototype=Object.create(n.prototype),o.prototype.constructor=o,o.__proto__=n}var pr=g(),ni=function(o){ai(n,o);function n(r){var e;return e=o.call(this,r,h.default.MEDIA_ATTACHING,h.default.MEDIA_DETACHING,h.default.MANIFEST_PARSED,h.default.BUFFER_RESET,h.default.BUFFER_APPENDING,h.default.BUFFER_CODECS,h.default.BUFFER_EOS,h.default.BUFFER_FLUSHING,h.default.LEVEL_PTS_UPDATED,h.default.LEVEL_UPDATED)||this,e._msDuration=null,e._levelDuration=null,e._levelTargetDuration=10,e._live=null,e._objectUrl=null,e._needsFlush=!1,e._needsEos=!1,e.config=void 0,e.audioTimestampOffset=void 0,e.bufferCodecEventsExpected=0,e._bufferCodecEventsTotal=0,e.media=null,e.mediaSource=null,e.segments=[],e.parent=void 0,e.appending=!1,e.appended=0,e.appendError=0,e.flushBufferCounter=0,e.tracks={},e.pendingTracks={},e.sourceBuffer={},e.flushRange=[],e._onMediaSourceOpen=function(){c.logger.log("media source opened"),e.hls.trigger(h.default.MEDIA_ATTACHED,{media:e.media});var t=e.mediaSource;t&&t.removeEventListener("sourceopen",e._onMediaSourceOpen),e.checkPendingTracks()},e._onMediaSourceClose=function(){c.logger.log("media source closed")},e._onMediaSourceEnded=function(){c.logger.log("media source ended")},e._onSBUpdateEnd=function(){if(e.audioTimestampOffset&&e.sourceBuffer.audio){var t=e.sourceBuffer.audio;c.logger.warn("change mpeg audio timestamp offset from "+t.timestampOffset+" to "+e.audioTimestampOffset),t.timestampOffset=e.audioTimestampOffset,delete e.audioTimestampOffset}e._needsFlush&&e.doFlush(),e._needsEos&&e.checkEos(),e.appending=!1;var a=e.parent,s=e.segments.reduce(function(p,A){return A.parent===a?p+1:p},0),l={},u=e.sourceBuffer;for(var d in u){var v=u[d];if(!v)throw Error("handling source buffer update end error: source buffer for "+d+" uninitilized and unable to update buffered TimeRanges.");l[d]=v.buffered}e.hls.trigger(h.default.BUFFER_APPENDED,{parent:a,pending:s,timeRanges:l}),e._needsFlush||e.doAppending(),e.updateMediaElementDuration(),s===0&&e.flushLiveBackBuffer()},e._onSBUpdateError=function(t){c.logger.error("sourceBuffer error:",t),e.hls.trigger(h.default.ERROR,{type:L.ErrorTypes.MEDIA_ERROR,details:L.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1})},e.config=r.config,e}var i=n.prototype;return i.destroy=function(){T.prototype.destroy.call(this)},i.onLevelPtsUpdated=function(e){var t=e.type,a=this.tracks.audio;if(t==="audio"&&a&&a.container==="audio/mpeg"){var s=this.sourceBuffer.audio;if(!s)throw Error("Level PTS Updated and source buffer for audio uninitalized");var l=Math.abs(s.timestampOffset-e.start);if(l>.1){var u=s.updating;try{s.abort()}catch(d){c.logger.warn("can not abort audio buffer: "+d)}u?this.audioTimestampOffset=e.start:(c.logger.warn("change mpeg audio timestamp offset from "+s.timestampOffset+" to "+e.start),s.timestampOffset=e.start)}}},i.onManifestParsed=function(e){var t=2;(e.audio&&!e.video||!e.altAudio)&&(t=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=t,c.logger.log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")},i.onMediaAttaching=function(e){var t=this.media=e.media;if(t&&pr){var a=this.mediaSource=new pr;a.addEventListener("sourceopen",this._onMediaSourceOpen),a.addEventListener("sourceended",this._onMediaSourceEnded),a.addEventListener("sourceclose",this._onMediaSourceClose),t.src=window.URL.createObjectURL(a),this._objectUrl=t.src}},i.onMediaDetaching=function(){c.logger.log("media source detaching");var e=this.mediaSource;if(e){if(e.readyState==="open")try{e.endOfStream()}catch(t){c.logger.warn("onMediaDetaching:"+t.message+" while calling endOfStream")}e.removeEventListener("sourceopen",this._onMediaSourceOpen),e.removeEventListener("sourceended",this._onMediaSourceEnded),e.removeEventListener("sourceclose",this._onMediaSourceClose),this.media&&(this._objectUrl&&window.URL.revokeObjectURL(this._objectUrl),this.media.src===this._objectUrl?(this.media.removeAttribute("src"),this.media.load()):c.logger.warn("media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={},this.sourceBuffer={},this.flushRange=[],this.segments=[],this.appended=0}this.hls.trigger(h.default.MEDIA_DETACHED)},i.checkPendingTracks=function(){var e=this.bufferCodecEventsExpected,t=this.pendingTracks,a=Object.keys(t).length;(a&&!e||a===2)&&(this.createSourceBuffers(t),this.pendingTracks={},this.doAppending())},i.onBufferReset=function(){var e=this.sourceBuffer;for(var t in e){var a=e[t];try{a&&(this.mediaSource&&this.mediaSource.removeSourceBuffer(a),a.removeEventListener("updateend",this._onSBUpdateEnd),a.removeEventListener("error",this._onSBUpdateError))}catch(s){}}this.sourceBuffer={},this.flushRange=[],this.segments=[],this.appended=0},i.onBufferCodecs=function(e){var t=this;Object.keys(this.sourceBuffer).length||(Object.keys(e).forEach(function(a){t.pendingTracks[a]=e[a]}),this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&this.mediaSource.readyState==="open"&&this.checkPendingTracks())},i.createSourceBuffers=function(e){var t=this.sourceBuffer,a=this.mediaSource;if(!a)throw Error("createSourceBuffers called when mediaSource was null");for(var s in e)if(!t[s]){var l=e[s];if(!l)throw Error("source buffer exists for track "+s+", however track does not");var u=l.levelCodec||l.codec,d=l.container+";codecs="+u;c.logger.log("creating sourceBuffer("+d+")");try{var v=t[s]=a.addSourceBuffer(d);v.addEventListener("updateend",this._onSBUpdateEnd),v.addEventListener("error",this._onSBUpdateError),this.tracks[s]={buffer:v,codec:u,id:l.id,container:l.container,levelCodec:l.levelCodec}}catch(p){c.logger.error("error while trying to add sourceBuffer:"+p.message),this.hls.trigger(h.default.ERROR,{type:L.ErrorTypes.MEDIA_ERROR,details:L.ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,err:p,mimeType:d})}}this.hls.trigger(h.default.BUFFER_CREATED,{tracks:this.tracks})},i.onBufferAppending=function(e){this._needsFlush||(this.segments?this.segments.push(e):this.segments=[e],this.doAppending())},i.onBufferEos=function(e){for(var t in this.sourceBuffer)if(!e.type||e.type===t){var a=this.sourceBuffer[t];a&&!a.ended&&(a.ended=!0,c.logger.log(t+" sourceBuffer now EOS"))}this.checkEos()},i.checkEos=function(){var e=this.sourceBuffer,t=this.mediaSource;if(!t||t.readyState!=="open"){this._needsEos=!1;return}for(var a in e){var s=e[a];if(!!s){if(!s.ended)return;if(s.updating){this._needsEos=!0;return}}}c.logger.log("all media data are available, signal endOfStream() to MediaSource and stop loading fragment");try{t.endOfStream()}catch(l){c.logger.warn("exception while calling mediaSource.endOfStream()")}this._needsEos=!1},i.onBufferFlushing=function(e){e.type?this.flushRange.push({start:e.startOffset,end:e.endOffset,type:e.type}):(this.flushRange.push({start:e.startOffset,end:e.endOffset,type:"video"}),this.flushRange.push({start:e.startOffset,end:e.endOffset,type:"audio"})),this.flushBufferCounter=0,this.doFlush()},i.flushLiveBackBuffer=function(){if(!!this._live){var e=this.config.liveBackBufferLength;if(!(!isFinite(e)||e<0)){if(!this.media){c.logger.error("flushLiveBackBuffer called without attaching media");return}for(var t=this.media.currentTime,a=this.sourceBuffer,s=Object.keys(a),l=t-Math.max(e,this._levelTargetDuration),u=s.length-1;u>=0;u--){var d=s[u],v=a[d];if(v){var p=v.buffered;p.length>0&&l>p.start(0)&&this.removeBufferRange(d,v,0,l)&&this.hls.trigger(h.default.LIVE_BACK_BUFFER_REACHED,{bufferEnd:l})}}}}},i.onLevelUpdated=function(e){var t=e.details;t.fragments.length>0&&(this._levelDuration=t.totalduration+t.fragments[0].start,this._levelTargetDuration=t.averagetargetduration||t.targetduration||10,this._live=t.live,this.updateMediaElementDuration())},i.updateMediaElementDuration=function(){var e=this.config,t;if(!(this._levelDuration===null||!this.media||!this.mediaSource||!this.sourceBuffer||this.media.readyState===0||this.mediaSource.readyState!=="open")){for(var a in this.sourceBuffer){var s=this.sourceBuffer[a];if(s&&s.updating===!0)return}t=this.media.duration,this._msDuration===null&&(this._msDuration=this.mediaSource.duration),this._live===!0&&e.liveDurationInfinity===!0?(c.logger.log("Media Source duration is set to Infinity"),this._msDuration=this.mediaSource.duration=1/0):(this._levelDuration>this._msDuration&&this._levelDuration>t||!Object(te.isFiniteNumber)(t))&&(c.logger.log("Updating Media Source duration to "+this._levelDuration.toFixed(3)),this._msDuration=this.mediaSource.duration=this._levelDuration)}},i.doFlush=function(){for(;this.flushRange.length;){var e=this.flushRange[0];if(this.flushBuffer(e.start,e.end,e.type))this.flushRange.shift(),this.flushBufferCounter=0;else{this._needsFlush=!0;return}}if(this.flushRange.length===0){this._needsFlush=!1;var t=0,a=this.sourceBuffer;try{for(var s in a){var l=a[s];l&&(t+=l.buffered.length)}}catch(u){c.logger.error("error while accessing sourceBuffer.buffered")}this.appended=t,this.hls.trigger(h.default.BUFFER_FLUSHED)}},i.doAppending=function(){var e=this.config,t=this.hls,a=this.segments,s=this.sourceBuffer;if(!!Object.keys(s).length){if(!this.media||this.media.error){this.segments=[],c.logger.error("trying to append although a media error occured, flush segment and abort");return}if(!this.appending){var l=a.shift();if(!!l)try{var u=s[l.type];if(!u){this._onSBUpdateEnd();return}if(u.updating){a.unshift(l);return}u.ended=!1,this.parent=l.parent,u.appendBuffer(l.data),this.appendError=0,this.appended++,this.appending=!0}catch(v){c.logger.error("error while trying to append buffer:"+v.message),a.unshift(l);var d={type:L.ErrorTypes.MEDIA_ERROR,parent:l.parent,details:"",fatal:!1};v.code===22?(this.segments=[],d.details=L.ErrorDetails.BUFFER_FULL_ERROR):(this.appendError++,d.details=L.ErrorDetails.BUFFER_APPEND_ERROR,this.appendError>e.appendErrorMaxRetry&&(c.logger.log("fail "+e.appendErrorMaxRetry+" times to append segment in sourceBuffer"),this.segments=[],d.fatal=!0)),t.trigger(h.default.ERROR,d)}}}},i.flushBuffer=function(e,t,a){var s=this.sourceBuffer;if(!Object.keys(s).length)return!0;var l="null";if(this.media&&(l=this.media.currentTime.toFixed(3)),c.logger.log("flushBuffer,pos/start/end: "+l+"/"+e+"/"+t),this.flushBufferCounter>=this.appended)return c.logger.warn("abort flushing too many retries"),!0;var u=s[a];if(u){if(u.ended=!1,u.updating)return c.logger.warn("cannot flush, sb updating in progress"),!1;if(this.removeBufferRange(a,u,e,t))return this.flushBufferCounter++,!1}return c.logger.log("buffer flushed"),!0},i.removeBufferRange=function(e,t,a,s){try{for(var l=0;l<t.buffered.length;l++){var u=t.buffered.start(l),d=t.buffered.end(l),v=Math.max(u,a),p=Math.min(d,s);if(Math.min(p,d)-v>.5){var A="null";return this.media&&(A=this.media.currentTime.toString()),c.logger.log("sb remove "+e+" ["+v+","+p+"], of ["+u+","+d+"], pos:"+A),t.remove(v,p),!0}}}catch(F){c.logger.warn("removeBufferRange failed",F)}return!1},n}(T),si=ni;function mr(o,n){for(var i=0;i<n.length;i++){var r=n[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(o,r.key,r)}}function oi(o,n,i){return n&&mr(o.prototype,n),i&&mr(o,i),o}function li(o,n){o.prototype=Object.create(n.prototype),o.prototype.constructor=o,o.__proto__=n}var ui=function(o){li(n,o);function n(r){var e;return e=o.call(this,r,h.default.FPS_DROP_LEVEL_CAPPING,h.default.MEDIA_ATTACHING,h.default.MANIFEST_PARSED,h.default.LEVELS_UPDATED,h.default.BUFFER_CODECS,h.default.MEDIA_DETACHING)||this,e.autoLevelCapping=Number.POSITIVE_INFINITY,e.firstLevel=null,e.levels=[],e.media=null,e.restrictedLevels=[],e.timer=null,e.clientRect=null,e}var i=n.prototype;return i.destroy=function(){this.hls.config.capLevelToPlayerSize&&(this.media=null,this.clientRect=null,this.stopCapping())},i.onFpsDropLevelCapping=function(e){n.isLevelAllowed(e.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(e.droppedLevel)},i.onMediaAttaching=function(e){this.media=e.media instanceof window.HTMLVideoElement?e.media:null},i.onManifestParsed=function(e){var t=this.hls;this.restrictedLevels=[],this.levels=e.levels,this.firstLevel=e.firstLevel,t.config.capLevelToPlayerSize&&e.video&&this.startCapping()},i.onBufferCodecs=function(e){var t=this.hls;t.config.capLevelToPlayerSize&&e.video&&this.startCapping()},i.onLevelsUpdated=function(e){this.levels=e.levels},i.onMediaDetaching=function(){this.stopCapping()},i.detectPlayerSize=function(){if(this.media){var e=this.levels?this.levels.length:0;if(e){var t=this.hls;t.autoLevelCapping=this.getMaxLevel(e-1),t.autoLevelCapping>this.autoLevelCapping&&t.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}},i.getMaxLevel=function(e){var t=this;if(!this.levels)return-1;var a=this.levels.filter(function(s,l){return n.isLevelAllowed(l,t.restrictedLevels)&&l<=e});return this.clientRect=null,n.getMaxLevelByMediaSize(a,this.mediaWidth,this.mediaHeight)},i.startCapping=function(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),clearInterval(this.timer),this.timer=setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},i.stopCapping=function(){this.restrictedLevels=[],this.firstLevel=null,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(this.timer=clearInterval(this.timer),this.timer=null)},i.getDimensions=function(){if(this.clientRect)return this.clientRect;var e=this.media,t={width:0,height:0};if(e){var a=e.getBoundingClientRect();t.width=a.width,t.height=a.height,!t.width&&!t.height&&(t.width=a.right-a.left||e.width||0,t.height=a.bottom-a.top||e.height||0)}return this.clientRect=t,t},n.isLevelAllowed=function(e,t){return t===void 0&&(t=[]),t.indexOf(e)===-1},n.getMaxLevelByMediaSize=function(e,t,a){if(!e||e&&!e.length)return-1;for(var s=function(p,A){return A?p.width!==A.width||p.height!==A.height:!0},l=e.length-1,u=0;u<e.length;u+=1){var d=e[u];if((d.width>=t||d.height>=a)&&s(d,e[u+1])){l=u;break}}return l},oi(n,[{key:"mediaWidth",get:function(){return this.getDimensions().width*n.contentScaleFactor}},{key:"mediaHeight",get:function(){return this.getDimensions().height*n.contentScaleFactor}}],[{key:"contentScaleFactor",get:function(){var e=1;try{e=window.devicePixelRatio}catch(t){}return e}}]),n}(T),fi=ui;function di(o,n){o.prototype=Object.create(n.prototype),o.prototype.constructor=o,o.__proto__=n}var hi=window,ci=hi.performance,gi=function(o){di(n,o);function n(r){return o.call(this,r,h.default.MEDIA_ATTACHING)||this}var i=n.prototype;return i.destroy=function(){this.timer&&clearInterval(this.timer),this.isVideoPlaybackQualityAvailable=!1},i.onMediaAttaching=function(e){var t=this.hls.config;if(t.capLevelOnFPSDrop){var a=this.video=e.media instanceof window.HTMLVideoElement?e.media:null;typeof a.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),clearInterval(this.timer),this.timer=setInterval(this.checkFPSInterval.bind(this),t.fpsDroppedMonitoringPeriod)}},i.checkFPS=function(e,t,a){var s=ci.now();if(t){if(this.lastTime){var l=s-this.lastTime,u=a-this.lastDroppedFrames,d=t-this.lastDecodedFrames,v=1e3*u/l,p=this.hls;if(p.trigger(h.default.FPS_DROP,{currentDropped:u,currentDecoded:d,totalDroppedFrames:a}),v>0&&u>p.config.fpsDroppedMonitoringThreshold*d){var A=p.currentLevel;c.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+A),A>0&&(p.autoLevelCapping===-1||p.autoLevelCapping>=A)&&(A=A-1,p.trigger(h.default.FPS_DROP_LEVEL_CAPPING,{level:A,droppedLevel:p.currentLevel}),p.autoLevelCapping=A,p.streamController.nextLevelSwitch())}}this.lastTime=s,this.lastDroppedFrames=a,this.lastDecodedFrames=t}},i.checkFPSInterval=function(){var e=this.video;if(e)if(this.isVideoPlaybackQualityAvailable){var t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)},n}(T),vi=gi,pi=function(){function o(i){i&&i.xhrSetup&&(this.xhrSetup=i.xhrSetup)}var n=o.prototype;return n.destroy=function(){this.abort(),this.loader=null},n.abort=function(){var r=this.loader;r&&r.readyState!==4&&(this.stats.aborted=!0,r.abort()),window.clearTimeout(this.requestTimeout),this.requestTimeout=null,window.clearTimeout(this.retryTimeout),this.retryTimeout=null},n.load=function(r,e,t){this.context=r,this.config=e,this.callbacks=t,this.stats={trequest:window.performance.now(),retry:0},this.retryDelay=e.retryDelay,this.loadInternal()},n.loadInternal=function(){var r,e=this.context;r=this.loader=new window.XMLHttpRequest;var t=this.stats;t.tfirst=0,t.loaded=0;var a=this.xhrSetup;try{if(a)try{a(r,e.url)}catch(s){r.open("GET",e.url,!0),a(r,e.url)}r.readyState||r.open("GET",e.url,!0)}catch(s){this.callbacks.onError({code:r.status,text:s.message},e,r);return}e.rangeEnd&&r.setRequestHeader("Range","bytes="+e.rangeStart+"-"+(e.rangeEnd-1)),r.onreadystatechange=this.readystatechange.bind(this),r.onprogress=this.loadprogress.bind(this),r.responseType=e.responseType,this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),this.config.timeout),r.send()},n.readystatechange=function(r){var e=r.currentTarget,t=e.readyState,a=this.stats,s=this.context,l=this.config;if(!a.aborted&&t>=2)if(window.clearTimeout(this.requestTimeout),a.tfirst===0&&(a.tfirst=Math.max(window.performance.now(),a.trequest)),t===4){var u=e.status;if(u>=200&&u<300){a.tload=Math.max(a.tfirst,window.performance.now());var d,v;s.responseType==="arraybuffer"?(d=e.response,v=d.byteLength):(d=e.responseText,v=d.length),a.loaded=a.total=v;var p={url:e.responseURL,data:d};this.callbacks.onSuccess(p,a,s,e)}else a.retry>=l.maxRetry||u>=400&&u<499?(c.logger.error(u+" while loading "+s.url),this.callbacks.onError({code:u,text:e.statusText},s,e)):(c.logger.warn(u+" while loading "+s.url+", retrying in "+this.retryDelay+"..."),this.destroy(),this.retryTimeout=window.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,l.maxRetryDelay),a.retry++)}else this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),l.timeout)},n.loadtimeout=function(){c.logger.warn("timeout while loading "+this.context.url),this.callbacks.onTimeout(this.stats,this.context,null)},n.loadprogress=function(r){var e=r.currentTarget,t=this.stats;t.loaded=r.loaded,r.lengthComputable&&(t.total=r.total);var a=this.callbacks.onProgress;a&&a(t,this.context,null,e)},o}(),mi=pi;function xr(o,n){for(var i=0;i<n.length;i++){var r=n[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(o,r.key,r)}}function xi(o,n,i){return n&&xr(o.prototype,n),i&&xr(o,i),o}function yi(o,n){o.prototype=Object.create(n.prototype),o.prototype.constructor=o,o.__proto__=n}var Ei=function(o){yi(n,o);function n(r){var e;return e=o.call(this,r,h.default.MANIFEST_LOADING,h.default.MANIFEST_PARSED,h.default.AUDIO_TRACK_LOADED,h.default.AUDIO_TRACK_SWITCHED,h.default.LEVEL_LOADED,h.default.ERROR)||this,e._trackId=-1,e._selectDefaultTrack=!0,e.tracks=[],e.trackIdBlacklist=Object.create(null),e.audioGroupId=null,e}var i=n.prototype;return i.onManifestLoading=function(){this.tracks=[],this._trackId=-1,this._selectDefaultTrack=!0},i.onManifestParsed=function(e){var t=this.tracks=e.audioTracks||[];this.hls.trigger(h.default.AUDIO_TRACKS_UPDATED,{audioTracks:t}),this._selectAudioGroup(this.hls.nextLoadLevel)},i.onAudioTrackLoaded=function(e){if(e.id>=this.tracks.length){c.logger.warn("Invalid audio track id:",e.id);return}if(c.logger.log("audioTrack "+e.id+" loaded"),this.tracks[e.id].details=e.details,e.details.live&&!this.hasInterval()){var t=e.details.targetduration*1e3;this.setInterval(t)}!e.details.live&&this.hasInterval()&&this.clearInterval()},i.onAudioTrackSwitched=function(e){var t=this.tracks[e.id].groupId;t&&this.audioGroupId!==t&&(this.audioGroupId=t)},i.onLevelLoaded=function(e){this._selectAudioGroup(e.level)},i.onError=function(e){e.type===L.ErrorTypes.NETWORK_ERROR&&(e.fatal&&this.clearInterval(),e.details===L.ErrorDetails.AUDIO_TRACK_LOAD_ERROR&&(c.logger.warn("Network failure on audio-track id:",e.context.id),this._handleLoadError()))},i._setAudioTrack=function(e){if(this._trackId===e&&this.tracks[this._trackId].details){c.logger.debug("Same id as current audio-track passed, and track details available -> no-op");return}if(e<0||e>=this.tracks.length){c.logger.warn("Invalid id passed to audio-track controller");return}var t=this.tracks[e];c.logger.log("Now switching to audio-track index "+e),this.clearInterval(),this._trackId=e;var a=t.url,s=t.type,l=t.id;this.hls.trigger(h.default.AUDIO_TRACK_SWITCHING,{id:l,type:s,url:a}),this._loadTrackDetailsIfNeeded(t)},i.doTick=function(){this._updateTrack(this._trackId)},i._selectAudioGroup=function(e){var t=this.hls.levels[e];if(!(!t||!t.audioGroupIds)){var a=t.audioGroupIds[t.urlId];this.audioGroupId!==a&&(this.audioGroupId=a,this._selectInitialAudioTrack())}},i._selectInitialAudioTrack=function(){var e=this,t=this.tracks;if(!!t.length){var a=this.tracks[this._trackId],s=null;if(a&&(s=a.name),this._selectDefaultTrack){var l=t.filter(function(v){return v.default});l.length?t=l:c.logger.warn("No default audio tracks defined")}var u=!1,d=function(){t.forEach(function(p){u||(!e.audioGroupId||p.groupId===e.audioGroupId)&&(!s||s===p.name)&&(e._setAudioTrack(p.id),u=!0)})};d(),u||(s=null,d()),u||(c.logger.error("No track found for running audio group-ID: "+this.audioGroupId),this.hls.trigger(h.default.ERROR,{type:L.ErrorTypes.MEDIA_ERROR,details:L.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,fatal:!0}))}},i._needsTrackLoading=function(e){var t=e.details,a=e.url;return!t||t.live?!!a:!1},i._loadTrackDetailsIfNeeded=function(e){if(this._needsTrackLoading(e)){var t=e.url,a=e.id;c.logger.log("loading audio-track playlist for id: "+a),this.hls.trigger(h.default.AUDIO_TRACK_LOADING,{url:t,id:a})}},i._updateTrack=function(e){if(!(e<0||e>=this.tracks.length)){this.clearInterval(),this._trackId=e,c.logger.log("trying to update audio-track "+e);var t=this.tracks[e];this._loadTrackDetailsIfNeeded(t)}},i._handleLoadError=function(){this.trackIdBlacklist[this._trackId]=!0;var e=this._trackId,t=this.tracks[e],a=t.name,s=t.language,l=t.groupId;c.logger.warn("Loading failed on audio track id: "+e+", group-id: "+l+', name/language: "'+a+'" / "'+s+'"');for(var u=e,d=0;d<this.tracks.length;d++)if(!this.trackIdBlacklist[d]){var v=this.tracks[d];if(v.name===a){u=d;break}}if(u===e){c.logger.warn('No fallback audio-track found for name/language: "'+a+'" / "'+s+'"');return}c.logger.log("Attempting audio-track fallback id:",u,"group-id:",this.tracks[u].groupId),this._setAudioTrack(u)},xi(n,[{key:"audioTracks",get:function(){return this.tracks}},{key:"audioTrack",get:function(){return this._trackId},set:function(e){this._setAudioTrack(e),this._selectDefaultTrack=!1}}]),n}(ht),Ti=Ei;function yr(o,n){for(var i=0;i<n.length;i++){var r=n[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(o,r.key,r)}}function Si(o,n,i){return n&&yr(o.prototype,n),i&&yr(o,i),o}function _i(o,n){o.prototype=Object.create(n.prototype),o.prototype.constructor=o,o.__proto__=n}var Ai=window,jt=Ai.performance,Er=100,Ri=function(o){_i(n,o);function n(r,e){var t;return t=o.call(this,r,h.default.MEDIA_ATTACHED,h.default.MEDIA_DETACHING,h.default.AUDIO_TRACKS_UPDATED,h.default.AUDIO_TRACK_SWITCHING,h.default.AUDIO_TRACK_LOADED,h.default.KEY_LOADED,h.default.FRAG_LOADED,h.default.FRAG_PARSING_INIT_SEGMENT,h.default.FRAG_PARSING_DATA,h.default.FRAG_PARSED,h.default.ERROR,h.default.BUFFER_RESET,h.default.BUFFER_CREATED,h.default.BUFFER_APPENDED,h.default.BUFFER_FLUSHED,h.default.INIT_PTS_FOUND)||this,t.fragmentTracker=e,t.config=r.config,t.audioCodecSwap=!1,t._state=C.STOPPED,t.initPTS=[],t.waitingFragment=null,t.videoTrackCC=null,t.waitingVideoCC=null,t}var i=n.prototype;return i.onInitPtsFound=function(e){var t=e.id,a=e.frag.cc,s=e.initPTS;t==="main"&&(this.initPTS[a]=s,this.videoTrackCC=a,c.logger.log("InitPTS for cc: "+a+" found from main: "+s),this.state===C.WAITING_INIT_PTS&&this.tick())},i.startLoad=function(e){if(this.tracks){var t=this.lastCurrentTime;this.stopLoad(),this.setInterval(Er),this.fragLoadError=0,t>0&&e===-1?(c.logger.log("audio:override startPosition with lastCurrentTime @"+t.toFixed(3)),this.state=C.IDLE):(this.lastCurrentTime=this.startPosition?this.startPosition:e,this.state=C.STARTING),this.nextLoadPosition=this.startPosition=this.lastCurrentTime,this.tick()}else this.startPosition=e,this.state=C.STOPPED},i.doTick=function(){var e,t,a,s=this.hls,l=s.config;switch(this.state){case C.ERROR:case C.PAUSED:case C.BUFFER_FLUSHING:break;case C.STARTING:this.state=C.WAITING_TRACK,this.loadedmetadata=!1;break;case C.IDLE:var u=this.tracks;if(!u||!this.media&&(this.startFragRequested||!l.startFragPrefetch))break;if(this.loadedmetadata)e=this.media.currentTime;else if(e=this.nextLoadPosition,e===void 0)break;var d=this.mediaBuffer?this.mediaBuffer:this.media,v=this.videoBuffer?this.videoBuffer:this.media,p=e<l.maxBufferHole?Math.max(nt,l.maxBufferHole):l.maxBufferHole,A=m.bufferInfo(d,e,p),F=m.bufferInfo(v,e,p),B=A.len,q=A.end,ie=this.fragPrevious,ee=Math.min(l.maxBufferLength,l.maxMaxBufferLength),ue=Math.max(ee,F.len),fe=this.audioSwitch,Ee=this.trackId;if((B<ue||fe)&&Ee<u.length){if(a=u[Ee].details,typeof a=="undefined"){this.state=C.WAITING_TRACK;break}if(!fe&&this._streamEnded(A,a)){this.hls.trigger(h.default.BUFFER_EOS,{type:"audio"}),this.state=C.ENDED;return}var Ne=a.fragments,lt=Ne.length,Ze=Ne[0].start,Tt=Ne[lt-1].start+Ne[lt-1].duration,oe;if(fe){if(a.live&&!a.PTSKnown)c.logger.log("switching audiotrack, live stream, unknown PTS,load first fragment"),q=0;else if(q=e,a.PTSKnown&&e<Ze)if(A.end>Ze||A.nextStart)c.logger.log("alt audio track ahead of main track, seek to start of alt audio track"),this.media.currentTime=Ze+.05;else return}if(a.initSegment&&!a.initSegment.data)oe=a.initSegment;else if(q<=Ze){if(oe=Ne[0],this.videoTrackCC!==null&&oe.cc!==this.videoTrackCC&&(oe=Re(Ne,this.videoTrackCC)),a.live&&oe.loadIdx&&oe.loadIdx===this.fragLoadIdx){var xe=A.nextStart?A.nextStart:Ze;c.logger.log("no alt audio available @currentTime:"+this.media.currentTime+", seeking @"+(xe+.05)),this.media.currentTime=xe+.05;return}}else{var He,Mt=l.maxFragLookUpTolerance,Nt=ie?Ne[ie.sn-Ne[0].sn+1]:void 0;q<Tt?(q>Tt-Mt&&(Mt=0),Nt&&!$e(q,Mt,Nt)?He=Nt:He=Ut.search(Ne,function(ya){return $e(q,Mt,ya)})):He=Ne[lt-1],He&&(oe=He,Ze=He.start,ie&&oe.level===ie.level&&oe.sn===ie.sn&&(oe.sn<a.endSN?(oe=Ne[oe.sn+1-a.startSN],this.fragmentTracker.getState(oe)!==Ie.OK&&c.logger.log("SN just loaded, load next one: "+oe.sn)):oe=null))}oe&&(oe.encrypted?(c.logger.log("Loading key for "+oe.sn+" of ["+a.startSN+" ,"+a.endSN+"],track "+Ee),this.state=C.KEY_LOADING,s.trigger(h.default.KEY_LOADING,{frag:oe})):(this.fragCurrent=oe,(fe||this.fragmentTracker.getState(oe)===Ie.NOT_LOADED)&&(c.logger.log("Loading "+oe.sn+", cc: "+oe.cc+" of ["+a.startSN+" ,"+a.endSN+"],track "+Ee+", "+(this.loadedmetadata?"currentTime":"nextLoadPosition")+": "+e+", bufferEnd: "+q.toFixed(3)),oe.sn!=="initSegment"&&(this.startFragRequested=!0),Object(te.isFiniteNumber)(oe.sn)&&(this.nextLoadPosition=oe.start+oe.duration),s.trigger(h.default.FRAG_LOADING,{frag:oe}),this.state=C.FRAG_LOADING)))}break;case C.WAITING_TRACK:t=this.tracks[this.trackId],t&&t.details&&(this.state=C.IDLE);break;case C.FRAG_LOADING_WAITING_RETRY:var Ht=jt.now(),rr=this.retryDate;d=this.media;var ma=d&&d.seeking;(!rr||Ht>=rr||ma)&&(c.logger.log("audioStreamController: retryDate reached, switch back to IDLE state"),this.state=C.IDLE);break;case C.WAITING_INIT_PTS:var Wt=this.waitingFragment;if(Wt){var cr=Wt.frag.cc;if(this.initPTS[cr]!==void 0)this.waitingFragment=null,this.state=C.FRAG_LOADING,this.onFragLoaded(Wt);else if(this.videoTrackCC!==this.waitingVideoCC)c.logger.log("Waiting fragment cc ("+cr+") cancelled because video is at cc "+this.videoTrackCC),this.clearWaitingFragment();else{var Vr=m.bufferInfo(this.mediaBuffer,this.media.currentTime,l.maxBufferHole),xa=$e(Vr.end,l.maxFragLookUpTolerance,Wt.frag);xa<0&&(c.logger.log("Waiting fragment cc ("+cr+") @ "+Wt.frag.start+" cancelled because another fragment at "+Vr.end+" is needed"),this.clearWaitingFragment())}}else this.state=C.IDLE;break;case C.STOPPED:case C.FRAG_LOADING:case C.PARSING:case C.PARSED:case C.ENDED:break;default:break}},i.clearWaitingFragment=function(){var e=this.waitingFragment;e&&(this.fragmentTracker.removeFragment(e.frag),this.waitingFragment=null,this.waitingVideoCC=null,this.state=C.IDLE)},i.onMediaAttached=function(e){var t=this.media=this.mediaBuffer=e.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),t.addEventListener("seeking",this.onvseeking),t.addEventListener("ended",this.onvended);var a=this.config;this.tracks&&a.autoStartLoad&&this.startLoad(a.startPosition)},i.onMediaDetaching=function(){var e=this.media;e&&e.ended&&(c.logger.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),e&&(e.removeEventListener("seeking",this.onvseeking),e.removeEventListener("ended",this.onvended),this.onvseeking=this.onvseeked=this.onvended=null),this.media=this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()},i.onAudioTracksUpdated=function(e){c.logger.log("audio tracks updated"),this.tracks=e.audioTracks},i.onAudioTrackSwitching=function(e){var t=!!e.url;this.trackId=e.id,this.fragCurrent=null,this.clearWaitingFragment(),this.state=C.PAUSED,t?this.setInterval(Er):this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),t&&(this.audioSwitch=!0,this.state=C.IDLE),this.tick()},i.onAudioTrackLoaded=function(e){var t=e.details,a=e.id,s=this.tracks[a],l=s.details,u=t.totalduration,d=0;if(c.logger.log("track "+a+" loaded ["+t.startSN+","+t.endSN+"],duration:"+u),t.live||l&&l.live?l&&t.fragments.length>0?($(l,t),d=t.fragments[0].start,t.PTSKnown?c.logger.log("live audio playlist sliding:"+d.toFixed(3)):c.logger.log("live audio playlist - outdated PTS, unknown sliding")):(t.PTSKnown=!1,c.logger.log("live audio playlist - first load, unknown sliding")):t.PTSKnown=!1,s.details=t,!this.startFragRequested){if(this.startPosition===-1){var v=t.startTimeOffset;Object(te.isFiniteNumber)(v)?(c.logger.log("start time offset found in playlist, adjust startPosition to "+v),this.startPosition=v):t.live?(this.startPosition=this.computeLivePosition(d,t),c.logger.log("compute startPosition for audio-track to "+this.startPosition)):this.startPosition=0}this.nextLoadPosition=this.startPosition}this.state===C.WAITING_TRACK&&(this.state=C.IDLE),this.tick()},i.onKeyLoaded=function(){this.state===C.KEY_LOADING&&(this.state=C.IDLE,this.tick())},i.onFragLoaded=function(e){var t=this.fragCurrent,a=e.frag;if(this.state===C.FRAG_LOADING&&t&&a.type==="audio"&&a.level===t.level&&a.sn===t.sn){var s=this.tracks[this.trackId],l=s.details,u=l.totalduration,d=t.level,v=t.sn,p=t.cc,A=this.config.defaultAudioCodec||s.audioCodec||"mp4a.40.2",F=this.stats=e.stats;if(v==="initSegment")this.state=C.IDLE,F.tparsed=F.tbuffered=jt.now(),l.initSegment.data=e.payload,this.hls.trigger(h.default.FRAG_BUFFERED,{stats:F,frag:t,id:"audio"}),this.tick();else{this.state=C.PARSING,this.appended=!1,this.demuxer||(this.demuxer=new N(this.hls,"audio"));var B=this.initPTS[p],q=l.initSegment?l.initSegment.data:[];if(B!==void 0){this.pendingBuffering=!0,c.logger.log("Demuxing "+v+" of ["+l.startSN+" ,"+l.endSN+"],track "+d);var ie=!1;this.demuxer.push(e.payload,q,A,null,t,u,ie,B)}else c.logger.log("Unknown video PTS for cc "+p+", waiting for video PTS before demuxing audio frag "+v+" of ["+l.startSN+" ,"+l.endSN+"],track "+d),this.waitingFragment=e,this.waitingVideoCC=this.videoTrackCC,this.state=C.WAITING_INIT_PTS}}this.fragLoadError=0},i.onFragParsingInitSegment=function(e){var t=this.fragCurrent,a=e.frag;if(t&&e.id==="audio"&&a.sn===t.sn&&a.level===t.level&&this.state===C.PARSING){var s=e.tracks,l;if(s.video&&delete s.video,l=s.audio,l){l.levelCodec=l.codec,l.id=e.id,this.hls.trigger(h.default.BUFFER_CODECS,s),c.logger.log("audio track:audio,container:"+l.container+",codecs[level/parsed]=["+l.levelCodec+"/"+l.codec+"]");var u=l.initSegment;if(u){var d={type:"audio",data:u,parent:"audio",content:"initSegment"};this.audioSwitch?this.pendingData=[d]:(this.appended=!0,this.pendingBuffering=!0,this.hls.trigger(h.default.BUFFER_APPENDING,d))}this.tick()}}},i.onFragParsingData=function(e){var t=this,a=this.fragCurrent,s=e.frag;if(a&&e.id==="audio"&&e.type==="audio"&&s.sn===a.sn&&s.level===a.level&&this.state===C.PARSING){var l=this.trackId,u=this.tracks[l],d=this.hls;Object(te.isFiniteNumber)(e.endPTS)||(e.endPTS=e.startPTS+a.duration,e.endDTS=e.startDTS+a.duration),a.addElementaryStream(H.AUDIO),c.logger.log("parsed "+e.type+",PTS:["+e.startPTS.toFixed(3)+","+e.endPTS.toFixed(3)+"],DTS:["+e.startDTS.toFixed(3)+"/"+e.endDTS.toFixed(3)+"],nb:"+e.nb),z(u.details,a,e.startPTS,e.endPTS);var v=this.media,p=!1;if(this.audioSwitch)if(v&&v.readyState){var A=v.currentTime;c.logger.log("switching audio track : currentTime:"+A),A>=e.startPTS&&(c.logger.log("switching audio track : flushing all audio"),this.state=C.BUFFER_FLUSHING,d.trigger(h.default.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),p=!0,this.audioSwitch=!1,d.trigger(h.default.AUDIO_TRACK_SWITCHED,{id:l}))}else this.audioSwitch=!1,d.trigger(h.default.AUDIO_TRACK_SWITCHED,{id:l});var F=this.pendingData;if(!F){c.logger.warn("Apparently attempt to enqueue media payload without codec initialization data upfront"),d.trigger(h.default.ERROR,{type:L.ErrorTypes.MEDIA_ERROR,details:null,fatal:!0});return}this.audioSwitch||([e.data1,e.data2].forEach(function(B){B&&B.length&&F.push({type:e.type,data:B,parent:"audio",content:"data"})}),!p&&F.length&&(F.forEach(function(B){t.state===C.PARSING&&(t.pendingBuffering=!0,t.hls.trigger(h.default.BUFFER_APPENDING,B))}),this.pendingData=[],this.appended=!0)),this.tick()}},i.onFragParsed=function(e){var t=this.fragCurrent,a=e.frag;t&&e.id==="audio"&&a.sn===t.sn&&a.level===t.level&&this.state===C.PARSING&&(this.stats.tparsed=jt.now(),this.state=C.PARSED,this._checkAppendedParsed())},i.onBufferReset=function(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1},i.onBufferCreated=function(e){var t=e.tracks.audio;t&&(this.mediaBuffer=t.buffer,this.loadedmetadata=!0),e.tracks.video&&(this.videoBuffer=e.tracks.video.buffer)},i.onBufferAppended=function(e){if(e.parent==="audio"){var t=this.state;(t===C.PARSING||t===C.PARSED)&&(this.pendingBuffering=e.pending>0,this._checkAppendedParsed())}},i._checkAppendedParsed=function(){if(this.state===C.PARSED&&(!this.appended||!this.pendingBuffering)){var e=this.fragCurrent,t=this.stats,a=this.hls;if(e){this.fragPrevious=e,t.tbuffered=jt.now(),a.trigger(h.default.FRAG_BUFFERED,{stats:t,frag:e,id:"audio"});var s=this.mediaBuffer?this.mediaBuffer:this.media;s&&c.logger.log("audio buffered : "+ge.toString(s.buffered)),this.audioSwitch&&this.appended&&(this.audioSwitch=!1,a.trigger(h.default.AUDIO_TRACK_SWITCHED,{id:this.trackId})),this.state=C.IDLE}this.tick()}},i.onError=function(e){var t=e.frag;if(!(t&&t.type!=="audio"))switch(e.details){case L.ErrorDetails.FRAG_LOAD_ERROR:case L.ErrorDetails.FRAG_LOAD_TIMEOUT:var a=e.frag;if(a&&a.type!=="audio")break;if(!e.fatal){var s=this.fragLoadError;s?s++:s=1;var l=this.config;if(s<=l.fragLoadingMaxRetry){this.fragLoadError=s;var u=Math.min(Math.pow(2,s-1)*l.fragLoadingRetryDelay,l.fragLoadingMaxRetryTimeout);c.logger.warn("AudioStreamController: frag loading failed, retry in "+u+" ms"),this.retryDate=jt.now()+u,this.state=C.FRAG_LOADING_WAITING_RETRY}else c.logger.error("AudioStreamController: "+e.details+" reaches max retry, redispatch as fatal ..."),e.fatal=!0,this.state=C.ERROR}break;case L.ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case L.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:case L.ErrorDetails.KEY_LOAD_ERROR:case L.ErrorDetails.KEY_LOAD_TIMEOUT:this.state!==C.ERROR&&(this.state=e.fatal?C.ERROR:C.IDLE,c.logger.warn("AudioStreamController: "+e.details+" while loading frag, now switching to "+this.state+" state ..."));break;case L.ErrorDetails.BUFFER_FULL_ERROR:if(e.parent==="audio"&&(this.state===C.PARSING||this.state===C.PARSED)){var d=this.mediaBuffer,v=this.media.currentTime,p=d&&m.isBuffered(d,v)&&m.isBuffered(d,v+.5);if(p){var A=this.config;A.maxMaxBufferLength>=A.maxBufferLength&&(A.maxMaxBufferLength/=2,c.logger.warn("AudioStreamController: reduce max buffer length to "+A.maxMaxBufferLength+"s")),this.state=C.IDLE}else c.logger.warn("AudioStreamController: buffer full error also media.currentTime is not buffered, flush audio buffer"),this.fragCurrent=null,this.state=C.BUFFER_FLUSHING,this.hls.trigger(h.default.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"})}break;default:break}},i.onBufferFlushed=function(){var e=this,t=this.pendingData;t&&t.length?(c.logger.log("AudioStreamController: appending pending audio data after buffer flushed"),t.forEach(function(a){e.hls.trigger(h.default.BUFFER_APPENDING,a)}),this.appended=!0,this.pendingData=[],this.state=C.PARSED):(this.state=C.IDLE,this.fragPrevious=null,this.tick())},Si(n,[{key:"state",set:function(e){if(this.state!==e){var t=this.state;this._state=e,c.logger.log("audio stream:"+t+"->"+e)}},get:function(){return this._state}}]),n}(yt),bi=Ri,Tr=function(){if(typeof window!="undefined"&&window.VTTCue)return window.VTTCue;var o="auto",n={"":!0,lr:!0,rl:!0},i={start:!0,middle:!0,end:!0,left:!0,right:!0};function r(s){if(typeof s!="string")return!1;var l=n[s.toLowerCase()];return l?s.toLowerCase():!1}function e(s){if(typeof s!="string")return!1;var l=i[s.toLowerCase()];return l?s.toLowerCase():!1}function t(s){for(var l=1;l<arguments.length;l++){var u=arguments[l];for(var d in u)s[d]=u[d]}return s}function a(s,l,u){var d=this,v={};v.enumerable=!0,d.hasBeenReset=!1;var p="",A=!1,F=s,B=l,q=u,ie=null,ee="",ue=!0,fe="auto",Ee="start",Ne=50,lt="middle",Ze=50,Tt="middle";Object.defineProperty(d,"id",t({},v,{get:function(){return p},set:function(xe){p=""+xe}})),Object.defineProperty(d,"pauseOnExit",t({},v,{get:function(){return A},set:function(xe){A=!!xe}})),Object.defineProperty(d,"startTime",t({},v,{get:function(){return F},set:function(xe){if(typeof xe!="number")throw new TypeError("Start time must be set to a number.");F=xe,this.hasBeenReset=!0}})),Object.defineProperty(d,"endTime",t({},v,{get:function(){return B},set:function(xe){if(typeof xe!="number")throw new TypeError("End time must be set to a number.");B=xe,this.hasBeenReset=!0}})),Object.defineProperty(d,"text",t({},v,{get:function(){return q},set:function(xe){q=""+xe,this.hasBeenReset=!0}})),Object.defineProperty(d,"region",t({},v,{get:function(){return ie},set:function(xe){ie=xe,this.hasBeenReset=!0}})),Object.defineProperty(d,"vertical",t({},v,{get:function(){return ee},set:function(xe){var He=r(xe);if(He===!1)throw new SyntaxError("An invalid or illegal string was specified.");ee=He,this.hasBeenReset=!0}})),Object.defineProperty(d,"snapToLines",t({},v,{get:function(){return ue},set:function(xe){ue=!!xe,this.hasBeenReset=!0}})),Object.defineProperty(d,"line",t({},v,{get:function(){return fe},set:function(xe){if(typeof xe!="number"&&xe!==o)throw new SyntaxError("An invalid number or illegal string was specified.");fe=xe,this.hasBeenReset=!0}})),Object.defineProperty(d,"lineAlign",t({},v,{get:function(){return Ee},set:function(xe){var He=e(xe);if(!He)throw new SyntaxError("An invalid or illegal string was specified.");Ee=He,this.hasBeenReset=!0}})),Object.defineProperty(d,"position",t({},v,{get:function(){return Ne},set:function(xe){if(xe<0||xe>100)throw new Error("Position must be between 0 and 100.");Ne=xe,this.hasBeenReset=!0}})),Object.defineProperty(d,"positionAlign",t({},v,{get:function(){return lt},set:function(xe){var He=e(xe);if(!He)throw new SyntaxError("An invalid or illegal string was specified.");lt=He,this.hasBeenReset=!0}})),Object.defineProperty(d,"size",t({},v,{get:function(){return Ze},set:function(xe){if(xe<0||xe>100)throw new Error("Size must be between 0 and 100.");Ze=xe,this.hasBeenReset=!0}})),Object.defineProperty(d,"align",t({},v,{get:function(){return Tt},set:function(xe){var He=e(xe);if(!He)throw new SyntaxError("An invalid or illegal string was specified.");Tt=He,this.hasBeenReset=!0}})),d.displayState=void 0}return a.prototype.getCueAsHTML=function(){var s=window.WebVTT;return s.convertCueToDOMTree(window,this.text)},a}(),Li=function(){return{decode:function(i){if(!i)return"";if(typeof i!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(i))}}};function Sr(){this.window=window,this.state="INITIAL",this.buffer="",this.decoder=new Li,this.regionList=[]}function Di(o){function n(r,e,t,a){return(r|0)*3600+(e|0)*60+(t|0)+(a|0)/1e3}var i=o.match(/^(\d+):(\d{2})(:\d{2})?\.(\d{3})/);return i?i[3]?n(i[1],i[2],i[3].replace(":",""),i[4]):i[1]>59?n(i[1],i[2],0,i[4]):n(0,i[1],i[2],i[4]):null}function _r(){this.values=Object.create(null)}_r.prototype={set:function(n,i){!this.get(n)&&i!==""&&(this.values[n]=i)},get:function(n,i,r){return r?this.has(n)?this.values[n]:i[r]:this.has(n)?this.values[n]:i},has:function(n){return n in this.values},alt:function(n,i,r){for(var e=0;e<r.length;++e)if(i===r[e]){this.set(n,i);break}},integer:function(n,i){/^-?\d+$/.test(i)&&this.set(n,parseInt(i,10))},percent:function(n,i){var r;return(r=i.match(/^([\d]{1,3})(\.[\d]*)?%$/))&&(i=parseFloat(i),i>=0&&i<=100)?(this.set(n,i),!0):!1}};function Ar(o,n,i,r){var e=r?o.split(r):[o];for(var t in e)if(typeof e[t]=="string"){var a=e[t].split(i);if(a.length===2){var s=a[0],l=a[1];n(s,l)}}}var or=new Tr(0,0,0),Jt=or.align==="middle"?"middle":"center";function Ii(o,n,i){var r=o;function e(){var s=Di(o);if(s===null)throw new Error("Malformed timestamp: "+r);return o=o.replace(/^[^\sa-zA-Z-]+/,""),s}function t(s,l){var u=new _r;Ar(s,function(p,A){switch(p){case"region":for(var F=i.length-1;F>=0;F--)if(i[F].id===A){u.set(p,i[F].region);break}break;case"vertical":u.alt(p,A,["rl","lr"]);break;case"line":var B=A.split(","),q=B[0];u.integer(p,q),u.percent(p,q)&&u.set("snapToLines",!1),u.alt(p,q,["auto"]),B.length===2&&u.alt("lineAlign",B[1],["start",Jt,"end"]);break;case"position":B=A.split(","),u.percent(p,B[0]),B.length===2&&u.alt("positionAlign",B[1],["start",Jt,"end","line-left","line-right","auto"]);break;case"size":u.percent(p,A);break;case"align":u.alt(p,A,["start",Jt,"end","left","right"]);break}},/:/,/\s/),l.region=u.get("region",null),l.vertical=u.get("vertical","");var d=u.get("line","auto");d==="auto"&&or.line===-1&&(d=-1),l.line=d,l.lineAlign=u.get("lineAlign","start"),l.snapToLines=u.get("snapToLines",!0),l.size=u.get("size",100),l.align=u.get("align",Jt);var v=u.get("position","auto");v==="auto"&&or.position===50&&(v=l.align==="start"||l.align==="left"?0:l.align==="end"||l.align==="right"?100:50),l.position=v}function a(){o=o.replace(/^\s+/,"")}if(a(),n.startTime=e(),a(),o.substr(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+r);o=o.substr(3),a(),n.endTime=e(),a(),t(o,n)}function Rr(o){return o.replace(/<br(?: \/)?>/gi,`
`)}Sr.prototype={parse:function(n){var i=this;n&&(i.buffer+=i.decoder.decode(n,{stream:!0}));function r(){var u=i.buffer,d=0;for(u=Rr(u);d<u.length&&u[d]!=="\r"&&u[d]!==`
`;)++d;var v=u.substr(0,d);return u[d]==="\r"&&++d,u[d]===`
`&&++d,i.buffer=u.substr(d),v}function e(u){Ar(u,function(d,v){switch(d){case"Region":break}},/:/)}try{var t;if(i.state==="INITIAL"){if(!/\r\n|\n/.test(i.buffer))return this;t=r();var a=t.match(/^(ï»¿)?WEBVTT([ \t].*)?$/);if(!a||!a[0])throw new Error("Malformed WebVTT signature.");i.state="HEADER"}for(var s=!1;i.buffer;){if(!/\r\n|\n/.test(i.buffer))return this;switch(s?s=!1:t=r(),i.state){case"HEADER":/:/.test(t)?e(t):t||(i.state="ID");continue;case"NOTE":t||(i.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(t)){i.state="NOTE";break}if(!t)continue;if(i.cue=new Tr(0,0,""),i.state="CUE",t.indexOf("-->")===-1){i.cue.id=t;continue}case"CUE":try{Ii(t,i.cue,i.regionList)}catch(u){i.cue=null,i.state="BADCUE";continue}i.state="CUETEXT";continue;case"CUETEXT":var l=t.indexOf("-->")!==-1;if(!t||l&&(s=!0)){i.oncue&&i.oncue(i.cue),i.cue=null,i.state="ID";continue}i.cue.text&&(i.cue.text+=`
`),i.cue.text+=t;continue;case"BADCUE":t||(i.state="ID");continue}}}catch(u){i.state==="CUETEXT"&&i.cue&&i.oncue&&i.oncue(i.cue),i.cue=null,i.state=i.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this},flush:function(){var n=this;try{if(n.buffer+=n.decoder.decode(),(n.cue||n.state==="HEADER")&&(n.buffer+=`

`,n.parse()),n.state==="INITIAL")throw new Error("Malformed WebVTT signature.")}catch(i){throw i}return n.onflush&&n.onflush(),this}};var wi=Sr;function Fi(o,n,i,r){for(var e=[],t,a,s,l,u,d=window.VTTCue||TextTrackCue,v=0;v<r.rows.length;v++)if(t=r.rows[v],s=!0,l=0,u="",!t.isEmpty()){for(var p=0;p<t.chars.length;p++)t.chars[p].uchar.match(/\s/)&&s?l++:(u+=t.chars[p].uchar,s=!1);t.cueStartTime=n,n===i&&(i+=1e-4),a=new d(n,i,Rr(u.trim())),l>=16?l--:l++,navigator.userAgent.match(/Firefox\//)?a.line=v+1:a.line=v>7?v-2:v+1,a.align="left",a.position=Math.max(0,Math.min(100,100*(l/32))),e.push(a),o&&o.addCue(a)}return e}var br={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},Lr=function(n){var i=n;return br.hasOwnProperty(n)&&(i=br[n]),String.fromCharCode(i)},gt=15,Et=100,Oi={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},Ci={17:2,18:4,21:6,22:8,23:10,19:13,20:15},ki={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},Pi={25:2,26:4,29:6,30:8,31:10,27:13,28:15},Mi=["white","green","blue","cyan","red","yellow","magenta","black","transparent"],ye;(function(o){o[o.ERROR=0]="ERROR",o[o.TEXT=1]="TEXT",o[o.WARNING=2]="WARNING",o[o.INFO=2]="INFO",o[o.DEBUG=3]="DEBUG",o[o.DATA=3]="DATA"})(ye||(ye={}));var Ni=function(){function o(){this.time=null,this.verboseLevel=ye.ERROR}var n=o.prototype;return n.log=function(r,e){this.verboseLevel>=r&&c.logger.log(this.time+" ["+r+"] "+e)},o}(),wt=function(n){for(var i=[],r=0;r<n.length;r++)i.push(n[r].toString(16));return i},Dr=function(){function o(i,r,e,t,a){this.foreground=void 0,this.underline=void 0,this.italics=void 0,this.background=void 0,this.flash=void 0,this.foreground=i||"white",this.underline=r||!1,this.italics=e||!1,this.background=t||"black",this.flash=a||!1}var n=o.prototype;return n.reset=function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},n.setStyles=function(r){for(var e=["foreground","underline","italics","background","flash"],t=0;t<e.length;t++){var a=e[t];r.hasOwnProperty(a)&&(this[a]=r[a])}},n.isDefault=function(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash},n.equals=function(r){return this.foreground===r.foreground&&this.underline===r.underline&&this.italics===r.italics&&this.background===r.background&&this.flash===r.flash},n.copy=function(r){this.foreground=r.foreground,this.underline=r.underline,this.italics=r.italics,this.background=r.background,this.flash=r.flash},n.toString=function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},o}(),Ui=function(){function o(i,r,e,t,a,s){this.uchar=void 0,this.penState=void 0,this.uchar=i||" ",this.penState=new Dr(r,e,t,a,s)}var n=o.prototype;return n.reset=function(){this.uchar=" ",this.penState.reset()},n.setChar=function(r,e){this.uchar=r,this.penState.copy(e)},n.setPenState=function(r){this.penState.copy(r)},n.equals=function(r){return this.uchar===r.uchar&&this.penState.equals(r.penState)},n.copy=function(r){this.uchar=r.uchar,this.penState.copy(r.penState)},n.isEmpty=function(){return this.uchar===" "&&this.penState.isDefault()},o}(),Bi=function(){function o(i){this.chars=void 0,this.pos=void 0,this.currPenState=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chars=[];for(var r=0;r<Et;r++)this.chars.push(new Ui);this.logger=i,this.pos=0,this.currPenState=new Dr}var n=o.prototype;return n.equals=function(r){for(var e=!0,t=0;t<Et;t++)if(!this.chars[t].equals(r.chars[t])){e=!1;break}return e},n.copy=function(r){for(var e=0;e<Et;e++)this.chars[e].copy(r.chars[e])},n.isEmpty=function(){for(var r=!0,e=0;e<Et;e++)if(!this.chars[e].isEmpty()){r=!1;break}return r},n.setCursor=function(r){this.pos!==r&&(this.pos=r),this.pos<0?(this.logger.log(ye.DEBUG,"Negative cursor position "+this.pos),this.pos=0):this.pos>Et&&(this.logger.log(ye.DEBUG,"Too large cursor position "+this.pos),this.pos=Et)},n.moveCursor=function(r){var e=this.pos+r;if(r>1)for(var t=this.pos+1;t<e+1;t++)this.chars[t].setPenState(this.currPenState);this.setCursor(e)},n.backSpace=function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},n.insertChar=function(r){r>=144&&this.backSpace();var e=Lr(r);if(this.pos>=Et){this.logger.log(ye.ERROR,"Cannot insert "+r.toString(16)+" ("+e+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(e,this.currPenState),this.moveCursor(1)},n.clearFromPos=function(r){var e;for(e=r;e<Et;e++)this.chars[e].reset()},n.clear=function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},n.clearToEndOfRow=function(){this.clearFromPos(this.pos)},n.getTextString=function(){for(var r=[],e=!0,t=0;t<Et;t++){var a=this.chars[t].uchar;a!==" "&&(e=!1),r.push(a)}return e?"":r.join("")},n.setPenStyles=function(r){this.currPenState.setStyles(r);var e=this.chars[this.pos];e.setPenState(this.currPenState)},o}(),lr=function(){function o(i){this.rows=void 0,this.currRow=void 0,this.nrRollUpRows=void 0,this.lastOutputScreen=void 0,this.logger=void 0,this.rows=[];for(var r=0;r<gt;r++)this.rows.push(new Bi(i));this.logger=i,this.currRow=gt-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.reset()}var n=o.prototype;return n.reset=function(){for(var r=0;r<gt;r++)this.rows[r].clear();this.currRow=gt-1},n.equals=function(r){for(var e=!0,t=0;t<gt;t++)if(!this.rows[t].equals(r.rows[t])){e=!1;break}return e},n.copy=function(r){for(var e=0;e<gt;e++)this.rows[e].copy(r.rows[e])},n.isEmpty=function(){for(var r=!0,e=0;e<gt;e++)if(!this.rows[e].isEmpty()){r=!1;break}return r},n.backSpace=function(){var r=this.rows[this.currRow];r.backSpace()},n.clearToEndOfRow=function(){var r=this.rows[this.currRow];r.clearToEndOfRow()},n.insertChar=function(r){var e=this.rows[this.currRow];e.insertChar(r)},n.setPen=function(r){var e=this.rows[this.currRow];e.setPenStyles(r)},n.moveCursor=function(r){var e=this.rows[this.currRow];e.moveCursor(r)},n.setCursor=function(r){this.logger.log(ye.INFO,"setCursor: "+r);var e=this.rows[this.currRow];e.setCursor(r)},n.setPAC=function(r){this.logger.log(ye.INFO,"pacData = "+JSON.stringify(r));var e=r.row-1;if(this.nrRollUpRows&&e<this.nrRollUpRows-1&&(e=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==e){for(var t=0;t<gt;t++)this.rows[t].clear();var a=this.currRow+1-this.nrRollUpRows,s=this.lastOutputScreen;if(s){var l=s.rows[a].cueStartTime,u=this.logger.time;if(l&&u!==null&&l<u)for(var d=0;d<this.nrRollUpRows;d++)this.rows[e-this.nrRollUpRows+d+1].copy(s.rows[a+d])}}this.currRow=e;var v=this.rows[this.currRow];if(r.indent!==null){var p=r.indent,A=Math.max(p-1,0);v.setCursor(r.indent),r.color=v.chars[A].penState.foreground}var F={foreground:r.color,underline:r.underline,italics:r.italics,background:"black",flash:!1};this.setPen(F)},n.setBkgData=function(r){this.logger.log(ye.INFO,"bkgData = "+JSON.stringify(r)),this.backSpace(),this.setPen(r),this.insertChar(32)},n.setRollUpRows=function(r){this.nrRollUpRows=r},n.rollUp=function(){if(this.nrRollUpRows===null){this.logger.log(ye.DEBUG,"roll_up but nrRollUpRows not set yet");return}this.logger.log(ye.TEXT,this.getDisplayText());var r=this.currRow+1-this.nrRollUpRows,e=this.rows.splice(r,1)[0];e.clear(),this.rows.splice(this.currRow,0,e),this.logger.log(ye.INFO,"Rolling up")},n.getDisplayText=function(r){r=r||!1;for(var e=[],t="",a=-1,s=0;s<gt;s++){var l=this.rows[s].getTextString();l&&(a=s+1,r?e.push("Row "+a+": '"+l+"'"):e.push(l.trim()))}return e.length>0&&(r?t="["+e.join(" | ")+"]":t=e.join(`
`)),t},n.getTextAndFormat=function(){return this.rows},o}(),Ir=function(){function o(i,r,e){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=i,this.outputFilter=r,this.mode=null,this.verbose=0,this.displayedMemory=new lr(e),this.nonDisplayedMemory=new lr(e),this.lastOutputScreen=new lr(e),this.currRollUpRow=this.displayedMemory.rows[gt-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=e}var n=o.prototype;return n.reset=function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[gt-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null},n.getHandler=function(){return this.outputFilter},n.setHandler=function(r){this.outputFilter=r},n.setPAC=function(r){this.writeScreen.setPAC(r)},n.setBkgData=function(r){this.writeScreen.setBkgData(r)},n.setMode=function(r){r!==this.mode&&(this.mode=r,this.logger.log(ye.INFO,"MODE="+r),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=r)},n.insertChars=function(r){for(var e=0;e<r.length;e++)this.writeScreen.insertChar(r[e]);var t=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(ye.INFO,t+": "+this.writeScreen.getDisplayText(!0)),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(ye.TEXT,"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())},n.ccRCL=function(){this.logger.log(ye.INFO,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},n.ccBS=function(){this.logger.log(ye.INFO,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},n.ccAOF=function(){},n.ccAON=function(){},n.ccDER=function(){this.logger.log(ye.INFO,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},n.ccRU=function(r){this.logger.log(ye.INFO,"RU("+r+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(r)},n.ccFON=function(){this.logger.log(ye.INFO,"FON - Flash On"),this.writeScreen.setPen({flash:!0})},n.ccRDC=function(){this.logger.log(ye.INFO,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},n.ccTR=function(){this.logger.log(ye.INFO,"TR"),this.setMode("MODE_TEXT")},n.ccRTD=function(){this.logger.log(ye.INFO,"RTD"),this.setMode("MODE_TEXT")},n.ccEDM=function(){this.logger.log(ye.INFO,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},n.ccCR=function(){this.logger.log(ye.INFO,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},n.ccENM=function(){this.logger.log(ye.INFO,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},n.ccEOC=function(){if(this.logger.log(ye.INFO,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){var r=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=r,this.writeScreen=this.nonDisplayedMemory,this.logger.log(ye.TEXT,"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)},n.ccTO=function(r){this.logger.log(ye.INFO,"TO("+r+") - Tab Offset"),this.writeScreen.moveCursor(r)},n.ccMIDROW=function(r){var e={flash:!1};if(e.underline=r%2===1,e.italics=r>=46,e.italics)e.foreground="white";else{var t=Math.floor(r/2)-16,a=["white","green","blue","cyan","red","yellow","magenta"];e.foreground=a[t]}this.logger.log(ye.INFO,"MIDROW: "+JSON.stringify(e)),this.writeScreen.setPen(e)},n.outputDataUpdate=function(r){r===void 0&&(r=!1);var e=this.logger.time;e!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=e:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,e,this.lastOutputScreen),r&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:e),this.lastOutputScreen.copy(this.displayedMemory))},n.cueSplitAtTime=function(r){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,r,this.displayedMemory),this.cueStartTime=r))},o}(),Gi=function(){function o(i,r,e){this.channels=void 0,this.currentChannel=0,this.cmdHistory=void 0,this.logger=void 0;var t=new Ni;this.channels=[null,new Ir(i,r,t),new Ir(i+1,e,t)],this.cmdHistory=Fr(),this.logger=t}var n=o.prototype;return n.getHandler=function(r){return this.channels[r].getHandler()},n.setHandler=function(r,e){this.channels[r].setHandler(e)},n.addData=function(r,e){var t,a,s,l=!1;this.logger.time=r;for(var u=0;u<e.length;u+=2)if(a=e[u]&127,s=e[u+1]&127,!(a===0&&s===0)){if(this.logger.log(ye.DATA,"["+wt([e[u],e[u+1]])+"] -> ("+wt([a,s])+")"),t=this.parseCmd(a,s),t||(t=this.parseMidrow(a,s)),t||(t=this.parsePAC(a,s)),t||(t=this.parseBackgroundAttributes(a,s)),!t&&(l=this.parseChars(a,s),l)){var d=this.currentChannel;if(d&&d>0){var v=this.channels[d];v.insertChars(l)}else this.logger.log(ye.WARNING,"No channel found yet. TEXT-MODE?")}!t&&!l&&this.logger.log(ye.WARNING,"Couldn't parse cleaned data "+wt([a,s])+" orig: "+wt([e[u],e[u+1]]))}},n.parseCmd=function(r,e){var t=this.cmdHistory,a=(r===20||r===28||r===21||r===29)&&e>=32&&e<=47,s=(r===23||r===31)&&e>=33&&e<=35;if(!(a||s))return!1;if(wr(r,e,t))return kt(null,null,t),this.logger.log(ye.DEBUG,"Repeated command ("+wt([r,e])+") is dropped"),!0;var l=r===20||r===21||r===23?1:2,u=this.channels[l];return r===20||r===21||r===28||r===29?e===32?u.ccRCL():e===33?u.ccBS():e===34?u.ccAOF():e===35?u.ccAON():e===36?u.ccDER():e===37?u.ccRU(2):e===38?u.ccRU(3):e===39?u.ccRU(4):e===40?u.ccFON():e===41?u.ccRDC():e===42?u.ccTR():e===43?u.ccRTD():e===44?u.ccEDM():e===45?u.ccCR():e===46?u.ccENM():e===47&&u.ccEOC():u.ccTO(e-32),kt(r,e,t),this.currentChannel=l,!0},n.parseMidrow=function(r,e){var t=0;if((r===17||r===25)&&e>=32&&e<=47){if(r===17?t=1:t=2,t!==this.currentChannel)return this.logger.log(ye.ERROR,"Mismatch channel in midrow parsing"),!1;var a=this.channels[t];return a?(a.ccMIDROW(e),this.logger.log(ye.DEBUG,"MIDROW ("+wt([r,e])+")"),!0):!1}return!1},n.parsePAC=function(r,e){var t,a=this.cmdHistory,s=(r>=17&&r<=23||r>=25&&r<=31)&&e>=64&&e<=127,l=(r===16||r===24)&&e>=64&&e<=95;if(!(s||l))return!1;if(wr(r,e,a))return kt(null,null,a),!0;var u=r<=23?1:2;e>=64&&e<=95?t=u===1?Oi[r]:ki[r]:t=u===1?Ci[r]:Pi[r];var d=this.channels[u];return d?(d.setPAC(this.interpretPAC(t,e)),kt(r,e,a),this.currentChannel=u,!0):!1},n.interpretPAC=function(r,e){var t=e,a={color:null,italics:!1,indent:null,underline:!1,row:r};return e>95?t=e-96:t=e-64,a.underline=(t&1)===1,t<=13?a.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(t/2)]:t<=15?(a.italics=!0,a.color="white"):a.indent=Math.floor((t-16)/2)*4,a},n.parseChars=function(r,e){var t,a=null,s=null;if(r>=25?(t=2,s=r-8):(t=1,s=r),s>=17&&s<=19){var l=e;s===17?l=e+80:s===18?l=e+112:l=e+144,this.logger.log(ye.INFO,"Special char '"+Lr(l)+"' in channel "+t),a=[l]}else r>=32&&r<=127&&(a=e===0?[r]:[r,e]);if(a){var u=wt(a);this.logger.log(ye.DEBUG,"Char codes =  "+u.join(",")),kt(r,e,this.cmdHistory)}return a},n.parseBackgroundAttributes=function(r,e){var t=(r===16||r===24)&&e>=32&&e<=47,a=(r===23||r===31)&&e>=45&&e<=47;if(!(t||a))return!1;var s,l={};r===16||r===24?(s=Math.floor((e-32)/2),l.background=Mi[s],e%2===1&&(l.background=l.background+"_semi")):e===45?l.background="transparent":(l.foreground="black",e===47&&(l.underline=!0));var u=r<=23?1:2,d=this.channels[u];return d.setBkgData(l),kt(r,e,this.cmdHistory),!0},n.reset=function(){for(var r=0;r<Object.keys(this.channels).length;r++){var e=this.channels[r];e&&e.reset()}this.cmdHistory=Fr()},n.cueSplitAtTime=function(r){for(var e=0;e<this.channels.length;e++){var t=this.channels[e];t&&t.cueSplitAtTime(r)}},o}();function kt(o,n,i){i.a=o,i.b=n}function wr(o,n,i){return i.a===o&&i.b===n}function Fr(){return{a:null,b:null}}var Or=Gi,er=function(){function o(i,r){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=i,this.trackName=r}var n=o.prototype;return n.dispatchCue=function(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)},n.newCue=function(r,e,t){(this.startTime===null||this.startTime>r)&&(this.startTime=r),this.endTime=e,this.screen=t,this.timelineController.createCaptionsTrack(this.trackName)},n.reset=function(){this.cueRanges=[]},o}(),ur=function(n,i,r){return n.substr(r||0,i.length)===i},Ki=function(n){var i=parseInt(n.substr(-3)),r=parseInt(n.substr(-6,2)),e=parseInt(n.substr(-9,2)),t=n.length>9?parseInt(n.substr(0,n.indexOf(":"))):0;if(!Object(te.isFiniteNumber)(i)||!Object(te.isFiniteNumber)(r)||!Object(te.isFiniteNumber)(e)||!Object(te.isFiniteNumber)(t))throw Error("Malformed X-TIMESTAMP-MAP: Local:"+n);return i+=1e3*r,i+=60*1e3*e,i+=60*60*1e3*t,i},fr=function(n){for(var i=5381,r=n.length;r;)i=i*33^n.charCodeAt(--r);return(i>>>0).toString()},ji=function(n,i,r){var e=n[i],t=n[e.prevCC];if(!t||!t.new&&e.new){n.ccOffset=n.presentationOffset=e.start,e.new=!1;return}for(;t&&t.new;)n.ccOffset+=e.start-t.start,e.new=!1,e=t,t=n[e.prevCC];n.presentationOffset=r},Hi={parse:function(n,i,r,e,t,a){var s=/\r\n|\n\r|\n|\r/g,l=Object(St.utf8ArrayToStr)(new Uint8Array(n)).trim().replace(s,`
`).split(`
`),u="00:00.000",d=0,v=0,p=0,A=[],F,B=!0,q=!1,ie=new wi;ie.oncue=function(ee){var ue=r[e],fe=r.ccOffset;ue&&ue.new&&(v!==void 0?fe=r.ccOffset=ue.start:ji(r,e,p)),p&&(fe=p-r.presentationOffset),q&&(ee.startTime+=fe-v,ee.endTime+=fe-v),ee.id=fr(ee.startTime.toString())+fr(ee.endTime.toString())+fr(ee.text),ee.text=decodeURIComponent(encodeURIComponent(ee.text)),ee.endTime>0&&A.push(ee)},ie.onparsingerror=function(ee){F=ee},ie.onflush=function(){if(F&&a){a(F);return}t(A)},l.forEach(function(ee){if(B)if(ur(ee,"X-TIMESTAMP-MAP=")){B=!1,q=!0,ee.substr(16).split(",").forEach(function(ue){ur(ue,"LOCAL:")?u=ue.substr(6):ur(ue,"MPEGTS:")&&(d=parseInt(ue.substr(7)))});try{i+(r[e].start*9e4||0)<0&&(i+=8589934592),d-=i,v=Ki(u)/1e3,p=d/9e4}catch(ue){q=!1,F=ue}return}else ee===""&&(B=!1);ie.parse(ee+`
`)}),ie.flush()}},Wi=Hi;function tr(o){if(o===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return o}function Vi(o,n){o.prototype=Object.create(n.prototype),o.prototype.constructor=o,o.__proto__=n}var Yi=function(o){Vi(n,o);function n(r){var e;if(e=o.call(this,r,h.default.MEDIA_ATTACHING,h.default.MEDIA_DETACHING,h.default.FRAG_PARSING_USERDATA,h.default.FRAG_DECRYPTED,h.default.MANIFEST_LOADING,h.default.MANIFEST_LOADED,h.default.FRAG_LOADED,h.default.INIT_PTS_FOUND)||this,e.media=null,e.config=void 0,e.enabled=!0,e.Cues=void 0,e.textTracks=[],e.tracks=[],e.initPTS=[],e.unparsedVttFrags=[],e.captionsTracks={},e.nonNativeCaptionsTracks={},e.captionsProperties=void 0,e.cea608Parser1=void 0,e.cea608Parser2=void 0,e.lastSn=-1,e.prevCC=-1,e.vttCCs=Cr(),e.hls=r,e.config=r.config,e.Cues=r.config.cueHandler,e.captionsProperties={textTrack1:{label:e.config.captionsTextTrack1Label,languageCode:e.config.captionsTextTrack1LanguageCode},textTrack2:{label:e.config.captionsTextTrack2Label,languageCode:e.config.captionsTextTrack2LanguageCode},textTrack3:{label:e.config.captionsTextTrack3Label,languageCode:e.config.captionsTextTrack3LanguageCode},textTrack4:{label:e.config.captionsTextTrack4Label,languageCode:e.config.captionsTextTrack4LanguageCode}},e.config.enableCEA708Captions){var t=new er(tr(e),"textTrack1"),a=new er(tr(e),"textTrack2"),s=new er(tr(e),"textTrack3"),l=new er(tr(e),"textTrack4");e.cea608Parser1=new Or(1,t,a),e.cea608Parser2=new Or(3,s,l)}return e}var i=n.prototype;return i.addCues=function(e,t,a,s,l){for(var u=!1,d=l.length;d--;){var v=l[d],p=zi(v[0],v[1],t,a);if(p>=0&&(v[0]=Math.min(v[0],t),v[1]=Math.max(v[1],a),u=!0,p/(a-t)>.5))return}if(u||l.push([t,a]),this.config.renderTextTracksNatively)this.Cues.newCue(this.captionsTracks[e],t,a,s);else{var A=this.Cues.newCue(null,t,a,s);this.hls.trigger(h.default.CUES_PARSED,{type:"captions",cues:A,track:e})}},i.onInitPtsFound=function(e){var t=this,a=e.frag,s=e.id,l=e.initPTS,u=this.unparsedVttFrags;s==="main"&&(this.initPTS[a.cc]=l),u.length&&(this.unparsedVttFrags=[],u.forEach(function(d){t.onFragLoaded(d)}))},i.getExistingTrack=function(e){var t=this.media;if(t)for(var a=0;a<t.textTracks.length;a++){var s=t.textTracks[a];if(s[e])return s}return null},i.createCaptionsTrack=function(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)},i.createNativeTrack=function(e){if(!this.captionsTracks[e]){var t=this.captionsProperties,a=this.captionsTracks,s=this.media,l=t[e],u=l.label,d=l.languageCode,v=this.getExistingTrack(e);if(v)a[e]=v,It(a[e]),qt(a[e],s);else{var p=this.createTextTrack("captions",u,d);p&&(p[e]=!0,a[e]=p)}}},i.createNonNativeTrack=function(e){if(!this.nonNativeCaptionsTracks[e]){var t=this.captionsProperties[e];if(!!t){var a=t.label,s={_id:e,label:a,kind:"captions",default:t.media?!!t.media.default:!1,closedCaptions:t.media};this.nonNativeCaptionsTracks[e]=s,this.hls.trigger(h.default.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[s]})}}},i.createTextTrack=function(e,t,a){var s=this.media;if(!!s)return s.addTextTrack(e,t,a)},i.destroy=function(){o.prototype.destroy.call(this)},i.onMediaAttaching=function(e){this.media=e.media,this._cleanTracks()},i.onMediaDetaching=function(){var e=this.captionsTracks;Object.keys(e).forEach(function(t){It(e[t]),delete e[t]}),this.nonNativeCaptionsTracks={}},i.onManifestLoading=function(){this.lastSn=-1,this.prevCC=-1,this.vttCCs=Cr(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={}},i._cleanTracks=function(){var e=this.media;if(!!e){var t=e.textTracks;if(t)for(var a=0;a<t.length;a++)It(t[a])}},i.onManifestLoaded=function(e){var t=this;if(this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset()),this.config.enableWebVTT){var a=e.subtitles||[],s=this.tracks&&a&&this.tracks.length===a.length;if(this.tracks=e.subtitles||[],this.config.renderTextTracksNatively){var l=this.media?this.media.textTracks:[];this.tracks.forEach(function(d,v){var p;if(v<l.length){for(var A=null,F=0;F<l.length;F++)if(Xi(l[F],d)){A=l[F];break}A&&(p=A)}p||(p=t.createTextTrack("subtitles",d.name,d.lang)),d.default?p.mode=t.hls.subtitleDisplay?"showing":"hidden":p.mode="disabled",t.textTracks.push(p)})}else if(!s&&this.tracks&&this.tracks.length){var u=this.tracks.map(function(d){return{label:d.name,kind:d.type.toLowerCase(),default:d.default,subtitleTrack:d}});this.hls.trigger(h.default.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:u})}}this.config.enableCEA708Captions&&e.captions&&e.captions.forEach(function(d){var v=/(?:CC|SERVICE)([1-4])/.exec(d.instreamId);if(!!v){var p="textTrack"+v[1],A=t.captionsProperties[p];!A||(A.label=d.name,d.lang&&(A.languageCode=d.lang),A.media=d)}})},i.onFragLoaded=function(e){var t=e.frag,a=e.payload,s=this.cea608Parser1,l=this.cea608Parser2,u=this.initPTS,d=this.lastSn,v=this.unparsedVttFrags;if(t.type==="main"){var p=t.sn;t.sn!==d+1&&s&&l&&(s.reset(),l.reset()),this.lastSn=p}else if(t.type==="subtitle")if(a.byteLength){if(!Object(te.isFiniteNumber)(u[t.cc])){v.push(e),u.length&&this.hls.trigger(h.default.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:t});return}var A=t.decryptdata;(A==null||A.key==null||A.method!=="AES-128")&&this._parseVTTs(t,a)}else this.hls.trigger(h.default.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:t})},i._parseVTTs=function(e,t){var a=this,s=this.hls,l=this.prevCC,u=this.textTracks,d=this.vttCCs;d[e.cc]||(d[e.cc]={start:e.start,prevCC:l,new:!0},this.prevCC=e.cc),Wi.parse(t,this.initPTS[e.cc],d,e.cc,function(v){if(a.config.renderTextTracksNatively){var p=u[e.level];if(p.mode==="disabled"){s.trigger(h.default.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e});return}v.forEach(function(F){if(!p.cues.getCueById(F.id))try{if(p.addCue(F),!p.cues.getCueById(F.id))throw new Error("addCue is failed for: "+F)}catch(q){c.logger.debug("Failed occurred on adding cues: "+q);var B=new window.TextTrackCue(F.startTime,F.endTime,F.text);B.id=F.id,p.addCue(B)}})}else{var A=a.tracks[e.level].default?"default":"subtitles"+e.level;s.trigger(h.default.CUES_PARSED,{type:"subtitles",cues:v,track:A})}s.trigger(h.default.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},function(v){c.logger.log("Failed to parse VTT cue: "+v),s.trigger(h.default.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e})})},i.onFragDecrypted=function(e){var t=e.frag,a=e.payload;if(t.type==="subtitle"){if(!Object(te.isFiniteNumber)(this.initPTS[t.cc])){this.unparsedVttFrags.push(e);return}this._parseVTTs(t,a)}},i.onFragParsingUserdata=function(e){var t=this.cea608Parser1,a=this.cea608Parser2;if(!(!this.enabled||!(t&&a)))for(var s=0;s<e.samples.length;s++){var l=e.samples[s].bytes;if(l){var u=this.extractCea608Data(l);t.addData(e.samples[s].pts,u[0]),a.addData(e.samples[s].pts,u[1])}}},i.extractCea608Data=function(e){for(var t=e[0]&31,a=2,s=[[],[]],l=0;l<t;l++){var u=e[a++],d=127&e[a++],v=127&e[a++],p=(4&u)!==0,A=3&u;d===0&&v===0||p&&(A===0||A===1)&&(s[A].push(d),s[A].push(v))}return s},n}(T);function Xi(o,n){return o&&o.label===n.name&&!(o.textTrack1||o.textTrack2)}function zi(o,n,i,r){return Math.min(n,r)-Math.max(o,i)}function Cr(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!1}}}var qi=Yi;function kr(o,n){for(var i=0;i<n.length;i++){var r=n[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(o,r.key,r)}}function Qi(o,n,i){return n&&kr(o.prototype,n),i&&kr(o,i),o}function $i(o,n){o.prototype=Object.create(n.prototype),o.prototype.constructor=o,o.__proto__=n}var Zi=function(o){$i(n,o);function n(r){var e;return e=o.call(this,r,h.default.MEDIA_ATTACHED,h.default.MEDIA_DETACHING,h.default.MANIFEST_LOADED,h.default.SUBTITLE_TRACK_LOADED)||this,e.tracks=[],e.trackId=-1,e.media=null,e.stopped=!0,e.subtitleDisplay=!0,e.queuedDefaultTrack=null,e}var i=n.prototype;return i.destroy=function(){T.prototype.destroy.call(this)},i.onMediaAttached=function(e){var t=this;this.media=e.media,this.media&&(Object(te.isFiniteNumber)(this.queuedDefaultTrack)&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=null),this.trackChangeListener=this._onTextTracksChanged.bind(this),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.subtitlePollingInterval=setInterval(function(){t.trackChangeListener()},500):this.media.textTracks.addEventListener("change",this.trackChangeListener))},i.onMediaDetaching=function(){if(!!this.media){this.useTextTrackPolling?clearInterval(this.subtitlePollingInterval):this.media.textTracks.removeEventListener("change",this.trackChangeListener),Object(te.isFiniteNumber)(this.subtitleTrack)&&(this.queuedDefaultTrack=this.subtitleTrack);var e=dr(this.media.textTracks);e.forEach(function(t){It(t)}),this.subtitleTrack=-1,this.media=null}},i.onManifestLoaded=function(e){var t=this,a=e.subtitles||[];this.tracks=a,this.hls.trigger(h.default.SUBTITLE_TRACKS_UPDATED,{subtitleTracks:a}),a.forEach(function(s){s.default&&(t.media?t.subtitleTrack=s.id:t.queuedDefaultTrack=s.id)})},i.onSubtitleTrackLoaded=function(e){var t=this,a=e.id,s=e.details,l=this.trackId,u=this.tracks,d=u[l];if(a>=u.length||a!==l||!d||this.stopped){this._clearReloadTimer();return}if(c.logger.log("subtitle track "+a+" loaded"),s.live){var v=de(d.details,s,e.stats.trequest);c.logger.log("Reloading live subtitle playlist in "+v+"ms"),this.timer=setTimeout(function(){t._loadCurrentTrack()},v)}else this._clearReloadTimer()},i.startLoad=function(){this.stopped=!1,this._loadCurrentTrack()},i.stopLoad=function(){this.stopped=!0,this._clearReloadTimer()},i._clearReloadTimer=function(){this.timer&&(clearTimeout(this.timer),this.timer=null)},i._loadCurrentTrack=function(){var e=this.trackId,t=this.tracks,a=this.hls,s=t[e];e<0||!s||s.details&&!s.details.live||(c.logger.log("Loading subtitle track "+e),a.trigger(h.default.SUBTITLE_TRACK_LOADING,{url:s.url,id:e}))},i._toggleTrackModes=function(e){var t=this.media,a=this.subtitleDisplay,s=this.trackId;if(!!t){var l=dr(t.textTracks);if(e===-1)[].slice.call(l).forEach(function(v){v.mode="disabled"});else{var u=l[s];u&&(u.mode="disabled")}var d=l[e];d&&(d.mode=a?"showing":"hidden")}},i._setSubtitleTrackInternal=function(e){var t=this.hls,a=this.tracks;!Object(te.isFiniteNumber)(e)||e<-1||e>=a.length||(this.trackId=e,c.logger.log("Switching to subtitle track "+e),t.trigger(h.default.SUBTITLE_TRACK_SWITCH,{id:e}),this._loadCurrentTrack())},i._onTextTracksChanged=function(){if(!(!this.media||!this.hls.config.renderTextTracksNatively)){for(var e=-1,t=dr(this.media.textTracks),a=0;a<t.length;a++)if(t[a].mode==="hidden")e=a;else if(t[a].mode==="showing"){e=a;break}this.subtitleTrack=e}},Qi(n,[{key:"subtitleTracks",get:function(){return this.tracks}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(e){this.trackId!==e&&(this._toggleTrackModes(e),this._setSubtitleTrackInternal(e))}}]),n}(T);function dr(o){for(var n=[],i=0;i<o.length;i++){var r=o[i];r.kind==="subtitles"&&r.label&&n.push(o[i])}return n}var Ji=Zi,ea=V("./src/crypt/decrypter.js");function ta(o){if(o===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return o}function ra(o,n){o.prototype=Object.create(n.prototype),o.prototype.constructor=o,o.__proto__=n}var ia=window,Pr=ia.performance,hr=500,aa=function(o){ra(n,o);function n(r,e){var t;return t=o.call(this,r,h.default.MEDIA_ATTACHED,h.default.MEDIA_DETACHING,h.default.ERROR,h.default.KEY_LOADED,h.default.FRAG_LOADED,h.default.SUBTITLE_TRACKS_UPDATED,h.default.SUBTITLE_TRACK_SWITCH,h.default.SUBTITLE_TRACK_LOADED,h.default.SUBTITLE_FRAG_PROCESSED,h.default.LEVEL_UPDATED)||this,t.fragmentTracker=e,t.config=r.config,t.state=C.STOPPED,t.tracks=[],t.tracksBuffered=[],t.currentTrackId=-1,t.decrypter=new ea.default(r,r.config),t.lastAVStart=0,t._onMediaSeeking=t.onMediaSeeking.bind(ta(t)),t}var i=n.prototype;return i.startLoad=function(){this.stopLoad(),this.state=C.IDLE;var e=this.tracks[this.currentTrackId];e&&e.details&&(this.setInterval(hr),this.tick())},i.onSubtitleFragProcessed=function(e){var t=e.frag,a=e.success;if(this.fragPrevious=t,this.state=C.IDLE,!!a){var s=this.tracksBuffered[this.currentTrackId];if(!!s){for(var l,u=t.start,d=0;d<s.length;d++)if(u>=s[d].start&&u<=s[d].end){l=s[d];break}var v=t.start+t.duration;l?l.end=v:(l={start:u,end:v},s.push(l))}}},i.onMediaAttached=function(e){var t=e.media;this.media=t,t.addEventListener("seeking",this._onMediaSeeking),this.state=C.IDLE},i.onMediaDetaching=function(){var e=this;!this.media||(this.media.removeEventListener("seeking",this._onMediaSeeking),this.fragmentTracker.removeAllFragments(),this.currentTrackId=-1,this.tracks.forEach(function(t){e.tracksBuffered[t.id]=[]}),this.media=null,this.state=C.STOPPED)},i.onError=function(e){var t=e.frag;!t||t.type!=="subtitle"||(this.fragCurrent&&this.fragCurrent.loader&&this.fragCurrent.loader.abort(),this.state=C.IDLE)},i.onSubtitleTracksUpdated=function(e){var t=this;c.logger.log("subtitle tracks updated"),this.tracksBuffered=[],this.tracks=e.subtitleTracks,this.tracks.forEach(function(a){t.tracksBuffered[a.id]=[]})},i.onSubtitleTrackSwitch=function(e){if(this.currentTrackId=e.id,!this.tracks||!this.tracks.length||this.currentTrackId===-1){this.clearInterval();return}var t=this.tracks[this.currentTrackId];t&&t.details&&this.setInterval(hr)},i.onSubtitleTrackLoaded=function(e){var t=e.id,a=e.details,s=this.currentTrackId,l=this.tracks,u=l[s];t>=l.length||t!==s||!u||(a.live&&W(u.details,a,this.lastAVStart),u.details=a,this.setInterval(hr))},i.onKeyLoaded=function(){this.state===C.KEY_LOADING&&(this.state=C.IDLE)},i.onFragLoaded=function(e){var t=this.fragCurrent,a=e.frag.decryptdata,s=e.frag,l=this.hls;if(this.state===C.FRAG_LOADING&&t&&e.frag.type==="subtitle"&&t.sn===e.frag.sn&&e.payload.byteLength>0&&a&&a.key&&a.method==="AES-128"){var u=Pr.now();this.decrypter.decrypt(e.payload,a.key.buffer,a.iv.buffer,function(d){var v=Pr.now();l.trigger(h.default.FRAG_DECRYPTED,{frag:s,payload:d,stats:{tstart:u,tdecrypt:v}})})}},i.onLevelUpdated=function(e){var t=e.details,a=t.fragments;this.lastAVStart=a.length?a[0].start:0},i.doTick=function(){if(!this.media){this.state=C.IDLE;return}switch(this.state){case C.IDLE:{var e=this.config,t=this.currentTrackId,a=this.fragmentTracker,s=this.media,l=this.tracks;if(!l||!l[t]||!l[t].details)break;var u=e.maxBufferHole,d=e.maxFragLookUpTolerance,v=Math.min(e.maxBufferLength,e.maxMaxBufferLength),p=m.bufferedInfo(this._getBuffered(),s.currentTime,u),A=p.end,F=p.len,B=l[t].details,q=B.fragments,ie=q.length,ee=q[ie-1].start+q[ie-1].duration;if(F>v)return;var ue,fe=this.fragPrevious;A<ee?(fe&&B.hasProgramDateTime&&(ue=ze(q,fe.endProgramDateTime,d)),ue||(ue=je(fe,q,A,d))):ue=q[ie-1],ue&&ue.encrypted?(c.logger.log("Loading key for "+ue.sn),this.state=C.KEY_LOADING,this.hls.trigger(h.default.KEY_LOADING,{frag:ue})):ue&&a.getState(ue)===Ie.NOT_LOADED&&(this.fragCurrent=ue,this.state=C.FRAG_LOADING,this.hls.trigger(h.default.FRAG_LOADING,{frag:ue}))}}},i.stopLoad=function(){this.lastAVStart=0,this.fragPrevious=null,o.prototype.stopLoad.call(this)},i._getBuffered=function(){return this.tracksBuffered[this.currentTrackId]||[]},i.onMediaSeeking=function(){if(this.fragCurrent){var e=this.media?this.media.currentTime:0,t=this.config.maxFragLookUpTolerance,a=this.fragCurrent.start-t,s=this.fragCurrent.start+this.fragCurrent.duration+t;(e<a||e>s)&&(this.fragCurrent.loader&&this.fragCurrent.loader.abort(),this.fragmentTracker.removeFragment(this.fragCurrent),this.fragCurrent=null,this.fragPrevious=null,this.state=C.IDLE,this.tick())}},n}(yt),Pt;(function(o){o.WIDEVINE="com.widevine.alpha",o.PLAYREADY="com.microsoft.playready"})(Pt||(Pt={}));var na=function(){return typeof window!="undefined"&&window.navigator&&window.navigator.requestMediaKeySystemAccess?window.navigator.requestMediaKeySystemAccess.bind(window.navigator):null}();function Mr(o,n){for(var i=0;i<n.length;i++){var r=n[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(o,r.key,r)}}function sa(o,n,i){return n&&Mr(o.prototype,n),i&&Mr(o,i),o}function oa(o,n){o.prototype=Object.create(n.prototype),o.prototype.constructor=o,o.__proto__=n}var Nr=3,la=function(n,i,r){var e={audioCapabilities:[],videoCapabilities:[]};return n.forEach(function(t){e.audioCapabilities.push({contentType:'audio/mp4; codecs="'+t+'"',robustness:r.audioRobustness||""})}),i.forEach(function(t){e.videoCapabilities.push({contentType:'video/mp4; codecs="'+t+'"',robustness:r.videoRobustness||""})}),[e]},ua=function(n,i,r,e){switch(n){case Pt.WIDEVINE:return la(i,r,e);default:throw new Error("Unknown key-system: "+n)}},fa=function(o){oa(n,o);function n(r){var e;return e=o.call(this,r,h.default.MEDIA_ATTACHED,h.default.MEDIA_DETACHED,h.default.MANIFEST_PARSED)||this,e._widevineLicenseUrl=void 0,e._licenseXhrSetup=void 0,e._emeEnabled=void 0,e._requestMediaKeySystemAccess=void 0,e._drmSystemOptions=void 0,e._config=void 0,e._mediaKeysList=[],e._media=null,e._hasSetMediaKeys=!1,e._requestLicenseFailureCount=0,e.mediaKeysPromise=null,e._onMediaEncrypted=function(t){if(c.logger.log('Media is encrypted using "'+t.initDataType+'" init data type'),!e.mediaKeysPromise){c.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been requested"),e.hls.trigger(h.default.ERROR,{type:L.ErrorTypes.KEY_SYSTEM_ERROR,details:L.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});return}var a=function(l){!e._media||(e._attemptSetMediaKeys(l),e._generateRequestWithPreferredKeySession(t.initDataType,t.initData))};e.mediaKeysPromise.then(a).catch(a)},e._config=r.config,e._widevineLicenseUrl=e._config.widevineLicenseUrl,e._licenseXhrSetup=e._config.licenseXhrSetup,e._emeEnabled=e._config.emeEnabled,e._requestMediaKeySystemAccess=e._config.requestMediaKeySystemAccessFunc,e._drmSystemOptions=r.config.drmSystemOptions,e}var i=n.prototype;return i.getLicenseServerUrl=function(e){switch(e){case Pt.WIDEVINE:if(!this._widevineLicenseUrl)break;return this._widevineLicenseUrl}throw new Error('no license server URL configured for key-system "'+e+'"')},i._attemptKeySystemAccess=function(e,t,a){var s=this,l=ua(e,t,a,this._drmSystemOptions);c.logger.log("Requesting encrypted media key-system access");var u=this.requestMediaKeySystemAccess(e,l);this.mediaKeysPromise=u.then(function(d){return s._onMediaKeySystemAccessObtained(e,d)}),u.catch(function(d){c.logger.error('Failed to obtain key-system "'+e+'" access:',d)})},i._onMediaKeySystemAccessObtained=function(e,t){var a=this;c.logger.log('Access for key-system "'+e+'" obtained');var s={mediaKeysSessionInitialized:!1,mediaKeySystemAccess:t,mediaKeySystemDomain:e};this._mediaKeysList.push(s);var l=Promise.resolve().then(function(){return t.createMediaKeys()}).then(function(u){return s.mediaKeys=u,c.logger.log('Media-keys created for key-system "'+e+'"'),a._onMediaKeysCreated(),u});return l.catch(function(u){c.logger.error("Failed to create media-keys:",u)}),l},i._onMediaKeysCreated=function(){var e=this;this._mediaKeysList.forEach(function(t){t.mediaKeysSession||(t.mediaKeysSession=t.mediaKeys.createSession(),e._onNewMediaKeySession(t.mediaKeysSession))})},i._onNewMediaKeySession=function(e){var t=this;c.logger.log("New key-system session "+e.sessionId),e.addEventListener("message",function(a){t._onKeySessionMessage(e,a.message)},!1)},i._onKeySessionMessage=function(e,t){c.logger.log("Got EME message event, creating license request"),this._requestLicense(t,function(a){c.logger.log("Received license data (length: "+(a&&a.byteLength)+"), updating key-session"),e.update(a)})},i._attemptSetMediaKeys=function(e){if(!this._media)throw new Error("Attempted to set mediaKeys without first attaching a media element");if(!this._hasSetMediaKeys){var t=this._mediaKeysList[0];if(!t||!t.mediaKeys){c.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been obtained yet"),this.hls.trigger(h.default.ERROR,{type:L.ErrorTypes.KEY_SYSTEM_ERROR,details:L.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});return}c.logger.log("Setting keys for encrypted media"),this._media.setMediaKeys(t.mediaKeys),this._hasSetMediaKeys=!0}},i._generateRequestWithPreferredKeySession=function(e,t){var a=this,s=this._mediaKeysList[0];if(!s){c.logger.error("Fatal: Media is encrypted but not any key-system access has been obtained yet"),this.hls.trigger(h.default.ERROR,{type:L.ErrorTypes.KEY_SYSTEM_ERROR,details:L.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});return}if(s.mediaKeysSessionInitialized){c.logger.warn("Key-Session already initialized but requested again");return}var l=s.mediaKeysSession;if(!l){c.logger.error("Fatal: Media is encrypted but no key-session existing"),this.hls.trigger(h.default.ERROR,{type:L.ErrorTypes.KEY_SYSTEM_ERROR,details:L.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!0});return}if(!t){c.logger.warn("Fatal: initData required for generating a key session is null"),this.hls.trigger(h.default.ERROR,{type:L.ErrorTypes.KEY_SYSTEM_ERROR,details:L.ErrorDetails.KEY_SYSTEM_NO_INIT_DATA,fatal:!0});return}c.logger.log('Generating key-session request for "'+e+'" init data type'),s.mediaKeysSessionInitialized=!0,l.generateRequest(e,t).then(function(){c.logger.debug("Key-session generation succeeded")}).catch(function(u){c.logger.error("Error generating key-session request:",u),a.hls.trigger(h.default.ERROR,{type:L.ErrorTypes.KEY_SYSTEM_ERROR,details:L.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!1})})},i._createLicenseXhr=function(e,t,a){var s=new XMLHttpRequest,l=this._licenseXhrSetup;try{if(l)try{l(s,e)}catch(u){s.open("POST",e,!0),l(s,e)}s.readyState||s.open("POST",e,!0)}catch(u){throw new Error("issue setting up KeySystem license XHR "+u)}return s.responseType="arraybuffer",s.onreadystatechange=this._onLicenseRequestReadyStageChange.bind(this,s,e,t,a),s},i._onLicenseRequestReadyStageChange=function(e,t,a,s){switch(e.readyState){case 4:if(e.status===200)this._requestLicenseFailureCount=0,c.logger.log("License request succeeded"),e.responseType!=="arraybuffer"&&c.logger.warn("xhr response type was not set to the expected arraybuffer for license request"),s(e.response);else{if(c.logger.error("License Request XHR failed ("+t+"). Status: "+e.status+" ("+e.statusText+")"),this._requestLicenseFailureCount++,this._requestLicenseFailureCount>Nr){this.hls.trigger(h.default.ERROR,{type:L.ErrorTypes.KEY_SYSTEM_ERROR,details:L.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0});return}var l=Nr-this._requestLicenseFailureCount+1;c.logger.warn("Retrying license request, "+l+" attempts left"),this._requestLicense(a,s)}break}},i._generateLicenseRequestChallenge=function(e,t){switch(e.mediaKeySystemDomain){case Pt.WIDEVINE:return t}throw new Error("unsupported key-system: "+e.mediaKeySystemDomain)},i._requestLicense=function(e,t){c.logger.log("Requesting content license for key-system");var a=this._mediaKeysList[0];if(!a){c.logger.error("Fatal error: Media is encrypted but no key-system access has been obtained yet"),this.hls.trigger(h.default.ERROR,{type:L.ErrorTypes.KEY_SYSTEM_ERROR,details:L.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});return}try{var s=this.getLicenseServerUrl(a.mediaKeySystemDomain),l=this._createLicenseXhr(s,e,t);c.logger.log("Sending license request to URL: "+s);var u=this._generateLicenseRequestChallenge(a,e);l.send(u)}catch(d){c.logger.error("Failure requesting DRM license: "+d),this.hls.trigger(h.default.ERROR,{type:L.ErrorTypes.KEY_SYSTEM_ERROR,details:L.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})}},i.onMediaAttached=function(e){if(!!this._emeEnabled){var t=e.media;this._media=t,t.addEventListener("encrypted",this._onMediaEncrypted)}},i.onMediaDetached=function(){var e=this._media,t=this._mediaKeysList;!e||(e.removeEventListener("encrypted",this._onMediaEncrypted),this._media=null,this._mediaKeysList=[],Promise.all(t.map(function(a){if(a.mediaKeysSession)return a.mediaKeysSession.close().catch(function(){})})).then(function(){return e.setMediaKeys(null)}).catch(function(){}))},i.onManifestParsed=function(e){if(!!this._emeEnabled){var t=e.levels.map(function(s){return s.audioCodec}),a=e.levels.map(function(s){return s.videoCodec});this._attemptKeySystemAccess(Pt.WIDEVINE,t,a)}},sa(n,[{key:"requestMediaKeySystemAccess",get:function(){if(!this._requestMediaKeySystemAccess)throw new Error("No requestMediaKeySystemAccess function configured");return this._requestMediaKeySystemAccess}}]),n}(T),da=fa;function Ur(o,n){var i=Object.keys(o);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(o);n&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(o,e).enumerable})),i.push.apply(i,r)}return i}function Br(o){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?Ur(Object(i),!0).forEach(function(r){ha(o,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(i)):Ur(Object(i)).forEach(function(r){Object.defineProperty(o,r,Object.getOwnPropertyDescriptor(i,r))})}return o}function ha(o,n,i){return n in o?Object.defineProperty(o,n,{value:i,enumerable:!0,configurable:!0,writable:!0}):o[n]=i,o}var ca=Br(Br({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,initialLiveManifestSize:1,maxBufferLength:30,maxBufferSize:60*1e3*1e3,maxBufferHole:.5,lowBufferWatchdogPeriod:.5,highBufferWatchdogPeriod:3,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,liveDurationInfinity:!1,liveBackBufferLength:1/0,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:mi,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,abrController:ii,bufferController:si,capLevelController:fi,fpsController:vi,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystemOptions:{},requestMediaKeySystemAccessFunc:na,testBandwidth:!0},ga()),{},{subtitleStreamController:aa,subtitleTrackController:Ji,timelineController:qi,audioStreamController:bi,audioTrackController:Ti,emeController:da});function ga(){return{cueHandler:Q,enableCEA708Captions:!0,enableWebVTT:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function Gr(o,n){var i=Object.keys(o);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(o);n&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(o,e).enumerable})),i.push.apply(i,r)}return i}function Kr(o){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?Gr(Object(i),!0).forEach(function(r){va(o,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(i)):Gr(Object(i)).forEach(function(r){Object.defineProperty(o,r,Object.getOwnPropertyDescriptor(i,r))})}return o}function va(o,n,i){return n in o?Object.defineProperty(o,n,{value:i,enumerable:!0,configurable:!0,writable:!0}):o[n]=i,o}function qe(o){if(o===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return o}function jr(o,n){for(var i=0;i<n.length;i++){var r=n[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(o,r.key,r)}}function Hr(o,n,i){return n&&jr(o.prototype,n),i&&jr(o,i),o}function pa(o,n){o.prototype=Object.create(n.prototype),o.prototype.constructor=o,o.__proto__=n}var Wr=function(o){pa(n,o),n.isSupported=function(){return Kt()},Hr(n,null,[{key:"version",get:function(){return"0.14.17"}},{key:"Events",get:function(){return h.default}},{key:"ErrorTypes",get:function(){return L.ErrorTypes}},{key:"ErrorDetails",get:function(){return L.ErrorDetails}},{key:"DefaultConfig",get:function(){return n.defaultConfig?n.defaultConfig:ca},set:function(e){n.defaultConfig=e}}]);function n(r){var e;r===void 0&&(r={}),e=o.call(this)||this,e.config=void 0,e._autoLevelCapping=void 0,e.abrController=void 0,e.capLevelController=void 0,e.levelController=void 0,e.streamController=void 0,e.networkControllers=void 0,e.audioTrackController=void 0,e.subtitleTrackController=void 0,e.emeController=void 0,e.coreComponents=void 0,e.media=null,e.url=null;var t=n.DefaultConfig;if((r.liveSyncDurationCount||r.liveMaxLatencyDurationCount)&&(r.liveSyncDuration||r.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");e.config=Kr(Kr({},t),r);var a=qe(e),s=a.config;if(s.liveMaxLatencyDurationCount!==void 0&&s.liveMaxLatencyDurationCount<=s.liveSyncDurationCount)throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be gt "liveSyncDurationCount"');if(s.liveMaxLatencyDuration!==void 0&&(s.liveSyncDuration===void 0||s.liveMaxLatencyDuration<=s.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be gt "liveSyncDuration"');Object(c.enableLogs)(s.debug),e._autoLevelCapping=-1;var l=e.abrController=new s.abrController(qe(e)),u=new s.bufferController(qe(e)),d=e.capLevelController=new s.capLevelController(qe(e)),v=new s.fpsController(qe(e)),p=new rt(qe(e)),A=new At(qe(e)),F=new Qe(qe(e)),B=new Ct(qe(e)),q=e.levelController=new zt(qe(e)),ie=new Ft(qe(e)),ee=e.streamController=new Bt(qe(e),ie),ue=[q,ee],fe=s.audioStreamController;fe&&ue.push(new fe(qe(e),ie)),e.networkControllers=ue;var Ee=[p,A,F,l,u,d,v,B,ie];if(fe=s.audioTrackController,fe){var Ne=new fe(qe(e));e.audioTrackController=Ne,Ee.push(Ne)}if(fe=s.subtitleTrackController,fe){var lt=new fe(qe(e));e.subtitleTrackController=lt,ue.push(lt)}if(fe=s.emeController,fe){var Ze=new fe(qe(e));e.emeController=Ze,Ee.push(Ze)}return fe=s.subtitleStreamController,fe&&ue.push(new fe(qe(e),ie)),fe=s.timelineController,fe&&Ee.push(new fe(qe(e))),e.coreComponents=Ee,e}var i=n.prototype;return i.destroy=function(){c.logger.log("destroy"),this.trigger(h.default.DESTROYING),this.detachMedia(),this.coreComponents.concat(this.networkControllers).forEach(function(e){e.destroy()}),this.url=null,this.removeAllListeners(),this._autoLevelCapping=-1},i.attachMedia=function(e){c.logger.log("attachMedia"),this.media=e,this.trigger(h.default.MEDIA_ATTACHING,{media:e})},i.detachMedia=function(){c.logger.log("detachMedia"),this.trigger(h.default.MEDIA_DETACHING),this.media=null},i.loadSource=function(e){e=X.buildAbsoluteURL(window.location.href,e,{alwaysNormalize:!0}),c.logger.log("loadSource:"+e),this.url=e,this.trigger(h.default.MANIFEST_LOADING,{url:e})},i.startLoad=function(e){e===void 0&&(e=-1),c.logger.log("startLoad("+e+")"),this.networkControllers.forEach(function(t){t.startLoad(e)})},i.stopLoad=function(){c.logger.log("stopLoad"),this.networkControllers.forEach(function(e){e.stopLoad()})},i.swapAudioCodec=function(){c.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()},i.recoverMediaError=function(){c.logger.log("recoverMediaError");var e=this.media;this.detachMedia(),e&&this.attachMedia(e)},i.removeLevel=function(e,t){t===void 0&&(t=0),this.levelController.removeLevel(e,t)},Hr(n,[{key:"levels",get:function(){return this.levelController.levels}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(e){c.logger.log("set currentLevel:"+e),this.loadLevel=e,this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(e){c.logger.log("set nextLevel:"+e),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(e){c.logger.log("set loadLevel:"+e),this.levelController.manualLevel=e}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(e){this.levelController.nextLoadLevel=e}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(e){c.logger.log("set firstLevel:"+e),this.levelController.firstLevel=e}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(e){c.logger.log("set startLevel:"+e),e!==-1&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}},{key:"capLevelToPlayerSize",set:function(e){var t=!!e;t!==this.config.capLevelToPlayerSize&&(t?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=t)}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(e){c.logger.log("set autoLevelCapping:"+e),this._autoLevelCapping=e}},{key:"bandwidthEstimate",get:function(){var e=this.abrController._bwEstimator;return e?e.getEstimate():NaN}},{key:"autoLevelEnabled",get:function(){return this.levelController.manualLevel===-1}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){for(var e=this.levels,t=this.config.minAutoBitrate,a=e?e.length:0,s=0;s<a;s++){var l=e[s].realBitrate?Math.max(e[s].realBitrate,e[s].bitrate):e[s].bitrate;if(l>t)return s}return 0}},{key:"maxAutoLevel",get:function(){var e=this.levels,t=this.autoLevelCapping,a;return t===-1&&e&&e.length?a=e.length-1:a=t,a}},{key:"nextAutoLevel",get:function(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)},set:function(e){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,e)}},{key:"audioTracks",get:function(){var e=this.audioTrackController;return e?e.audioTracks:[]}},{key:"audioTrack",get:function(){var e=this.audioTrackController;return e?e.audioTrack:-1},set:function(e){var t=this.audioTrackController;t&&(t.audioTrack=e)}},{key:"liveSyncPosition",get:function(){return this.streamController.liveSyncPosition}},{key:"subtitleTracks",get:function(){var e=this.subtitleTrackController;return e?e.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var e=this.subtitleTrackController;return e?e.subtitleTrack:-1},set:function(e){var t=this.subtitleTrackController;t&&(t.subtitleTrack=e)}},{key:"subtitleDisplay",get:function(){var e=this.subtitleTrackController;return e?e.subtitleDisplay:!1},set:function(e){var t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}}]),n}(_);Wr.defaultConfig=void 0},"./src/polyfills/number.js":function(Te,ae,V){"use strict";V.r(ae),V.d(ae,"isFiniteNumber",function(){return Q}),V.d(ae,"MAX_SAFE_INTEGER",function(){return X});var Q=Number.isFinite||function(L){return typeof L=="number"&&isFinite(L)},X=Number.MAX_SAFE_INTEGER||9007199254740991},"./src/utils/get-self-scope.js":function(Te,ae,V){"use strict";V.r(ae),V.d(ae,"getSelfScope",function(){return Q});function Q(){return typeof window=="undefined"?self:window}},"./src/utils/logger.js":function(Te,ae,V){"use strict";V.r(ae),V.d(ae,"enableLogs",function(){return T}),V.d(ae,"logger",function(){return w});var Q=V("./src/utils/get-self-scope.js");function X(){}var L={trace:X,debug:X,log:X,warn:X,info:X,error:X},te=L;function h(R,D){return D="["+R+"] > "+D,D}var c=Object(Q.getSelfScope)();function Z(R){var D=c.console[R];return D?function(){for(var M=arguments.length,k=new Array(M),Y=0;Y<M;Y++)k[Y]=arguments[Y];k[0]&&(k[0]=h(R,k[0])),D.apply(c.console,k)}:X}function S(R){for(var D=arguments.length,M=new Array(D>1?D-1:0),k=1;k<D;k++)M[k-1]=arguments[k];M.forEach(function(Y){te[Y]=R[Y]?R[Y].bind(R):Z(Y)})}var T=function(D){if(c.console&&D===!0||typeof D=="object"){S(D,"debug","log","info","warn","error");try{te.log()}catch(M){te=L}}else te=L},w=te}}).default})});var zr=La(Xr(),1);window.SYNDI.registerModule({type:"lib/ponyfill-hls",moduleclass:zr.default});
